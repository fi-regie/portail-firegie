<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sécurité & Règlementation Structures Itinérantes CTS & ERP Type L</title>

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <!-- Font Awesome pour icônes -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <!-- Palette "Architectural Safety" -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        // Palette du modèle
                        'stone': {
                            50: '#fafaf9',
                            100: '#f5f5f4',
                            200: '#e7e5e4',
                            300: '#d6d3d1',
                            400: '#a8a29e',
                            500: '#78716c',
                            600: '#57534e',
                            700: '#44403c',
                            800: '#292524',
                            900: '#1c1917',
                        },
                        'orange': {
                            600: '#ea580c',
                        },
                        'emerald': {
                            600: '#059669',
                        },
                        'slate': {
                            700: '#334155',
                        }
                    },
                    fontFamily: {
                        'sans': ['Inter', 'system-ui', 'sans-serif'],
                    }
                }
            }
        }
    </script>


    <style>

        body {
            font-family: 'Inter', sans-serif;
            background-color: #fafaf9 !important;
            color: var(--color-primary);
            scroll-behavior: auto !important;
        }

        /* Animation pour fade in */
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .animate-fade-in {
            animation: fadeIn 0.5s ease-in-out;
        }

        /* Tab transitions */
        .tab-content {
            display: none;
            animation: professionalFade 0.4s ease-out;
        }

        .tab-content.active {
            display: block;
        }

        @keyframes professionalFade {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Custom scrollbar */
        .custom-scroll::-webkit-scrollbar { width: 8px; }
        .custom-scroll::-webkit-scrollbar-track { background: #f1f1f1; }
        .custom-scroll::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 4px; }
        .custom-scroll::-webkit-scrollbar-thumb:hover { background: #94a3b8; }

        /* Hide scrollbar for clean horizontal scrolling if needed */
        .no-scrollbar::-webkit-scrollbar {
            display: none;
        }
        .no-scrollbar {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }
    </style>
</head>

<body class="bg-stone-50 text-stone-800 font-sans antialiased selection:bg-orange-200 selection:text-orange-900">

    <!-- Navigation / Header -->
    <nav class="bg-white border-b border-stone-200 sticky top-0 z-50 shadow-sm">
        <div class="max-w-8xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between h-16">
                <div class="flex items-center">
                    <span class="text-2xl mr-2"></span>
                    <h1 class="text-xl font-bold tracking-tight text-slate-700">Sécurité Structures Itinérantes
                        <span class="text-orange-600 text-sm font-normal uppercase ml-2 tracking-widest">CTS & ERP Type L</span></h1>
                </div>
                <div class="flex items-center space-x-4">
                    <span class="hidden md:inline-block text-sm text-stone-500">Conforme Arrêté du 25 juin 1980</span>
                    <div class="h-3 w-3 rounded-full bg-emerald-500 animate-pulse" title="Application active"></div>
                </div>
            </div>
        </div>
    </nav>

    <!-- Navigation professionnelle -->
    <div class="bg-white border-b border-stone-200">
        <div class="max-w-8xl mx-auto">
            <nav class="flex overflow-x-auto no-scrollbar px-4">
                <button onclick="switchTab('dashboard')"
                    class="nav-btn px-4 py-3 border-b-2 border-transparent hover:border-orange-600 hover:text-orange-600 whitespace-nowrap flex items-center"
                    id="btn-dashboard">
                    <i class="fas fa-home mr-2"></i>Tableau de Bord
                </button>
                <button onclick="switchTab('simulation')"
                    class="nav-btn px-4 py-3 border-b-2 border-transparent hover:border-orange-600 hover:text-orange-600 whitespace-nowrap flex items-center"
                    id="btn-simulation">
                    <i class="fas fa-calculator mr-2"></i>Simulateurs
                </button>
                <button onclick="switchTab('cts')"
                    class="nav-btn px-4 py-3 border-b-2 border-transparent hover:border-orange-600 hover:text-orange-600 whitespace-nowrap flex items-center"
                    id="btn-cts">
                    <i class="fas fa-wind mr-2"></i>CTS & Météo
                </button>
                <button onclick="switchTab('animals')"
                    class="nav-btn px-4 py-3 border-b-2 border-transparent hover:border-orange-600 hover:text-orange-600 whitespace-nowrap flex items-center"
                    id="btn-animals">
                    <i class="fas fa-paw mr-2"></i>Faune Sauvage
                </button>
                <button onclick="switchTab('legislation')"
                    class="nav-btn px-4 py-3 border-b-2 border-transparent hover:border-orange-600 hover:text-orange-600 whitespace-nowrap flex items-center"
                    id="btn-legislation">
                    <i class="fas fa-scale-balanced mr-2"></i>Législation
                </button>
                <button onclick="switchTab('procedures')"
                    class="nav-btn px-4 py-3 border-b-2 border-transparent hover:border-orange-600 hover:text-orange-600 whitespace-nowrap flex items-center"
                    id="btn-procedures">
                    <i class="fas fa-clock-rotate-left mr-2"></i>Procédures
                </button>
                <button onclick="switchTab('technique')"
                    class="nav-btn px-4 py-3 border-b-2 border-transparent hover:border-orange-600 hover:text-orange-600 whitespace-nowrap flex items-center"
                    id="btn-technique">
                    <i class="fas fa-gears mr-2"></i>Focus Technique
                </button>
                <button onclick="switchTab('outils')"
                    class="nav-btn px-4 py-3 border-b-2 border-transparent hover:border-emerald-600 hover:text-emerald-600 whitespace-nowrap flex items-center"
                    id="btn-outils">
                    <i class="fas fa-toolbox mr-2"></i>Outils
                </button>
            </nav>
        </div>
    </div>

    <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8 space-y-12">

        <!-- ONGLET 1 : TABLEAU DE BORD -->
        <div id="dashboard" class="tab-content active">
            <div class="bg-white rounded-xl shadow-sm border border-stone-100 p-6 md:p-8 mb-8">
                <h2 class="text-2xl font-semibold mb-4 text-slate-700">Guide Réglementaire CTS & ERP Type L</h2>
                <p class="text-stone-600 leading-relaxed mb-6">
                    Ce portail centralise les obligations réglementaires pour les <strong>ERP de Type L</strong> (Salles à usage d'audition, de conférences, de réunions, de spectacles ou à usage multiple) et plus spécifiquement les <strong>CTS</strong> (Chapiteaux, Tentes et Structures).
                    Il s'adresse aux exploitants, régisseurs et organismes de contrôle.
                </p>

                <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mt-6">
                    <div class="bg-stone-50 p-4 rounded-lg border-l-4 border-orange-500">
                        <span class="block text-xs font-bold text-stone-400 uppercase tracking-wider mb-1">Cadre Général</span>
                        <span class="font-medium">ERP Type L</span>
                        <p class="text-sm text-stone-600 mt-1">Installations fixes ou provisoires accueillant du public pour des spectacles.</p>
                    </div>
                    <div class="bg-stone-50 p-4 rounded-lg border-l-4 border-slate-600">
                        <span class="block text-xs font-bold text-stone-400 uppercase tracking-wider mb-1">Réglementation Spécifique</span>
                        <span class="font-medium">CTS</span>
                        <p class="text-sm text-stone-600 mt-1">Règlement spécifique (Arrêté du 23 janvier 1985) pour les établissements itinérants.</p>
                    </div>
                    <div class="bg-stone-50 p-4 rounded-lg border-l-4 border-emerald-500">
                        <span class="block text-xs font-bold text-stone-400 uppercase tracking-wider mb-1">Vérification Obligatoire</span>
                        <span class="font-medium">Contrôle</span>
                        <p class="text-sm text-stone-600 mt-1">Obligation de vérification par des organismes agréés (BVCTS) avant ouverture.</p>
                    </div>
                </div>
            </div>

            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                <!-- Chart 1: Inspection Distribution -->
                <div class="bg-white rounded-xl shadow-sm p-6 border border-stone-200">
                    <h3 class="text-lg font-semibold text-slate-700 mb-4">Répartition des Points de Contrôle (CTS)</h3>
                    <p class="text-xs text-stone-500 mb-2">Estimation de la densité réglementaire par domaine.</p>
                    <div style="height: 300px; position: relative;">
                        <canvas id="inspectionChart"></canvas>
                    </div>
                    <div class="mt-4 text-sm text-stone-600 bg-stone-100 p-3 rounded">
                        Les articles CTS 1 à 37 couvrent la structure, mais la sécurité incendie (désenfumage, réaction au feu) représente une part majeure de la conformité.
                    </div>
                </div>

                <!-- Key Metrics / Alerts -->
                <div class="bg-white rounded-xl shadow-sm p-6 border border-stone-200">
                    <h3 class="text-lg font-semibold text-slate-700 mb-4">Rappels Critiques</h3>
                    
                    <div class="space-y-4">
                        <div class="flex items-center p-4 bg-red-50 rounded-lg border-l-4 border-red-500">
                            <i class="fas fa-wind text-red-600 text-2xl mr-4"></i>
                            <div>
                                <p class="text-sm font-bold text-red-800">Vent > 100 km/h</p>
                                <p class="text-xs text-red-600">Évacuation obligatoire du public (sauf spécification contraire du registre de sécurité).</p>
                            </div>
                        </div>
                        
                        <div class="flex items-center p-4 bg-blue-50 rounded-lg border-l-4 border-blue-500">
                            <i class="fas fa-calendar-days text-blue-600 text-2xl mr-4"></i>
                            <div>
                                <p class="text-sm font-bold text-blue-800">Validité Registre</p>
                                <p class="text-xs text-blue-600">2 ans (ou 6 mois selon catégorie) pour les inspections périodiques.</p>
                            </div>
                        </div>
                        
                        <div class="flex items-center p-4 bg-yellow-50 rounded-lg border-l-4 border-yellow-500">
                            <i class="fas fa-anchor text-yellow-600 text-2xl mr-4"></i>
                            <div>
                                <p class="text-sm font-bold text-yellow-800">Sol & Ancrage</p>
                                <p class="text-xs text-yellow-600">Le test d'arrachement est la cause #1 de retard d'homologation.</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ONGLET 2 : SIMULATEURS -->
        <div id="simulation" class="tab-content">
            <div class="max-w-6xl mx-auto space-y-12">
                <!-- Introduction -->
                <div class="bg-white rounded-xl shadow-sm border border-stone-100 p-6 md:p-8">
                    <h2 class="text-2xl font-semibold mb-4 text-slate-700">Simulateurs de Sécurité ERP Type L</h2>
                    <p class="text-stone-600 leading-relaxed mb-4">
                        Ces outils interactifs vous permettent d'explorer les piliers de la sécurité : la classification des salles, les calculs d'évacuation, la sécurité des chapiteaux, la réaction au feu des matériaux et l'organisation humaine.
                    </p>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mt-6">
                        <div class="bg-stone-50 p-4 rounded-lg border-l-4 border-orange-500">
                            <span class="block text-xs font-bold text-stone-400 uppercase tracking-wider mb-1">Priorité 1</span>
                            <span class="font-medium">Sécurité des Personnes</span>
                        </div>
                        <div class="bg-stone-50 p-4 rounded-lg border-l-4 border-slate-600">
                            <span class="block text-xs font-bold text-stone-400 uppercase tracking-wider mb-1">Priorité 2</span>
                            <span class="font-medium">Lutte contre l'Incendie</span>
                        </div>
                        <div class="bg-stone-50 p-4 rounded-lg border-l-4 border-emerald-500">
                            <span class="block text-xs font-bold text-stone-400 uppercase tracking-wider mb-1">Priorité 3</span>
                            <span class="font-medium">Évacuation Rapide</span>
                        </div>
                    </div>
                </div>

                <!-- Section 1: Classification Calculator -->
                <section id="classification" class="scroll-mt-20">
                    <div class="mb-6">
                        <h3 class="text-xl font-bold text-slate-800 flex items-center">
                            <span class="bg-slate-800 text-white rounded-md w-8 h-8 flex items-center justify-center mr-3 text-sm">1</span>
                            Classification & Jauge
                        </h3>
                        <p class="text-stone-600 mt-2 max-w-3xl">
                            La catégorie de votre établissement détermine la sévérité des règles (présence SSIAP, visites de commission, etc.). 
                            Elle est calculée selon l'<strong>effectif total</strong> (public + personnel non indispensable).
                            Entrez une jauge ci-dessous pour voir où se situe votre établissement.
                        </p>
                    </div>

                    <!-- SECTION A: CLASSIFICATION CALCULATOR -->
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                        <!-- Calculator Input -->
                        <div class="bg-white p-6 rounded-xl shadow-lg border-l-4 border-orange-500">
                            <div class="flex items-center justify-between mb-4">
                                <h3 class="text-xl font-bold text-stone-900">Calculateur de Catégorie ERP</h3>
                                <span class="text-2xl"></span>
                            </div>
                            <p class="text-sm text-stone-500 mb-6">
                                La réglementation applicable dépend de l'effectif total (public + personnel non indispensable).
                                Entrez votre jauge pour déterminer vos obligations.
                            </p>
                            
                            <div class="space-y-4">
                                <div>
                                    <label for="capacityInput" class="block text-sm font-medium text-stone-700">Effectif Total (Personnes)</label>
                                    <input type="number" id="capacityInput" placeholder="Ex: 350" class="mt-1 block w-full rounded-md border-stone-300 bg-stone-50 shadow-sm focus:border-orange-500 focus:ring-orange-500 sm:text-lg p-2 border">
                                </div>
                                <button id="calcBtn" class="w-full flex justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-stone-900 hover:bg-stone-800 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-stone-500">
                                    Analyser la Réglementation
                                </button>
                            </div>

                            <!-- Result Output -->
                            <div id="erpResult" class="hidden mt-6 bg-orange-50 border border-orange-100 rounded-lg p-4">
                                <h4 class="font-bold text-orange-900 text-lg mb-2">Résultat : <span id="resCat">...</span></h4>
                                <ul class="text-sm text-orange-800 space-y-2 list-disc list-inside">
                                    <li><strong>Type :</strong> <span id="resType">L (Salle de spectacle)</span></li>
                                    <li><strong>Obligation Sécurité :</strong> <span id="resSecu">...</span></li>
                                    <li><strong>Contrôle :</strong> <span id="resControl">...</span></li>
                                </ul>
                            </div>
                        </div>

                        <!-- Visualization: Distribution of Venues -->
                        <div class="bg-white p-6 rounded-xl shadow-sm border border-stone-100 flex flex-col">
                            <div class="mb-4">
                                <h3 class="text-lg font-bold text-stone-900">Répartition Théorique des ERP</h3>
                                <p class="text-xs text-stone-500">
                                    Visualisation de la proportion des établissements par catégorie pour situer votre structure. 
                                    La majorité des lieux relèvent de la 5ème catégorie ou des petites jauges.
                                </p>
                            </div>
                            <div style="height: 300px; position: relative;">
                                <canvas id="erpChart"></canvas>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Section 2: Evacuation Simulator -->
                <section id="evacuation" class="scroll-mt-20">
                    <div class="mb-6">
                        <h3 class="text-xl font-bold text-slate-800 flex items-center">
                            <span class="bg-emerald-600 text-white rounded-md w-8 h-8 flex items-center justify-center mr-3 text-sm">2</span>
                            Dégagements & Unités de Passage
                        </h3>
                        <p class="text-stone-600 mt-2 max-w-3xl">
                            Le dimensionnement des sorties (Dégagements) se fait en <strong>Unités de Passage (UP)</strong>. 
                            <br>Règle de base : 1 UP = 0,60 m. Attention, 1 UP seule nécessite 0,90 m de large. 2 UP = 1,40 m.
                            Utilisez le curseur pour simuler une foule et voir les besoins en évacuation.
                        </p>
                    </div>

                    <div class="bg-white p-6 rounded-xl shadow-sm border border-stone-100">
                        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                            <!-- Controls -->
                            <div class="lg:col-span-1 space-y-6">
                                <div>
                                    <label for="evacSlider" class="block text-sm font-bold text-stone-700 mb-2">Simuler l'affluence : <span id="evacValue" class="text-emerald-600 text-lg">500</span> pers.</label>
                                    <input type="range" id="evacSlider" min="0" max="2000" step="50" value="500" class="w-full h-2 bg-stone-200 rounded-lg appearance-none cursor-pointer accent-emerald-600">
                                </div>
                                
                                <div class="grid grid-cols-2 gap-4">
                                    <div class="bg-stone-50 p-3 rounded border border-stone-200 text-center">
                                        <span class="block text-2xl font-bold text-slate-800" id="upResult">6</span>
                                        <span class="text-xs text-stone-500 uppercase">Unités de Passage (UP)</span>
                                    </div>
                                    <div class="bg-stone-50 p-3 rounded border border-stone-200 text-center">
                                        <span class="block text-2xl font-bold text-slate-800" id="widthResult">3.60m</span>
                                        <span class="text-xs text-stone-500 uppercase">Largeur Cumulée Min.</span>
                                    </div>
                                </div>

                                <div class="bg-orange-50 p-4 rounded border-l-4 border-orange-500 text-sm text-orange-900">
                                    <strong>Règle d'Or :</strong> Les dégagements doivent rester libres de tout obstacle et les portes doivent s'ouvrir vers l'extérieur (sens de la fuite).
                                </div>
                            </div>

                            <!-- Line Chart -->
                            <div class="lg:col-span-2">
                                <div style="height: 300px; position: relative;">
                                    <canvas id="evacChart"></canvas>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Section 3: Materials & Fire Reaction -->
                <section id="materials" class="scroll-mt-20">
                    <div class="mb-6">
                        <h3 class="text-xl font-bold text-slate-800 flex items-center">
                            <span class="bg-orange-600 text-white rounded-md w-8 h-8 flex items-center justify-center mr-3 text-sm">3</span>
                            Matériaux & Réaction au Feu
                        </h3>
                        <p class="text-stone-600 mt-2 max-w-3xl">
                            L'objectif est de limiter la masse combustible. Les matériaux sont classés de <strong>M0 (Incombustible)</strong> à <strong>M4 (Facilement Inflammable)</strong>.
                            L'<strong>Ignifugation</strong> permet d'améliorer ce classement. Cliquez sur les segments du graphique pour voir les détails.
                        </p>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-2 gap-8 items-center">
                        <!-- Visual Chart -->
                        <div class="bg-white p-6 rounded-xl shadow-sm border border-stone-100">
                            <div style="height: 300px; position: relative;">
                                <canvas id="materialsChart"></canvas>
                            </div>
                            <div class="mt-4 flex justify-center space-x-4 text-xs">
                                <span class="flex items-center"><span class="w-3 h-3 bg-stone-400 rounded-full mr-1"></span> M0 Structure</span>
                                <span class="flex items-center"><span class="w-3 h-3 bg-emerald-500 rounded-full mr-1"></span> M1 Décors</span>
                                <span class="flex items-center"><span class="w-3 h-3 bg-orange-500 rounded-full mr-1"></span> M2/M3 Mobilier</span>
                            </div>
                        </div>

                        <!-- Contextual Details (Dynamic) -->
                        <div class="space-y-4">
                            <div id="m0-card" class="material-card p-4 rounded-lg border-l-4 border-stone-400 bg-white shadow-sm hover:shadow-md transition cursor-pointer" onclick="highlightMaterial(0)">
                                <div class="flex justify-between items-center">
                                    <h4 class="font-bold text-stone-800">Classement M0</h4>
                                    <span class="text-xs bg-stone-100 px-2 py-1 rounded text-stone-600">Incombustible</span>
                                </div>
                                <p class="text-sm text-stone-600 mt-2">Pierre, brique, ciment, verre, métal. Utilisé pour les structures porteuses.</p>
                            </div>

                            <div id="m1-card" class="material-card p-4 rounded-lg border-l-4 border-emerald-500 bg-emerald-50 shadow-sm hover:shadow-md transition cursor-pointer ring-2 ring-emerald-500" onclick="highlightMaterial(1)">
                                <div class="flex justify-between items-center">
                                    <h4 class="font-bold text-emerald-900">Classement M1</h4>
                                    <span class="text-xs bg-emerald-100 px-2 py-1 rounded text-emerald-700">Non Inflammable</span>
                                </div>
                                <p class="text-sm text-emerald-800 mt-2">Combustible mais ne propage pas le feu. <strong>Obligatoire</strong> pour les décors, rideaux, vélums et pendrillons.</p>
                            </div>

                            <div id="m2-card" class="material-card p-4 rounded-lg border-l-4 border-orange-500 bg-white shadow-sm hover:shadow-md transition cursor-pointer" onclick="highlightMaterial(2)">
                                <div class="flex justify-between items-center">
                                    <h4 class="font-bold text-stone-800">Classement M2</h4>
                                    <span class="text-xs bg-orange-100 px-2 py-1 rounded text-orange-700">Difficilement Inflammable</span>
                                </div>
                                <p class="text-sm text-stone-600 mt-2">Autorisé pour certains sièges capitonnés ou revêtements de sol. Nécessite souvent ignifugation.</p>
                            </div>
                            
                            <div id="m4-card" class="material-card p-4 rounded-lg border-l-4 border-red-500 bg-white shadow-sm hover:shadow-md transition cursor-pointer" onclick="highlightMaterial(3)">
                                <div class="flex justify-between items-center">
                                    <h4 class="font-bold text-stone-800">Classement M3 / M4</h4>
                                    <span class="text-xs bg-red-100 px-2 py-1 rounded text-red-700">Interdit / Risque</span>
                                </div>
                                <p class="text-sm text-stone-600 mt-2">Moyennement à Facilement inflammable. Généralement interdits dans les zones accessibles au public.</p>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Section 4: Human Organization & Definitions -->
                <section id="personnel" class="scroll-mt-20">
                    <div class="mb-6">
                        <h3 class="text-xl font-bold text-slate-800 flex items-center">
                            <span class="bg-slate-600 text-white rounded-md w-8 h-8 flex items-center justify-center mr-3 text-sm">4</span>
                            Personnel & Protocoles
                        </h3>
                        <p class="text-stone-600 mt-2">
                            La sécurité repose avant tout sur les hommes et les procédures. Voici les acteurs et documents clés identifiés dans le rapport source.
                        </p>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                        <!-- Card: SSIAP -->
                        <div class="bg-white rounded-lg p-5 shadow-sm border-t-4 border-slate-800 hover:shadow-md transition">
                            <div class="flex items-center mb-3">
                                <span class="text-2xl mr-3"></span>
                                <h4 class="font-bold text-slate-800">SSIAP</h4>
                            </div>
                            <p class="text-sm text-stone-600 mb-2">Service de Sécurité Incendie et d'Assistance à Personnes.</p>
                            <ul class="text-xs text-stone-500 list-disc list-inside">
                                <li>Présence obligatoire selon catégorie</li>
                                <li>Rondes, alertes, évacuation</li>
                                <li>Formations diplômantes (1, 2, 3)</li>
                            </ul>
                        </div>

                        <!-- Card: Registre -->
                        <div class="bg-white rounded-lg p-5 shadow-sm border-t-4 border-slate-800 hover:shadow-md transition">
                            <div class="flex items-center mb-3">
                                <span class="text-2xl mr-3"></span>
                                <h4 class="font-bold text-slate-800">Registre de Sécurité</h4>
                            </div>
                            <p class="text-sm text-stone-600 mb-2">La "mémoire" de sécurité du bâtiment.</p>
                            <ul class="text-xs text-stone-500 list-disc list-inside">
                                <li>Dates des contrôles techniques</li>
                                <li>Composition du personnel</li>
                                <li>Consignes d'évacuation</li>
                                <li>Consultable par la Commission</li>
                            </ul>
                        </div>

                        <!-- Card: Commission -->
                        <div class="bg-white rounded-lg p-5 shadow-sm border-t-4 border-slate-800 hover:shadow-md transition">
                            <div class="flex items-center mb-3">
                                <span class="text-2xl mr-3">⚖️</span>
                                <h4 class="font-bold text-slate-800">Commission de Sécurité</h4>
                            </div>
                            <p class="text-sm text-stone-600 mb-2">Organisme consultatif d'État.</p>
                            <ul class="text-xs text-stone-500 list-disc list-inside">
                                <li>Valide l'ouverture avant public</li>
                                <li>Visites périodiques (3 à 5 ans)</li>
                                <li>Vérifie accessibilité et incendie</li>
                            </ul>
                        </div>

                        <!-- Card: Plans -->
                        <div class="bg-white rounded-lg p-5 shadow-sm border-t-4 border-orange-500 hover:shadow-md transition">
                            <div class="flex items-center mb-3">
                                <span class="text-2xl mr-3"></span>
                                <h4 class="font-bold text-slate-800">Plans (Intervention vs Évacuation)</h4>
                            </div>
                            <div class="space-y-2">
                                <p class="text-xs bg-stone-50 p-2 rounded"><strong class="text-slate-700">Intervention :</strong> Pour les Pompiers (coupures fluides, accès).</p>
                                <p class="text-xs bg-stone-50 p-2 rounded"><strong class="text-slate-700">Évacuation :</strong> Pour le Public (itinéraires, point de rassemblement).</p>
                            </div>
                        </div>

                        <!-- Card: Rideau de Fer -->
                        <div class="bg-white rounded-lg p-5 shadow-sm border-t-4 border-orange-500 hover:shadow-md transition">
                            <div class="flex items-center mb-3">
                                <span class="text-2xl mr-3"></span>
                                <h4 class="font-bold text-slate-800">Rideau de Fer</h4>
                            </div>
                            <p class="text-sm text-stone-600 mb-2">Dispositif d'obturation de la baie de scène.</p>
                            <p class="text-xs text-stone-500">Isole la cage de scène (risque élevé) de la salle (public) pour permettre l'évacuation sans fumée.</p>
                        </div>

                        <!-- Card: BAES -->
                        <div class="bg-white rounded-lg p-5 shadow-sm border-t-4 border-emerald-500 hover:shadow-md transition">
                            <div class="flex items-center mb-3">
                                <span class="text-2xl mr-3"></span>
                                <h4 class="font-bold text-slate-800">BAES</h4>
                            </div>
                            <p class="text-sm text-stone-600 mb-2">Bloc Autonome d'Éclairage de Sécurité.</p>
                            <ul class="text-xs text-stone-500 list-disc list-inside">
                                <li>Balisage (vers sorties)</li>
                                <li>Ambiance (anti-panique)</li>
                                <li>Fonctionne sur batterie</li>
                            </ul>
                        </div>
                    </div>
                </section>
            </div>
        </div>

        <!-- ONGLET 3 : CTS & MÉTÉO -->
        <div id="cts" class="tab-content">
            <div class="max-w-6xl mx-auto">
                <!-- En-tête -->
                <div class="mb-8">
                    <h2 class="text-3xl font-bold mb-2 text-slate-800">Sécurité Chapiteaux (CTS) & Météo</h2>
                    <p class="text-stone-600 mb-6">
                        L'exploitation d'un chapiteau est soumise à l'Arrêté du 23 janvier 1985. Deux facteurs critiques
                        : la solidité au vent (neige) et la réaction au feu.
                        L'exploitant doit tenir un registre de sécurité et surveiller la météo en permanence.
                    </p>
                </div>

                <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                    <!-- Tool: Wind Calculator -->
                    <div class="bg-white rounded-xl shadow-sm border border-stone-200 p-6">
                        <h3 class="text-lg font-bold text-slate-700 mb-4 flex items-center">
                            <i class="fas fa-wind text-orange-600 mr-3"></i> Simulateur de Décision Météo
                        </h3>
                        <div class="space-y-6">
                            <div>
                                <label class="block text-sm font-medium text-stone-700 mb-2">Vitesse max homologuée (Carnet de bord)</label>
                                <select id="maxWindInput" class="w-full rounded-lg border-stone-300 shadow-sm p-3 border bg-white">
                                    <option value="85">85 km/h (Structures légères)</option>
                                    <option value="100" selected>100 km/h (Standard)</option>
                                    <option value="120">120 km/h (Renforcé)</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-stone-700 mb-2">Vitesse du vent actuelle (Anémomètre)</label>
                                <input type="range" id="currentWindInput" min="0" max="140" value="45" class="w-full h-2 bg-stone-200 rounded-lg appearance-none cursor-pointer accent-blue-600">
                                <div class="flex justify-between text-sm text-stone-500 mt-1">
                                    <span>0 km/h</span>
                                    <span id="currentWindDisplay" class="font-bold text-blue-600 text-lg">45 km/h</span>
                                    <span>140 km/h</span>
                                </div>
                            </div>

                            <!-- Status Indicator -->
                            <div id="weatherStatus" class="bg-green-100 border border-green-200 p-4 rounded-lg flex items-start gap-3 transition-colors duration-300">
                                <div id="weatherIcon" class="text-2xl">✅</div>
                                <div>
                                    <h4 id="weatherTitle" class="font-bold text-green-800">Situation Normale</h4>
                                    <p id="weatherDesc" class="text-sm text-green-700">Exploitation autorisée. Continuez la veille météorologique.</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Data: Wind Chart -->
                    <div class="bg-white rounded-xl shadow-sm border border-stone-200 p-6">
                        <h3 class="text-lg font-bold text-slate-700 mb-4">Échelle de Beaufort & Risques</h3>
                        <div style="height: 300px; position: relative;">
                            <canvas id="windChart"></canvas>
                        </div>
                    </div>
                </div>

                <!-- Checklist -->
                <div class="mt-8 bg-white rounded-xl shadow-sm border border-stone-200 p-6">
                    <h3 class="text-lg font-bold text-slate-700 mb-6">Points de Contrôle Obligatoires (Matin & Soir)</h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div class="flex items-start p-4 bg-stone-50 rounded-lg">
                            <input type="checkbox" class="mt-1 mr-3 h-5 w-5 text-orange-600 rounded border-stone-300">
                            <div>
                                <span class="font-medium text-stone-900">Ancrages et Haubanage</span>
                                <p class="text-sm text-stone-600 mt-1">Vérifier la tension des sangles (cliquets) et la tenue des pieux (pas de soulèvement de terre).</p>
                            </div>
                        </div>
                        <div class="flex items-start p-4 bg-stone-50 rounded-lg">
                            <input type="checkbox" class="mt-1 mr-3 h-5 w-5 text-orange-600 rounded border-stone-300">
                            <div>
                                <span class="font-medium text-stone-900">Issue de Secours</span>
                                <p class="text-sm text-stone-600 mt-1">Déverrouillées, dégagées de tout obstacle, éclairage de sécurité fonctionnel.</p>
                            </div>
                        </div>
                        <div class="flex items-start p-4 bg-stone-50 rounded-lg">
                            <input type="checkbox" class="mt-1 mr-3 h-5 w-5 text-orange-600 rounded border-stone-300">
                            <div>
                                <span class="font-medium text-stone-900">Extincteurs</span>
                                <p class="text-sm text-stone-600 mt-1">En place, plombés, vérifiés annuellement. Accès non bloqué par des décors.</p>
                            </div>
                        </div>
                        <div class="flex items-start p-4 bg-stone-50 rounded-lg">
                            <input type="checkbox" class="mt-1 mr-3 h-5 w-5 text-orange-600 rounded border-stone-300">
                            <div>
                                <span class="font-medium text-stone-900">Installations Électriques</span>
                                <p class="text-sm text-stone-600 mt-1">Coffrets fermés à clé, câbles protégés des passages (passages de câbles).</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ONGLET 4 : FAUNE SAUVAGE -->
        <div id="animals" class="tab-content">
            <div class="max-w-6xl mx-auto">
                <!-- En-tête -->
                <div class="mb-8">
                    <h2 class="text-3xl font-bold mb-2 text-slate-800">Faune Sauvage & Cirque</h2>
                    <p class="text-stone-600 mb-6">
                        La Loi n° 2021-1539 du 30 novembre 2021 visant à lutter contre la maltraitance animale impose
                        une transition majeure pour les cirques itinérants.
                        L'objectif est l'arrêt total de la présentation d'animaux sauvages au public d'ici 2028.
                    </p>
                </div>

                <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                    <div class="lg:col-span-2">
                        <div class="bg-white rounded-xl shadow-sm border border-stone-200 p-6">
                            <h3 class="text-lg font-bold text-slate-700 mb-4">Trajectoire Loi 2021 (Fin des animaux sauvages)</h3>
                            <div style="height: 300px; position: relative;">
                                <canvas id="animalTimelineChart"></canvas>
                            </div>
                        </div>
                    </div>
                    <div class="bg-orange-50 rounded-xl border border-orange-200 p-6">
                        <h3 class="font-bold text-orange-900 text-lg mb-4">Points Clés de la Loi</h3>
                        <ul class="space-y-4 text-sm text-orange-800">
                            <li class="flex items-start">
                                <i class="fas fa-ban text-orange-600 mt-1 mr-3"></i>
                                <span><strong>Interdiction d'acquisition :</strong> Depuis 2023, interdiction
                                    d'acquérir ou de reproduire des animaux sauvages dans les cirques
                                    itinérants.</span>
                            </li>
                            <li class="flex items-start">
                                <i class="fas fa-hand text-orange-600 mt-1 mr-3"></i>
                                <span><strong>Interdiction de représentation :</strong> Au 1er décembre 2028,
                                    interdiction totale de présenter des animaux sauvages au public dans des
                                    établissements itinérants.</span>
                            </li>
                            <li class="flex items-start">
                                <i class="fas fa-truck text-orange-600 mt-1 mr-3"></i>
                                <span><strong>Transport :</strong> Le transport de ces animaux sera également
                                    interdit à cette date, sauf pour rejoindre des refuges.</span>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>

        <!-- ONGLET 5 : LÉGISLATION -->
        <div id="legislation" class="tab-content">
            <div class="max-w-6xl mx-auto">
                <!-- En-tête -->
                <div class="mb-8">
                    <h2 class="text-3xl font-bold mb-2 text-slate-800">Bibliothèque Officielle Légifrance</h2>
                    <p class="text-stone-600 mb-6">
                        Accès direct aux textes consolidés. Utilisez le filtre pour trouver un sujet spécifique (ex:
                        "feu", "bruit", "travail").
                    </p>
                </div>

                <!-- Search Filter -->
                <div class="mb-6 relative">
                    <input type="text" id="linkSearch" placeholder="Filtrer les textes (ex: Sécurité, Travail...)"
                        class="w-full pl-12 pr-4 py-3 rounded-lg border border-stone-300 focus:ring-2 focus:ring-orange-500 focus:border-orange-500 transition-shadow">
                    <i class="fas fa-search absolute left-3 top-3.5 text-stone-400"></i>
                </div>

                <!-- Links Table -->
                <div class="bg-white rounded-xl shadow-sm overflow-hidden border border-stone-200">
                    <table class="min-w-full divide-y divide-stone-200">
                        <thead class="bg-stone-50">
                            <tr>
                                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-stone-500 uppercase tracking-wider">Thème</th>
                                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-stone-500 uppercase tracking-wider">Titre & Référence</th>
                                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-stone-500 uppercase tracking-wider">Mots Clés</th>
                                <th scope="col" class="px-6 py-3 text-right text-xs font-medium text-stone-500 uppercase tracking-wider">Action</th>
                            </tr>
                        </thead>
                        <tbody class="bg-white divide-y divide-stone-200" id="linksTableBody">
                            <!-- Populated by JS -->
                        </tbody>
                    </table>
                    <div id="noResults" class="hidden p-8 text-center text-stone-500">
                        <i class="fas fa-search text-3xl mb-3 text-stone-300"></i>
                        <p>Aucun texte trouvé pour cette recherche.</p>
                    </div>
                </div>

                <!-- Additional Legal Resources -->
                <div class="mt-8 grid grid-cols-1 md:grid-cols-2 gap-6">
                    <!-- Card 1: Code de la Construction -->
                    <div class="bg-white rounded-xl shadow-sm overflow-hidden border border-stone-200 hover:shadow-md transition-shadow">
                        <div class="bg-stone-900 text-white p-4">
                            <div class="flex justify-between items-center">
                                <h3 class="text-lg font-bold">Code Construction (CCH)</h3>
                                <i class="fas fa-landmark"></i>
                            </div>
                        </div>
                        <div class="p-6 space-y-4">
                            <a href="https://www.legifrance.gouv.fr/codes/section_lc/JORFTEXT000000290033/LEGISCTA000020370853/" target="_blank" class="block group">
                                <div class="text-slate-700 font-medium group-hover:text-orange-600">Article R. 123-43</div>
                                <div class="text-sm text-stone-600 mt-1">Base légale pour les établissements de type L et CTS. Définit l'obligation de contrôle.</div>
                            </a>
                            <a href="https://www.legifrance.gouv.fr/codes/article_lc/LEGIARTI000006896227" target="_blank" class="block group">
                                <div class="text-slate-700 font-medium group-hover:text-orange-600">Article R. 123-45</div>
                                <div class="text-sm text-stone-600 mt-1">Rôle de la commission de sécurité.</div>
                            </a>
                        </div>
                    </div>

                    <!-- Card 2: Arrêté GN (Généralités) -->
                    <div class="bg-white rounded-xl shadow-sm overflow-hidden border border-stone-200 hover:shadow-md transition-shadow">
                        <div class="bg-stone-900 text-white p-4">
                            <div class="flex justify-between items-center">
                                <h3 class="text-lg font-bold">Dispositions Générales</h3>
                                <i class="fas fa-file-contract"></i>
                            </div>
                        </div>
                        <div class="p-6 space-y-4">
                            <a href="https://www.legifrance.gouv.fr/loda/id/JORFTEXT000000290033" target="_blank" class="block group">
                                <div class="text-slate-700 font-medium group-hover:text-orange-600">Arrêté du 25 juin 1980</div>
                                <div class="text-sm text-stone-600 mt-1">Règlement de sécurité contre les risques d'incendie et de panique.</div>
                            </a>
                            <div class="text-sm text-stone-600">Articles GN 1 à GN 14 (Classement des établissements).</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ONGLET 6 : PROCÉDURES -->
        <div id="procedures" class="tab-content">
            <div class="max-w-6xl mx-auto">
                <!-- En-tête -->
                <div class="mb-8">
                    <h2 class="text-3xl font-bold mb-2 text-slate-800">Chronologie des Procédures</h2>
                    <p class="text-stone-600 mb-6">De la demande initiale à l'ouverture au public. Cliquez sur les étapes pour voir les détails réglementaires.</p>
                </div>

                <!-- Interactive Timeline Steps -->
                <div class="flex flex-col md:flex-row justify-between items-start md:items-center border-b-2 border-stone-200 mb-8 pb-4 space-y-4 md:space-y-0">
                    <button onclick="updateProcedure(0)" class="proc-btn px-6 py-3 rounded-lg bg-orange-600 text-white font-bold">1. Conception</button>
                    <div class="hidden md:block text-stone-300">➜</div>
                    <button onclick="updateProcedure(1)" class="proc-btn px-6 py-3 rounded-lg bg-stone-200 text-stone-600 font-bold hover:bg-stone-300">2. Implantation</button>
                    <div class="hidden md:block text-stone-300">➜</div>
                    <button onclick="updateProcedure(2)" class="proc-btn px-6 py-3 rounded-lg bg-stone-200 text-stone-600 font-bold hover:bg-stone-300">3. Montage</button>
                    <div class="hidden md:block text-stone-300">➜</div>
                    <button onclick="updateProcedure(3)" class="proc-btn px-6 py-3 rounded-lg bg-stone-200 text-stone-600 font-bold hover:bg-stone-300">4. Contrôle Final</button>
                </div>

                <!-- Dynamic Procedure Content -->
                <div id="procedure-content" class="bg-blue-50 rounded-xl p-6 border border-blue-100 transition-all duration-300 mb-8">
                    <!-- Content injected via JS -->
                </div>

                <h3 class="text-2xl font-bold mb-6 text-slate-800">Tableau Synthétique des Contrôles</h3>
                <div class="bg-white rounded-xl shadow-sm overflow-hidden border border-stone-200">
                    <table class="w-full text-sm text-left">
                        <thead class="bg-stone-100">
                            <tr>
                                <th class="p-4 font-bold text-stone-700">Type de Contrôle</th>
                                <th class="p-4 font-bold text-stone-700">Périodicité</th>
                                <th class="p-4 font-bold text-stone-700">Acteur</th>
                                <th class="p-4 font-bold text-stone-700">Article CTS</th>
                            </tr>
                        </thead>
                        <tbody class="divide-y divide-stone-200">
                            <tr class="hover:bg-stone-50">
                                <td class="p-4 font-medium text-stone-900">Vérification Biennale (validité registre)</td>
                                <td class="p-4">2 ans (6 mois si > 2500 pers ou établissements multiples)</td>
                                <td class="p-4">Organisme Agréé</td>
                                <td class="p-4">CTS 34</td>
                            </tr>
                            <tr class="hover:bg-stone-50">
                                <td class="p-4 font-medium text-stone-900">Inspection Avant Ouverture</td>
                                <td class="p-4">À chaque installation</td>
                                <td class="p-4">Commission de Sécurité (Mairie/Préfet)</td>
                                <td class="p-4">R. 123-45</td>
                            </tr>
                            <tr class="hover:bg-stone-50">
                                <td class="p-4 font-medium text-stone-900">Attestation de bon montage</td>
                                <td class="p-4">À chaque installation</td>
                                <td class="p-4">Technicien Compétent / Exploitant</td>
                                <td class="p-4">CTS 52</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- ONGLET 7 : TECHNIQUE -->
        <div id="technique" class="tab-content">
            <div class="max-w-6xl mx-auto">
                <!-- En-tête -->
                <div class="mb-8">
                    <h2 class="text-3xl font-bold mb-2 text-slate-800">Focus Technique</h2>
                    <p class="text-stone-600 mb-6">Explorez les exigences techniques spécifiques. Les non-conformités sur ces points entraînent un refus d'ouverture.</p>
                </div>

                <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                    <!-- Navigation for Technical Topics -->
                    <div class="space-y-3">
                        <button onclick="showTechDetail('sol')" 
                                class="w-full text-left p-4 rounded-lg bg-white border border-stone-200 hover:border-orange-500 hover:bg-orange-50 font-medium transition-colors flex items-center">
                            <i class="fas fa-anchor text-orange-600 mr-3"></i>
                            Ancrage au Sol
                        </button>
                        <button onclick="showTechDetail('structure')" 
                                class="w-full text-left p-4 rounded-lg bg-white border border-stone-200 hover:border-orange-500 hover:bg-orange-50 font-medium transition-colors flex items-center">
                            <i class="fas fa-industry text-orange-600 mr-3"></i>
                            Charpente & Levage
                        </button>
                        <button onclick="showTechDetail('toile')" 
                                class="w-full text-left p-4 rounded-lg bg-white border border-stone-200 hover:border-orange-500 hover:bg-orange-50 font-medium transition-colors flex items-center">
                            <i class="fas fa-fire text-orange-600 mr-3"></i>
                            Toiles & Feu (M2)
                        </button>
                        <button onclick="showTechDetail('elec')" 
                                class="w-full text-left p-4 rounded-lg bg-white border border-stone-200 hover:border-orange-500 hover:bg-orange-50 font-medium transition-colors flex items-center">
                            <i class="fas fa-bolt text-orange-600 mr-3"></i>
                            Électricité & Chauffage
                        </button>
                    </div>

                    <!-- Content Display Area -->
                    <div class="lg:col-span-2 bg-white rounded-xl shadow-sm p-6 border border-stone-200" id="tech-display">
                        <!-- Default Content -->
                        <div class="h-full flex flex-col justify-center items-center text-center text-stone-400 p-8">
                            <i class="fas fa-mouse-pointer text-4xl mb-4"></i>
                            <p class="text-lg">Sélectionnez un sujet technique à gauche pour voir les détails réglementaires.</p>
                        </div>
                    </div>
                </div>

                <!-- Chart for Wind Resistance -->
                <div class="mt-12 pt-8 border-t border-stone-200">
                    <h3 class="text-2xl font-bold mb-6 text-slate-800">Résistance au Vent (Neige et Vent)</h3>
                    <div class="bg-white rounded-xl shadow-sm p-6 border border-stone-200">
                        <div style="height: 300px; position: relative;">
                            <canvas id="windResistanceChart"></canvas>
                        </div>
                        <p class="mt-4 text-sm text-stone-500">
                            *Graphique illustratif. Les valeurs réelles dépendent de la zone climatique (NV65) et des spécificités du cahier des charges du constructeur validé par le registre de sécurité.
                        </p>
                    </div>
                </div>
            </div>
        </div>

        <!-- ONGLET 8 : OUTILS -->
        <div id="outils" class="tab-content">
            <div class="max-w-6xl mx-auto">
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                    
                    <!-- Checklist -->
                    <div class="bg-white rounded-xl shadow-sm p-6 border border-stone-200">
                        <div class="flex justify-between items-center mb-4">
                            <h2 class="text-xl font-bold text-slate-800">Checklist "Jour J"</h2>
                            <button onclick="resetChecklist()" class="text-sm text-orange-600 hover:text-orange-800 font-medium flex items-center">
                                <i class="fas fa-rotate-right mr-2"></i>Réinitialiser
                            </button>
                        </div>
                        <p class="text-sm text-stone-500 mb-6">Avant l'arrivée de la commission de sécurité.</p>
                        
                        <div class="space-y-4" id="checklist-container">
                            <!-- Generated by JS -->
                        </div>
                    </div>

                    <!-- Glossary -->
                    <div class="bg-white rounded-xl shadow-sm p-6 border border-stone-200">
                        <h2 class="text-xl font-bold text-slate-800 mb-6">Glossaire Technique</h2>
                        <div class="space-y-6 max-h-[500px] overflow-y-auto custom-scroll pr-2">
                            <div class="border-l-4 border-emerald-500 pl-4">
                                <h4 class="font-bold text-sm text-stone-800">Haubans</h4>
                                <p class="text-sm text-stone-600 mt-1">Câbles ou sangles assurant la stabilité latérale des mâts. Doivent être tendus correctement.</p>
                            </div>
                            <div class="border-l-4 border-emerald-500 pl-4">
                                <h4 class="font-bold text-sm text-stone-800">Tirant (Tir-fort)</h4>
                                <p class="text-sm text-stone-600 mt-1">Dispositif mécanique permettant de mettre en tension les câbles. Doit être sécurisé.</p>
                            </div>
                            <div class="border-l-4 border-emerald-500 pl-4">
                                <h4 class="font-bold text-sm text-stone-800">Pinces</h4>
                                <p class="text-sm text-stone-600 mt-1">Éléments de jonction de l'ossature métallique. Doivent toutes être clavetées ou goupillées.</p>
                            </div>
                            <div class="border-l-4 border-emerald-500 pl-4">
                                <h4 class="font-bold text-sm text-stone-800">Extrait du Registre</h4>
                                <p class="text-sm text-stone-600 mt-1">Document résumant les caractéristiques techniques (surface, capacité, résistance vent) indispensable sur site.</p>
                            </div>
                            <div class="border-l-4 border-emerald-500 pl-4">
                                <h4 class="font-bold text-sm text-stone-800">Lestage</h4>
                                <p class="text-sm text-stone-600 mt-1">Poids (béton/eau) utilisé lorsque le piquetage au sol est impossible. Doit être calculé précisément (Note de calcul).</p>
                            </div>
                            <div class="border-l-4 border-emerald-500 pl-4">
                                <h4 class="font-bold text-sm text-stone-800">Barriérage</h4>
                                <p class="text-sm text-stone-600 mt-1">Dispositif empêchant l'accès aux zones techniques (groupe électrogène, soufflerie) et guidant les flux.</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

    </main>

    <!-- Pied de page -->
    <footer class="bg-[#e9ecef] text-[#495057] py-8 mt-12 border-t border-[#dee2e6]">
        <div class="max-w-8xl mx-auto px-6">
            <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
                <div>
                    <h4 class="text-xl font-bold mb-4 text-[#343a40]">Portail de Sécurité CTS & ERP</h4>
                    <p class="text-[#6c757d] text-sm mb-2">
                        Outil professionnel open source destiné aux exploitants, régisseurs et organismes de contrôle
                        des structures itinérantes.
                    </p>

                    <p class="text-[#495057] text-sm font-medium mb-2 mt-4">
                        L'Application ne se substitue pas :
                    </p>
                    <ul class="text-[#6c757d] text-xs space-y-1 mb-4">
                        <li>• Aux textes officiels publiés</li>
                        <li>• À l'avis d'experts certifiés</li>
                        <li>• Aux commissions de sécurité compétentes</li>
                        <li>• À la jurisprudence en vigueur</li>
                    </ul>

                    <p class="text-[#6c757d] text-sm">
                        <small>Mise à jour : 23 décembre 2025</small>
                    </p>
                </div>

                <!-- Deuxième colonne avec bordure gauche -->
                <div class="md:border-l md:border-[] md:pl-8">
                    <h4 class="text-xl font-bold mb-4 text-[#343a40]">Applications Connexes</h4>

                    <div class="space-y-4">

                        <a href="https://fi-regie.github.io/Reglementation-Spectacle-Itinerant/" target="_blank"
                            class="flex items-start text-[#495057] hover:text-[#0d6efd] transition">
                            <i class="fas fa-external-link-alt mr-2 mt-1"></i>
                            <div>
                                <h5> Réglementation Spectacle Itinérant </h5>
                                <p class="text-sm text-[#6c757d] mt-1">
                                    Portail de veille juridique & de sécurité du Spectacle Itinérant
                                </p>
                            </div>
                        </a>

                        <a href="https://fi-regie.github.io/Simulateur-Reglement-Securite-ERP/" target="_blank"
                            class="flex items-start text-[#495057] hover:text-[#0d6efd] transition">
                            <i class="fas fa-external-link-alt mr-2 mt-1"></i>
                            <div>
                                <h5> Outil de Simulation Sécurité </h5>
                                <p class="text-sm text-[#6c757d] mt-1">
                                    Simulez votre Catégorie ERP, vos dégagements UP, Éch. de Beaufort
                                </p>
                            </div>
                        </a>

                        <a href="https://fi-regie.github.io/Guide-de-la-Securite-Incendie/" target="_blank"
                            class="flex items-start text-[#495057] hover:text-[#0d6efd] transition">
                            <i class="fas fa-external-link-alt mr-2 mt-1"></i>
                            <div>
                                <h5> Guide de la Sécurité Incendie</h5>
                                <p class="text-sm text-[#6c757d] mt-1">
                                    Guide complet de la sécurité incendie pour les ERP Type L
                                </p>
                            </div>
                        </a>
                    </div>
                </div>

                <!-- Troisième colonne avec bordure gauche -->
                <div class="md:border-l md:border-[] md:pl-8">
                    <h4 class="text-xl font-bold mb-4 text-[#343a40]">Formation</h4>
                    <div class="space-y-4">
                        <a href="https://fi-regie.github.io/Formation-Securite-ERP/" target="_blank"
                            class="flex items-start text-[#495057] hover:text-[#0d6efd] transition">
                            <i class="fas fa-external-link-alt mr-2 mt-1"></i>
                            <div>
                                <h5> Formation Sécurité ERP</h5>
                                <p class="text-sm text-[#6c757d] mt-1">
                                    Outil pédagogique open source destiné à la formation des responsables techniques
                                    d'ERP Type L
                                </p>
                            </div>
                        </a>

                        <a href="https://fi-regie.github.io/reglementation-CTS-/" target="_blank"
                            class="flex items-start text-[#495057] hover:text-[#0d6efd] transition">
                            <i class="fas fa-external-link-alt mr-2 mt-1"></i>
                            <div>
                                <h5> Règlementation CTS</h5>
                                <p class="text-sm text-[#6c757d] mt-1">
                                    Dispositions applicables aux établissements de type Chapiteaux, Tentes et Structures
                                </p>
                            </div>
                        </a>

                        <a href="https://fi-regie.github.io/Quiz-CTS/" target="_blank"
                            class="flex items-start text-[#495057] hover:text-[#0d6efd] transition">
                            <i class="fas fa-external-link-alt mr-2 mt-1"></i>
                            <div>
                                <h5> Le Quiz du Régisseur</h5>
                                <p class="text-sm text-[#6c757d] mt-1">
                                    Amusez-vous, testez vos connaissances, apprenez...
                                </p>
                            </div>
                        </a>
                    </div>
                </div>
            </div>

            <div class="mt-8 pt-8 border-t border-[#ced4da] text-center text-sm text-[#6c757d]">
                <p>
                    <i class="fas fa-gavel mr-2"></i>
                    Sécurité Structures Itinérantes - CTS & ERP Type L
                </p>
                <p class="mt-2">
                    ©️ Open Source • Partage Contribution : https://github.com/fi-regie • Contact :
                    philippe.potier-regie@proton.me
                </p>
            </div>
        </div>
    </footer>

<script>
        // --- État global ---
        const state = {
            currentView: 'dashboard',
            checklist: {},
            wind: 45,
            maxWind: 100,
            capacity: 450,
            materialFocus: 1
        };

        // --- Navigation Logic ---
        function switchTab(tabId) {
            // Toggle Views
            document.querySelectorAll('.tab-content').forEach(el => el.classList.remove('active'));
            document.getElementById(tabId).classList.add('active');

            // Update Nav Styles
            document.querySelectorAll('.nav-btn').forEach(btn => {
                btn.classList.remove('border-orange-600', 'text-orange-600', 'border-emerald-600', 'text-emerald-600');
                btn.classList.add('border-transparent');
            });

            const activeBtn = document.getElementById('btn-' + tabId);
            if (activeBtn) {
                if (tabId === 'outils') {
                    activeBtn.classList.add('border-emerald-600', 'text-emerald-600');
                } else {
                    activeBtn.classList.add('border-orange-600', 'text-orange-600');
                }
                activeBtn.classList.remove('border-transparent');
            }

            state.currentView = tabId;
        }

        // --- Data & Content ---

        // Regulations Data for Library
        const regulationsData = [
            {
                theme: "ERP / Sécurité",
                title: "Arrêté du 23 janvier 1985 (CTS)",
                desc: "Règlement de sécurité contre les risques d'incendie et de panique dans les ERP de type CTS (Chapiteaux, Tentes et Structures).",
                keywords: ["chapiteau", "tente", "feu", "panique", "évacuation", "toile"],
                url: "https://www.legifrance.gouv.fr/loda/id/JORFTEXT000000874028/"
            },
            {
                theme: "Espace Public",
                title: "Code général de la propriété des personnes publiques",
                desc: "Articles relatifs à l'occupation du domaine public (Autorisation d'Occupation Temporaire).",
                keywords: ["rue", "espace public", "mairie", "redevance", "autorisation", "AOT"],
                url: "https://www.legifrance.gouv.fr/codes/id/LEGITEXT000031366252/"
            },
            {
                theme: "Animaux",
                title: "Loi n° 2021-1539 du 30 nov 2021",
                desc: "Loi visant à lutter contre la maltraitance animale (Interdiction faune sauvage cirque itinérant).",
                keywords: ["animaux", "lion", "tigre", "interdiction", "bien-être", "cirque"],
                url: "https://www.legifrance.gouv.fr/jorf/id/JORFTEXT000044387560/"
            },
            {
                theme: "Travail / Artistes",
                title: "Code du travail - Santé et sécurité",
                desc: "Dispositions générales sur la santé et la sécurité au travail (applicable au montage/démontage).",
                keywords: ["sécurité", "travail", "montage", "équipement", "casque", "chantier"],
                url: "https://www.legifrance.gouv.fr/codes/id/LEGITEXT000006072050/"
            },
            {
                theme: "Bruit / Son",
                title: "Code de la santé publique - Bruit",
                desc: "Réglementation relative à la prévention des risques liés aux bruits et aux sons amplifiés.",
                keywords: ["son", "bruit", "voisinage", "décibel", "concert", "nuisance"],
                url: "https://www.legifrance.gouv.fr/codes/id/LEGITEXT000006072665/"
            },
            {
                theme: "ERP / Général",
                title: "Arrêté du 25 juin 1980",
                desc: "Règlement de sécurité contre les risques d'incendie et de panique dans les ERP (Dispositions Générales).",
                keywords: ["feu", "extincteur", "alarme", "erp", "sécurité", "incendie"],
                url: "https://www.legifrance.gouv.fr/loda/id/JORFTEXT000000510784/"
            },
            {
                theme: "Contrôle Technique",
                title: "Code de la construction et de l'habitation",
                desc: "Articles relatifs aux vérifications techniques obligatoires dans les ERP.",
                keywords: ["contrôle", "bureau de contrôle", "électricité", "levage", "vérification"],
                url: "https://www.legifrance.gouv.fr/codes/id/LEGITEXT000006074096/"
            },
            {
                theme: "Spectacle Vivant",
                title: "Code du travail - Statut des artistes",
                desc: "Dispositions relatives au statut des artistes du spectacle.",
                keywords: ["artiste", "intermittent", "spectacle", "cachet", "contrat"],
                url: "https://www.legifrance.gouv.fr/codes/section_lc/LEGITEXT000006072050/LEGISCTA000006193175"
            },
            {
                theme: "Assurance / Responsabilité",
                title: "Code des assurances",
                desc: "Obligations d'assurance responsabilité civile pour les organisateurs.",
                keywords: ["assurance", "responsabilité", "civile", "RC", "garantie"],
                url: "https://www.legifrance.gouv.fr/codes/id/LEGITEXT000006073984/"
            }
        ];

        // Procedure Steps Data
        const procedureSteps = [
            {
                title: "1. Conception & Demande",
                content: `<h4 class="font-bold text-lg mb-3 text-slate-800">Dossier de Sécurité</h4>
                          <p class="mb-3">L'organisateur doit constituer un dossier comprenant :</p>
                          <ul class="list-disc ml-5 mb-3 space-y-1">
                            <li>Le plan d'implantation (masses, dégagements).</li>
                            <li>L'extrait du registre de sécurité du chapiteau (validité < 2 ans).</li>
                            <li>L'attestation de bon montage (prévisionnelle).</li>
                          </ul>
                          <p class="text-sm italic text-stone-600">Délai : Envoi en Mairie/Préfecture au moins 1 mois avant l'événement.</p>`
            },
            {
                title: "2. Implantation & Sol",
                content: `<h4 class="font-bold text-lg mb-3 text-slate-800">Essais de Sol</h4>
                          <p class="mb-3">Avant tout montage, la résistance du sol doit être vérifiée.</p>
                          <ul class="list-disc ml-5 mb-3 space-y-1">
                             <li>Tests d'arrachement (au dynamomètre) obligatoires sur les types de piquets utilisés.</li>
                             <li>Vérification de l'absence de réseaux souterrains (DICT).</li>
                          </ul>
                          <p class="text-sm italic text-stone-600">Ref: CTS 5 et CTS 52.</p>`
            },
            {
                title: "3. Montage",
                content: `<h4 class="font-bold text-lg mb-3 text-slate-800">Vérifications Techniques</h4>
                          <p class="mb-3">Durant le montage, le technicien compétent vérifie :</p>
                          <ul class="list-disc ml-5 mb-3 space-y-1">
                            <li>La conformité des axes, goupilles et boulons.</li>
                            <li>La tension des haubans et l'absence de poches d'eau sur la toile.</li>
                            <li>La mise à la terre des structures métalliques (CTS 13).</li>
                          </ul>`
            },
            {
                title: "4. Contrôle Final",
                content: `<h4 class="font-bold text-lg mb-3 text-slate-800">Inspection Commission</h4>
                          <p class="mb-3">Avant l'ouverture au public :</p>
                          <ul class="list-disc ml-5 mb-3 space-y-1">
                            <li>Passage de l'organisme de contrôle agréé (délivrance rapport final).</li>
                            <li>Visite de la Commission de Sécurité.</li>
                            <li>Signature de l'Arrêté d'ouverture par le Maire.</li>
                          </ul>`
            }
        ];

        function updateProcedure(index) {
            // Update Content
            document.getElementById('procedure-content').innerHTML = procedureSteps[index].content;
            
            // Update Buttons style
            document.querySelectorAll('.proc-btn').forEach((btn, idx) => {
                if (idx === index) {
                    btn.classList.remove('bg-stone-200', 'text-stone-600');
                    btn.classList.add('bg-orange-600', 'text-white');
                } else {
                    btn.classList.add('bg-stone-200', 'text-stone-600');
                    btn.classList.remove('bg-orange-600', 'text-white');
                }
            });
        }

        // Technical Details Data
        const techDetails = {
            'sol': {
                title: "Ancrage au Sol (CTS 5)",
                html: `<div class="space-y-4">
                        <p class="text-stone-700">La stabilité du chapiteau repose intégralement sur ses ancrages. Les lests ou piquets doivent résister aux efforts calculés par le constructeur.</p>
                        <div class="bg-blue-50 p-4 rounded-lg border border-blue-200">
                            <strong class="text-slate-800">Test d'arrachement :</strong>
                            <p class="text-sm text-stone-600 mt-1">Il est impératif de réaliser des essais d'arrachement sur site avec un dynamomètre certifié. Les résultats doivent être consignés.</p>
                        </div>
                        <div class="bg-yellow-50 p-4 rounded-lg border border-yellow-200">
                            <strong class="text-yellow-800">Point critique :</strong>
                            <p class="text-sm text-yellow-700 mt-1">Ne jamais planter de piquets sans DICT (Déclaration d'Intention de Commencement de Travaux) pour éviter les câbles électriques/gaz.</p>
                        </div>
                       </div>`
            },
            'structure': {
                title: "Charpente, Mâts & Levage (CTS 7-9)",
                html: `<div class="space-y-4">
                        <p class="text-stone-700">L'ossature doit être exempte de déformation. Les mécanismes de levage doivent être sécurisés.</p>
                        <ul class="list-disc ml-5 text-sm space-y-2">
                            <li><strong class="text-slate-800">Goupilles :</strong> Toutes les goupilles doivent être freinées (clips de sécurité).</li>
                            <li><strong class="text-slate-800">Câbles :</strong> Absence de "gendarmes" (fils cassés) ou de corrosion.</li>
                            <li><strong class="text-slate-800">Levage :</strong> Une fois la structure levée, elle doit être sécurisée mécaniquement (pas uniquement par hydraulique).</li>
                        </ul>
                       </div>`
            },
            'toile': {
                title: "Enveloppe & Réaction au Feu (CTS 10-12)",
                html: `<div class="space-y-4">
                        <p class="text-stone-700">Les toiles doivent limiter la propagation du feu.</p>
                        <div class="flex items-center space-x-3 p-3 bg-emerald-50 rounded-lg">
                            <span class="px-3 py-1 bg-emerald-600 text-white font-bold rounded">M2</span>
                            <span class="text-sm text-emerald-800">Classement minimal obligatoire pour les toiles de couverture.</span>
                        </div>
                        <p class="text-sm text-stone-700 mt-2">Pour les éléments de décoration intérieure (vélum, rideaux), le classement <strong class="text-slate-800">M1</strong> est souvent exigé sauf exception.</p>
                        <div class="bg-red-50 p-3 rounded-lg border border-red-200">
                            <p class="text-sm font-bold text-red-700">Attention : L'attestation de classement au feu doit être présentée lors du contrôle.</p>
                        </div>
                       </div>`
            },
            'elec': {
                title: "Installations Électriques & Chauffage (CTS 13-28)",
                html: `<div class="space-y-4">
                        <p class="text-stone-700">Les risques de court-circuit et d'incendie sont majeurs sous chapiteau.</p>
                        <ul class="list-disc ml-5 text-sm space-y-2">
                            <li><strong class="text-slate-800">Liaison équipotentielle :</strong> Toute la structure métallique doit être reliée à la terre.</li>
                            <li><strong class="text-slate-800">Blocs de Secours (BAES) :</strong> Obligatoires pour baliser les sorties.</li>
                            <li><strong class="text-slate-800">Chauffage :</strong> Les générateurs d'air chaud doivent être à l'extérieur (distance sécu > 5m) avec gaines ininflammables (M0/M1).</li>
                        </ul>
                       </div>`
            }
        };

        function showTechDetail(key) {
            const data = techDetails[key];
            const display = document.getElementById('tech-display');
            display.innerHTML = `
                <h3 class="text-xl font-bold text-orange-600 mb-6">${data.title}</h3>
                ${data.html}
            `;
        }

        // Checklist Data
        const checklistItems = [
            "Extrait du registre de sécurité présent sur site",
            "Rapport de vérification des installations électriques (sans réserves)",
            "Rapport de vérification des moyens de secours (extincteurs)",
            "Certificats de classement au feu (M1/M2) des toiles",
            "Attestation de bon montage signée",
            "Issues de secours dégagées et signalées",
            "Blocs de sécurité (BAES) fonctionnels",
            "Liaison équipotentielle (Mise à la terre) connectée",
            "Ancrages vérifiés (goupilles, tensions)"
        ];

        function initChecklist() {
            const container = document.getElementById('checklist-container');
            container.innerHTML = '';
            checklistItems.forEach((item, index) => {
                const checked = localStorage.getItem(`cts_check_${index}`) === 'true' ? 'checked' : '';
                container.innerHTML += `
                    <div class="flex items-start p-3 bg-stone-50 rounded-lg hover:bg-stone-100 transition">
                        <input type="checkbox" id="check-${index}" class="mt-1 h-5 w-5 text-orange-600 rounded border-stone-300 focus:ring-orange-500" ${checked} onchange="toggleCheck(${index})">
                        <label for="check-${index}" class="ml-3 text-sm text-stone-700 select-none cursor-pointer">${item}</label>
                    </div>
                `;
            });
        }

        function toggleCheck(index) {
            const checkbox = document.getElementById(`check-${index}`);
            localStorage.setItem(`cts_check_${index}`, checkbox.checked);
        }

        function resetChecklist() {
            checklistItems.forEach((_, index) => localStorage.removeItem(`cts_check_${index}`));
            initChecklist();
        }

        // --- Wind Calculator Logic ---
        function setupWindCalculator() {
            const slider = document.getElementById('currentWindInput');
            const display = document.getElementById('currentWindDisplay');
            const maxSelect = document.getElementById('maxWindInput');

            const update = () => {
                const current = parseInt(slider.value);
                const max = parseInt(maxSelect.value);

                display.innerText = current + " km/h";

                const statusBox = document.getElementById('weatherStatus');
                const icon = document.getElementById('weatherIcon');
                const title = document.getElementById('weatherTitle');
                const desc = document.getElementById('weatherDesc');

                // Logic for thresholds (Standard CTS heuristic)
                const warningThreshold = max * 0.75; // Pre-alert at 75%

                statusBox.className = "p-4 rounded-lg flex items-start gap-3 transition-colors duration-300 border";

                if (current >= max) {
                    // DANGER / EVACUATION
                    statusBox.classList.add('bg-red-100', 'border-red-200');
                    icon.innerText = "🚨";
                    title.innerText = "ÉVACUATION IMMÉDIATE";
                    title.className = "font-bold text-red-800";
                    desc.innerText = `Vent supérieur à la limite (${max} km/h). Affalement de la structure ou évacuation du public requis.`;
                    desc.className = "text-sm text-red-700";
                } else if (current >= warningThreshold) {
                    // WARNING
                    statusBox.classList.add('bg-orange-100', 'border-orange-200');
                    icon.innerText = "⚠️";
                    title.innerText = "Vigilance Renforcée";
                    title.className = "font-bold text-orange-800";
                    desc.innerText = `Vent à >75% de la limite. Préparez l'évacuation. Vérifiez les ancrages. Arrêt des effets scéniques aériens.`;
                    desc.className = "text-sm text-orange-700";
                } else {
                    // OK
                    statusBox.classList.add('bg-green-100', 'border-green-200');
                    icon.innerText = "✅";
                    title.innerText = "Situation Normale";
                    title.className = "font-bold text-green-800";
                    desc.innerText = "Vitesse de vent admissible. Exploitation autorisée sous surveillance.";
                    desc.className = "text-sm text-green-700";
                }
            };

            slider.addEventListener('input', update);
            maxSelect.addEventListener('change', update);

            // Initial update
            update();
        }

        // --- Link Filter Logic ---
        function renderLinksTable(data) {
            const tbody = document.getElementById('linksTableBody');
            tbody.innerHTML = '';

            if (data.length === 0) {
                document.getElementById('noResults').classList.remove('hidden');
                return;
            } else {
                document.getElementById('noResults').classList.add('hidden');
            }

            data.forEach(item => {
                const tr = document.createElement('tr');
                tr.className = "hover:bg-stone-50 transition-colors";
                tr.innerHTML = `
                    <td class="px-6 py-4 whitespace-nowrap">
                        <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-stone-100 text-stone-800">
                            ${item.theme}
                        </span>
                    </td>
                    <td class="px-6 py-4">
                        <div class="text-sm font-bold text-stone-900">${item.title}</div>
                        <div class="text-sm text-stone-600">${item.desc}</div>
                    </td>
                    <td class="px-6 py-4">
                        <div class="flex flex-wrap gap-1">
                            ${item.keywords.map(k => `<span class="text-xs text-stone-400 border border-stone-200 rounded px-1">${k}</span>`).join('')}
                        </div>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-right text-sm font-medium">
                        <a href="${item.url}" target="_blank" class="text-orange-600 hover:text-orange-800 font-bold hover:underline flex items-center justify-end">
                            Voir <i class="fas fa-external-link-alt ml-2 text-xs"></i>
                        </a>
                    </td>
                `;
                tbody.appendChild(tr);
            });
        }

        function setupSearch() {
            const input = document.getElementById('linkSearch');
            input.addEventListener('input', (e) => {
                const term = e.target.value.toLowerCase();
                const filtered = regulationsData.filter(item =>
                    item.title.toLowerCase().includes(term) ||
                    item.desc.toLowerCase().includes(term) ||
                    item.keywords.some(k => k.toLowerCase().includes(term)) ||
                    item.theme.toLowerCase().includes(term)
                );
                renderLinksTable(filtered);
            });
        }

        // --- Charts Implementation ---
        function initCharts() {
            Chart.defaults.font.family = "'Inter', sans-serif";

            // 1. Dashboard Overview (Doughnut)
            new Chart(document.getElementById('inspectionChart'), {
                type: 'doughnut',
                data: {
                    labels: ['Sécurité Incendie (ERP)', 'Solidité / Vent (CTS)', 'Administratif (Mairie)', 'Droit du Travail', 'Animaux / Nature'],
                    datasets: [{
                        data: [35, 25, 20, 15, 5],
                        backgroundColor: ['#dc2626', '#ea580c', '#334155', '#78716c', '#d97706'],
                        borderWidth: 0
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'right'
                        }
                    }
                }
            });

            // 2. Wind Scale (Bar)
            new Chart(document.getElementById('windChart'), {
                type: 'bar',
                data: {
                    labels: ['Calme (0-50)', 'Vigilance (50-85)', 'Danger (85-100)', 'Critique (100+)'],
                    datasets: [{
                        label: 'Risque Structurel',
                        data: [10, 40, 80, 100],
                        backgroundColor: ['#10B981', '#FBBF24', '#F97316', '#EF4444'],
                        borderRadius: 4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            display: false,
                            max: 100
                        },
                        x: {
                            grid: { display: false }
                        }
                    },
                    plugins: {
                        legend: { display: false },
                        tooltip: {
                            callbacks: {
                                label: (ctx) => {
                                    const descs = [
                                        "Exploitation normale",
                                        "Surveillance ancrages requise",
                                        "Préparez évacuation",
                                        "Affalement toile / Fuite"
                                    ];
                                    return descs[ctx.dataIndex];
                                }
                            }
                        }
                    }
                }
            });

            // 3. Animal Timeline (Line/Scatter Hybrid)
            new Chart(document.getElementById('animalTimelineChart'), {
                type: 'line',
                data: {
                    labels: ['2021', '2023', '2025', '2028'],
                    datasets: [{
                        label: 'Niveau de Restriction',
                        data: [0, 30, 60, 100],
                        borderColor: '#ea580c',
                        backgroundColor: 'rgba(234, 88, 12, 0.1)',
                        fill: true,
                        tension: 0.3,
                        pointRadius: 6,
                        pointBackgroundColor: '#fff',
                        pointBorderColor: '#ea580c',
                        pointBorderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            display: true,
                            title: {
                                display: true,
                                text: '% Interdiction'
                            },
                            max: 100
                        }
                    },
                    plugins: {
                        tooltip: {
                            callbacks: {
                                label: (ctx) => {
                                    const events = {
                                        '2021': 'Promulgation Loi',
                                        '2023': 'Interdiction Reproduction/Acquisition',
                                        '2025': 'Transition...',
                                        '2028': 'INTERDICTION TOTALE'
                                    };
                                    return events[ctx.label] || '';
                                }
                            }
                        }
                    }
                }
            });

            // 4. Wind Resistance Chart
            new Chart(document.getElementById('windResistanceChart'), {
                type: 'bar',
                data: {
                    labels: ['Ouverture Public', 'Structure Renforcée', 'Norme NV65 (Moyenne)'],
                    datasets: [{
                        label: 'Vitesse de Vent (km/h)',
                        data: [100, 120, 140],
                        backgroundColor: ['#dc2626', '#ea580c', '#57534e'],
                        borderRadius: 4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: { 
                            beginAtZero: true, 
                            title: { 
                                display: true, 
                                text: 'Vitesse (km/h)' 
                            } 
                        }
                    },
                    plugins: {
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return context.raw + ' km/h - Seuil Critique';
                                }
                            }
                        }
                    }
                }
            });

            // 5. ERP Classification Chart
            new Chart(document.getElementById('erpChart'), {
                type: 'doughnut',
                data: {
                    labels: ['Cat 5 (<50)', 'Cat 4 (51-300)', 'Cat 3 (301-700)', 'Cat 2 (701-1500)', 'Cat 1 (>1500)'],
                    datasets: [{
                        data: [40, 35, 15, 7, 3],
                        backgroundColor: [
                            '#fbbf24',
                            '#f97316',
                            '#ea580c',
                            '#dc2626',
                            '#991b1b'
                        ],
                        borderWidth: 1,
                        borderColor: '#fff'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'right',
                            labels: {
                                usePointStyle: true,
                                font: { size: 10 },
                                padding: 15
                            }
                        },
                        title: {
                            display: true,
                            text: 'Distribution par Catégorie',
                            font: { size: 14 }
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const label = context.label || '';
                                    const value = context.parsed || 0;
                                    return `${label}: ${value}%`;
                                }
                            }
                        }
                    },
                    cutout: '50%'
                }
            });

            // 6. Evacuation Chart
            const population = [0, 100, 300, 500, 700, 1000, 1500, 2000];
            const widths = population.map(p => (Math.ceil(p/100) * 0.60));

            new Chart(document.getElementById('evacChart'), {
                type: 'line',
                data: {
                    labels: population,
                    datasets: [{
                        label: 'Largeur requise (m)',
                        data: widths,
                        borderColor: '#059669',
                        backgroundColor: '#05966920',
                        fill: true,
                        tension: 0.1,
                        pointRadius: 4,
                        pointBackgroundColor: '#fff',
                        pointBorderColor: '#059669'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return context.parsed.y.toFixed(2) + ' mètres de large';
                                }
                            }
                        }
                    },
                    scales: {
                        x: { title: { display: true, text: 'Public (Personnes)' } },
                        y: { title: { display: true, text: 'Largeur Cumulée (m)' } }
                    }
                }
            });

            // 7. Materials Chart
            new Chart(document.getElementById('materialsChart'), {
                type: 'doughnut',
                data: {
                    labels: ['M0 (Structure)', 'M1 (Décors)', 'M2 (Mobilier)', 'M3/M4 (Interdit)'],
                    datasets: [{
                        data: [20, 50, 20, 10],
                        backgroundColor: ['#a8a29e', '#10b981', '#f97316', '#ef4444'],
                        borderWidth: 0,
                        hoverOffset: 10
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { position: 'bottom', labels: { usePointStyle: true, font: { size: 10 } } },
                        title: { display: true, text: 'Répartition de Sécurité Idéale' }
                    },
                    cutout: '60%'
                }
            });
        }

        // --- Section 1: ERP Classification Logic ---
        function calculateERP() {
            const capacityInput = document.getElementById('capacityInput');
            const capacity = parseInt(capacityInput.value);
            
            if (isNaN(capacity) || capacity < 0) {
                alert("Veuillez entrer un nombre valide pour l'effectif total.");
                capacityInput.focus();
                return;
            }

            let category, security, control;
            
            // Détermination de la catégorie basée sur les seuils réglementaires
            if (capacity > 1500) {
                category = "1ère Catégorie";
                security = "SSIAP 1, 2 et 3 requis en permanence";
                control = "Visites périodiques rapprochées (tous les ans)";
            } else if (capacity > 700) {
                category = "2ème Catégorie";
                security = "SSIAP selon planning d'occupation";
                control = "Visites périodiques tous les 3 ans";
            } else if (capacity > 300) {
                category = "3ème Catégorie";
                security = "SSIAP pendant les représentations";
                control = "Visites périodiques tous les 3-5 ans";
            } else if (capacity > 50) {
                category = "4ème Catégorie";
                security = "Personnel formé aux consignes d'évacuation";
                control = "Visites périodiques tous les 5 ans";
            } else {
                category = "5ème Catégorie";
                security = "Consignes de sécurité affichées";
                control = "Contrôles allégés sauf signalement";
            }

            // Mise à jour de l'interface
            document.getElementById('resCat').textContent = category;
            document.getElementById('resSecu').textContent = security;
            document.getElementById('resControl').textContent = control;
            
            // Affichage du résultat
            document.getElementById('erpResult').classList.remove('hidden');

            // Mettre à jour le graphique avec un point de repère
            highlightERPChart(capacity);
        }

        function highlightERPChart(capacity) {
            // Déterminer l'index de la catégorie pour mettre en évidence
            let categoryIndex;
            if (capacity > 1500) categoryIndex = 4;
            else if (capacity > 700) categoryIndex = 3;
            else if (capacity > 300) categoryIndex = 2;
            else if (capacity > 50) categoryIndex = 1;
            else categoryIndex = 0;

            // On pourrait mettre à jour le graphique, mais pour l'instant on garde statique
        }

        // --- Section 2: Evacuation Logic ---
        function updateEvacuation(val) {
            document.getElementById('evacValue').textContent = val;
            
            let ups = Math.ceil(val / 100);
            if(ups < 2 && val > 19) ups = 2;
            
            let width = (ups * 0.60).toFixed(2);

            document.getElementById('upResult').textContent = ups;
            document.getElementById('widthResult').textContent = width + "m";
        }

        // --- Section 4: Materials Logic ---
        function highlightMaterial(index) {
            // Reset styles
            document.querySelectorAll('.material-card').forEach(el => {
                el.classList.remove('ring-2', 'ring-emerald-500', 'bg-emerald-50', 'ring-slate-400', 'bg-stone-50');
                el.classList.add('bg-white');
            });

            // Highlight selected
            const ids = ['m0-card', 'm1-card', 'm2-card', 'm4-card'];
            const selected = document.getElementById(ids[index]);
            selected.classList.remove('bg-white');
            
            const colors = ['slate', 'emerald', 'orange', 'red'];
            selected.classList.add(`bg-${colors[index]}-50`, 'ring-2', `ring-${colors[index]}-400`);
        }

        // --- Initialization ---
        document.addEventListener('DOMContentLoaded', () => {
            initCharts();
            initChecklist();
            updateProcedure(0);
            showTechDetail('sol');
            setupWindCalculator();
            renderLinksTable(regulationsData);
            setupSearch();
            
            // Initial calculations
            updateEvacuation(500);

            // Listeners for simulation tab
            document.getElementById('calcBtn').addEventListener('click', calculateERP);
            document.getElementById('capacityInput').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    calculateERP();
                }
            });

            document.getElementById('evacSlider').addEventListener('input', (e) => {
                updateEvacuation(parseInt(e.target.value));
            });

            // CTS Wind listeners
            document.getElementById('maxWindInput').addEventListener('change', setupWindCalculator);
            document.getElementById('currentWindInput').addEventListener('input', (e) => {
                const windSpeed = parseInt(e.target.value);
                document.getElementById('currentWindDisplay').textContent = windSpeed + ' km/h';
                state.currentWindSpeed = windSpeed;
                setupWindCalculator();
            });
            
            // Set initial active tab
            switchTab('dashboard');
        });

    </script>
</body>
</html>
