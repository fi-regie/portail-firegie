<!DOCTYPE html>
<html lang="fr">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>R√©glementation S√©curit√© : Chapiteaux & Structures (CTS) - 2026</title>

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <!-- SweetAlert2 -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'stone': {
                            50: '#fafaf9',
                            100: '#f5f5f4',
                            200: '#e7e5e4',
                            300: '#d6d3d1',
                            400: '#a8a29e',
                            500: '#78716c',
                            600: '#57534e',
                            700: '#44403c',
                            800: '#292524',
                            900: '#1c1917',
                        },
                        'orange': {
                            600: '#ea580c',
                        },
                        'emerald': {
                            600: '#059669',
                        },
                        'slate': {
                            700: '#334155',
                        }
                    },
                    fontFamily: {
                        'sans': ['Inter', 'system-ui', 'sans-serif'],
                    }
                }
            }
        }
    </script>

    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #fafaf9 !important;
        }

        .tab-content {
            display: none;
            animation: fadeInUp 0.4s ease-out;
        }

        .tab-content.active {
            display: block;
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .custom-scroll::-webkit-scrollbar {
            width: 8px;
        }

        .custom-scroll::-webkit-scrollbar-track {
            background: #f1f1f1;
        }

        .custom-scroll::-webkit-scrollbar-thumb {
            background: #cbd5e1;
            border-radius: 4px;
        }

        .custom-scroll::-webkit-scrollbar-thumb:hover {
            background: #94a3b8;
        }

        .no-scrollbar::-webkit-scrollbar {
            display: none;
        }

        .no-scrollbar {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }

        .progress-bar {
            height: 0.5rem;
            border-radius: 0.25rem;
            background-color: #e5e7eb;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background-color: #ea580c;
            transition: width 0.3s ease;
        }

        .hover-lift {
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }

        .hover-lift:hover {
            transform: translateY(-4px);
            box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1);
        }

        [data-tooltip] {
            position: relative;
        }

        [data-tooltip]:hover::before {
            content: attr(data-tooltip);
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            padding: 0.5rem 0.75rem;
            background-color: #1f2937;
            color: white;
            border-radius: 0.375rem;
            font-size: 0.75rem;
            white-space: nowrap;
            z-index: 10;
        }

        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 60px;
            height: 34px;
        }

        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .4s;
            border-radius: 34px;
        }

        .toggle-slider:before {
            position: absolute;
            content: "";
            height: 26px;
            width: 26px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }

        input:checked+.toggle-slider {
            background-color: #059669;
        }

        input:checked+.toggle-slider:before {
            transform: translateX(26px);
        }
    </style>
</head>

<body class="bg-stone-50 text-stone-800 font-sans antialiased">

    <!-- Navigation / Header -->
    <nav class="bg-white border-b border-stone-200 sticky top-0 z-50 shadow-sm">
        <div class="max-w-8xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between h-16">
                <div class="flex items-center">
                    <span class="text-2xl mr-2"></span>
                    <h1 class="text-xl font-bold tracking-tight text-slate-700">L√©gislation Structures Itin√©rantes
                        <span class="text-orange-600 text-sm font-normal uppercase ml-2 tracking-widest">Chapiteaux
                            Tentes & Structures</span>
                    </h1>
                </div>
                <div class="flex items-center space-x-4">
                    <button
                        onclick="window.location.href='https://fi-regie.github.io/portail-firegie/index.html#accueil';"
                        class="text-sm text-stone-500 hover:text-orange-600 transition flex items-center hidden sm:inline-flex">
                        <i class="fas fa-arrow-left mr-2"></i>
                        Retour au Portail
                    </button>
                    <div class="h-3 w-3 rounded-full bg-emerald-500 animate-pulse" title="Application active"></div>
                </div>
            </div>
        </div>
    </nav>

    <!-- Navigation professionnelle -->
    <div class="bg-white border-b border-gray-200 sticky top-0 z-40">
        <div class="max-w-8xl mx-auto">
            <nav class="flex overflow-x-auto no-scrollbar px-4">
                <button onclick="switchTab('dashboard')"
                    class="nav-btn px-4 py-3 border-b-2 border-transparent hover:border-orange-600 hover:text-orange-600 whitespace-nowrap flex items-center"
                    id="btn-dashboard">
                    <i class="fas fa-home mr-2"></i>Tableau de Bord
                </button>
                <!-- NOUVEL ONGLET 1 -->
                <button onclick="switchTab('calculs')"
                    class="nav-btn px-4 py-3 border-b-2 border-transparent hover:border-orange-600 hover:text-orange-600 whitespace-nowrap flex items-center"
                    id="btn-calculs">
                    <i class="fas fa-calculator mr-2"></i>Calculs & Simulations
                </button>
                <!-- NOUVEL ONGLET 2 -->
                <button onclick="switchTab('controle')"
                    class="nav-btn px-4 py-3 border-b-2 border-transparent hover:border-orange-600 hover:text-orange-600 whitespace-nowrap flex items-center"
                    id="btn-controle">
                    <i class="fas fa-clipboard-check mr-2"></i>Contr√¥le & Inspection
                </button>
                <!-- NOUVEL ONGLET 3 -->
                <button onclick="switchTab('documents')"
                    class="nav-btn px-4 py-3 border-b-2 border-transparent hover:border-orange-600 hover:text-orange-600 whitespace-nowrap flex items-center"
                    id="btn-documents">
                    <i class="fas fa-folder-open mr-2"></i>Documents
                </button>
                <button onclick="switchTab('cts')"
                    class="nav-btn px-4 py-3 border-b-2 border-transparent hover:border-orange-600 hover:text-orange-600 whitespace-nowrap flex items-center"
                    id="btn-cts">
                    <i class="fas fa-wind mr-2"></i>CTS & M√©t√©o
                </button>
                <button onclick="switchTab('animals')"
                    class="nav-btn px-4 py-3 border-b-2 border-transparent hover:border-orange-600 hover:text-orange-600 whitespace-nowrap flex items-center"
                    id="btn-animals">
                    <i class="fas fa-paw mr-2"></i>Faune Sauvage
                </button>
                <button onclick="switchTab('legislation')"
                    class="nav-btn px-4 py-3 border-b-2 border-transparent hover:border-orange-600 hover:text-orange-600 whitespace-nowrap flex items-center"
                    id="btn-legislation">
                    <i class="fas fa-scale-balanced mr-2"></i>L√©gislation
                </button>
                <button onclick="switchTab('procedures')"
                    class="nav-btn px-4 py-3 border-b-2 border-transparent hover:border-orange-600 hover:text-orange-600 whitespace-nowrap flex items-center"
                    id="btn-procedures">
                    <i class="fas fa-clock-rotate-left mr-2"></i>Proc√©dures
                </button>
                <button onclick="switchTab('technique')"
                    class="nav-btn px-4 py-3 border-b-2 border-transparent hover:border-orange-600 hover:text-orange-600 whitespace-nowrap flex items-center"
                    id="btn-technique">
                    <i class="fas fa-gears mr-2"></i>Focus Technique
                </button>
                <button onclick="switchTab('outils')"
                    class="nav-btn px-4 py-3 border-b-2 border-transparent hover:border-emerald-600 hover:text-emerald-600 whitespace-nowrap flex items-center"
                    id="btn-outils">
                    <i class="fas fa-toolbox mr-2"></i>Outils
                </button>
            </nav>
        </div>
    </div>

    <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">

        <!-- ONGLET 1 : TABLEAU DE BORD MIS √Ä JOUR 2026 -->
        <div id="dashboard" class="tab-content active">
            <!-- Bloc d'introduction harmonis√© -->
            <div class="bg-white rounded-xl shadow-sm border border-stone-100 p-6 md:p-8 mb-8">
                <h2 class="text-2xl font-semibold mb-4 text-slate-700">Guide R√©glementaire Chapiteaux Tentes &
                    Structures (CTS)</h2>
                <p class="text-stone-600 leading-relaxed mb-6">
                    Ce portail interactif synth√©tise les obligations r√©glementaires pour les ERP de type L, CTS et
                    structures itin√©rantes.
                    Il int√®gre les <strong>r√©formes majeures de 2026</strong> modifiant le r√®glement de s√©curit√© du 23
                    janvier 1985.
                </p>

                <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mt-6">
                    <div class="bg-stone-50 p-4 rounded-lg border-l-4 border-orange-500">
                        <span class="block text-xs font-bold text-stone-400 uppercase tracking-wider mb-1">Cadre
                            G√©n√©ral</span>
                        <span class="font-medium">ERP Type L</span>
                        <p class="text-sm text-stone-600 mt-1">Installations fixes ou provisoires accueillant du public
                            pour des spectacles.</p>
                    </div>
                    <div class="bg-stone-50 p-4 rounded-lg border-l-4 border-slate-600">
                        <span
                            class="block text-xs font-bold text-stone-400 uppercase tracking-wider mb-1">R√©glementation
                            Sp√©cifique</span>
                        <span class="font-medium">CTS</span>
                        <p class="text-sm text-stone-600 mt-1">R√®glement sp√©cifique (Arr√™t√© du 23 janvier 1985) pour les
                            √©tablissements itin√©rants.</p>
                    </div>
                    <div class="bg-stone-50 p-4 rounded-lg border-l-4 border-emerald-500">
                        <span class="block text-xs font-bold text-stone-400 uppercase tracking-wider mb-1">V√©rification
                            Obligatoire</span>
                        <span class="font-medium">Contr√¥le</span>
                        <p class="text-sm text-stone-600 mt-1">Obligation de v√©rification par des organismes agr√©√©s
                            (BVCTS) avant ouverture.</p>
                    </div>
                </div>
            </div>

            <!-- Banni√®re d'alerte r√©forme 2026 -->
            <div class="mb-8">
                <div
                    class="bg-gradient-to-r from-orange-600 to-red-600 rounded-xl shadow-lg border-l-8 border-red-700 p-6 text-white">
                    <div class="flex flex-col md:flex-row items-center justify-between">
                        <div class="flex-1">
                            <div class="flex items-center mb-3">
                                <i class="fas fa-triangle-exclamation text-2xl mr-3"></i>
                                <h2 class="text-2xl font-bold">R√âFORME 2026 EN VIGUEUR</h2>
                            </div>
                            <p class="text-orange-100 mb-2">
                                Les arr√™t√©s de 2025 modifiant le r√®glement de s√©curit√© du 25 juin 1980 sont d√©sormais
                                applicables.
                                Derni√®re mise √† jour : <strong>Janvier 2026</strong>
                            </p>
                            <p class="text-sm text-orange-200">
                                Impacts majeurs sur la ventilation, le d√©senfumage et la signal√©tique des ERP Type L et
                                CTS.
                            </p>
                        </div>
                        <div class="mt-4 md:mt-0 md:ml-6">
                            <span
                                class="inline-block bg-white text-orange-700 px-4 py-2 rounded-lg font-bold text-lg animate-pulse">
                                2026
                            </span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Section principale - Vue d'ensemble 2026 -->
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-8 mb-8">
                <!-- Carte 1 : Nouveaut√©s r√©glementaires -->
                <div class="bg-white rounded-xl shadow-sm border border-stone-200 p-6 lg:col-span-2">
                    <div class="flex items-center justify-between mb-6">
                        <h2 class="text-2xl font-bold text-slate-800">√âvolutions R√©glementaires 2025-2026</h2>
                        <span
                            class="bg-orange-100 text-orange-800 text-xs font-bold px-3 py-1 rounded-full">ACTUALIT√â</span>
                    </div>

                    <div class="space-y-6">
                        <!-- Timeline simplifi√©e -->
                        <div class="relative">
                            <div class="absolute left-0 top-0 bottom-0 w-1 bg-stone-200 ml-6"></div>

                            <!-- Item 1 -->
                            <div class="flex items-start mb-8">
                                <div
                                    class="z-10 bg-emerald-600 text-white rounded-full w-12 h-12 flex items-center justify-center font-bold mr-4">
                                    29/07
                                </div>
                                <div class="flex-1 bg-emerald-50 p-4 rounded-lg border border-emerald-200">
                                    <h3 class="font-bold text-emerald-900 mb-1">Arr√™t√© du 29 juillet 2025</h3>
                                    <p class="text-sm text-emerald-800 mb-2">D√©senfumage & Traitement d'air</p>
                                    <p class="text-xs text-stone-600">Actualisation des r√®gles techniques de d√©senfumage
                                        m√©canique. Entr√©e en vigueur imm√©diate.</p>
                                </div>
                            </div>

                            <!-- Item 2 -->
                            <div class="flex items-start mb-8">
                                <div
                                    class="z-10 bg-orange-600 text-white rounded-full w-12 h-12 flex items-center justify-center font-bold mr-4">
                                    01/09
                                </div>
                                <div class="flex-1 bg-orange-50 p-4 rounded-lg border border-orange-200">
                                    <h3 class="font-bold text-orange-900 mb-1">Arr√™t√© du 1er septembre 2025</h3>
                                    <p class="text-sm text-orange-800 mb-2">Articles CH - Chauffage & Ventilation</p>
                                    <p class="text-xs text-stone-600">Refonte des dispositions relatives aux
                                        installations de chauffage et ventilation. Application au 1er janvier 2026.</p>
                                </div>
                            </div>

                            <!-- Item 3 -->
                            <div class="flex items-start">
                                <div
                                    class="z-10 bg-slate-700 text-white rounded-full w-12 h-12 flex items-center justify-center font-bold mr-4">
                                    01/12
                                </div>
                                <div class="flex-1 bg-slate-50 p-4 rounded-lg border border-slate-200">
                                    <h3 class="font-bold text-slate-900 mb-1">Arr√™t√© du 1er d√©cembre 2025</h3>
                                    <p class="text-sm text-slate-800 mb-2">Livre III & Signal√©tique</p>
                                    <p class="text-xs text-stone-600">R√©forme des petits √©tablissements. Obligation
                                        d'affichage des plans sch√©matiques √† l'entr√©e.</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Carte 2 : Points critiques CTS -->
                <div class="bg-white rounded-xl shadow-sm border border-stone-200 p-6">
                    <h3 class="text-xl font-bold text-slate-800 mb-6">Vigilance CTS 2026</h3>

                    <div class="space-y-4">
                        <div class="p-4 bg-red-50 rounded-lg border-l-4 border-red-500">
                            <div class="flex items-center mb-2">
                                <i class="fas fa-wind text-red-600 mr-3"></i>
                                <h4 class="font-bold text-red-800">Vent > 100 km/h</h4>
                            </div>
                            <p class="text-xs text-red-700">√âvacuation obligatoire du public selon l'article CTS 52.</p>
                            <div class="mt-2 text-xs text-stone-500">
                                <strong>Nouveau :</strong> V√©rification des seuils dans la notice constructeur 2025.
                            </div>
                        </div>

                        <div class="p-4 bg-blue-50 rounded-lg border-l-4 border-blue-500">
                            <div class="flex items-center mb-2">
                                <i class="fas fa-fire-extinguisher text-blue-600 mr-3"></i>
                                <h4 class="font-bold text-blue-800">D√©senfumage renforc√©</h4>
                            </div>
                            <p class="text-xs text-blue-700">Application imm√©diate de l'arr√™t√© du 29/07/2025.</p>
                            <div class="mt-2 text-xs text-stone-500">
                                Contr√¥les techniques √† jour obligatoires.
                            </div>
                        </div>

                        <div class="p-4 bg-emerald-50 rounded-lg border-l-4 border-emerald-500">
                            <div class="flex items-center mb-2">
                                <i class="fas fa-file-signature text-emerald-600 mr-3"></i>
                                <h4 class="font-bold text-emerald-800">Documents √† jour</h4>
                            </div>
                            <p class="text-xs text-emerald-700">Registre de s√©curit√© valide 2 ans max.</p>
                            <div class="mt-2 text-xs text-stone-500">
                                <strong>Attention :</strong> 6 mois si > 2500 pers. ou √©tablissements multiples.
                            </div>
                        </div>
                    </div>
                </div>
            </div>


            <!-- Section : Donn√©es techniques -->
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                <!-- Graphique : Seuils de vent -->
                <div class="bg-white rounded-xl shadow-sm border border-stone-200 p-6">
                    <h3 class="text-lg font-bold text-slate-800 mb-4 flex items-center">
                        <i class="fas fa-wind text-orange-600 mr-3"></i> Seuils Critiques de Vent (CTS)
                    </h3>
                    <p class="text-sm text-stone-500 mb-4">Surveillance m√©t√©orologique obligatoire - Seuils standard
                        d'√©vacuation</p>
                    <div style="height: 250px; position: relative;">
                        <canvas id="windThresholdChart"></canvas>
                    </div>
                    <div class="mt-4 text-xs text-stone-500 bg-stone-100 p-3 rounded">
                        <strong>Note 2026 :</strong> Les seuils doivent √™tre valid√©s par la notice constructeur conforme
                        aux normes NV65 actualis√©es.
                    </div>
                </div>

                <!-- Graphique : Responsabilit√©s -->
                <div class="bg-white rounded-xl shadow-sm border border-stone-200 p-6">
                    <h3 class="text-lg font-bold text-slate-800 mb-4">Cha√Æne de Responsabilit√©</h3>
                    <p class="text-sm text-stone-500 mb-4">R√©partition des responsabilit√©s dans la s√©curit√© CTS</p>
                    <div style="height: 250px; position: relative;">
                        <canvas id="responsibilityChart"></canvas>
                    </div>
                    <div class="mt-4 text-xs text-stone-500">
                        <strong>Rappel :</strong> L'exploitant reste responsable p√©nalement de la s√©curit√© du public.
                    </div>
                </div>
            </div>

            <!-- Section : Points techniques critiques -->
            <div class="mt-8 bg-white rounded-xl shadow-sm border border-stone-200 p-6">
                <h3 class="text-xl font-bold text-slate-800 mb-6">Points Techniques Critiques 2026</h3>

                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                    <div class="p-4 bg-stone-50 rounded-lg border border-stone-200">
                        <div class="flex items-center mb-2">
                            <span class="text-xl mr-3">‚öì</span>
                            <h4 class="font-bold text-slate-800">Ancrage & Sol</h4>
                        </div>
                        <p class="text-xs text-stone-600">Tests d'arrachage obligatoires (dynamom√®tre). Respect des
                            valeurs daN de la note de calcul.</p>
                        <div class="mt-2 text-xs text-stone-400">Art. CTS 5 & 9</div>
                    </div>

                    <div class="p-4 bg-stone-50 rounded-lg border border-stone-200">
                        <div class="flex items-center mb-2">
                            <span class="text-xl mr-3">üí®</span>
                            <h4 class="font-bold text-slate-800">Ventilation 2026</h4>
                        </div>
                        <p class="text-xs text-stone-600">Nouveaux seuils de d√©bit d'air selon l'arr√™t√© du 1/09/2025.
                            Maintenance renforc√©e.</p>
                        <div class="mt-2 text-xs text-stone-400">Art. CH actualis√©s</div>
                    </div>

                    <div class="p-4 bg-stone-50 rounded-lg border border-stone-200">
                        <div class="flex items-center mb-2">
                            <span class="text-xl mr-3">üî•</span>
                            <h4 class="font-bold text-slate-800">D√©senfumage</h4>
                        </div>
                        <p class="text-xs text-stone-600">Application imm√©diate des nouvelles r√®gles techniques (arr√™t√©
                            29/07/2025).</p>
                        <div class="mt-2 text-xs text-stone-400">R√®glement actualis√©</div>
                    </div>

                    <div class="p-4 bg-stone-50 rounded-lg border border-stone-200">
                        <div class="flex items-center mb-2">
                            <span class="text-xl mr-3">üé™</span>
                            <h4 class="font-bold text-slate-800">Toiles M2</h4>
                        </div>
                        <p class="text-xs text-stone-600">Classement au feu M2 obligatoire (Euroclasse C-s3,d0).
                            √âtiquette cousue visible.</p>
                        <div class="mt-2 text-xs text-stone-400">Art. CTS 10-12</div>
                    </div>

                    <div class="p-4 bg-stone-50 rounded-lg border border-stone-200">
                        <div class="flex items-center mb-2">
                            <span class="text-xl mr-3">‚ö°</span>
                            <h4 class="font-bold text-slate-800">√âlectricit√©</h4>
                        </div>
                        <p class="text-xs text-stone-600">V√©rification annuelle Q18/Q19. Coffrets IP44 minimum. Liaison
                            √©quipotentielle.</p>
                        <div class="mt-2 text-xs text-stone-400">Art. EL & CTS 18</div>
                    </div>

                    <div class="p-4 bg-stone-50 rounded-lg border border-stone-200">
                        <div class="flex items-center mb-2">
                            <span class="text-xl mr-3">üó∫Ô∏è</span>
                            <h4 class="font-bold text-slate-800">Signal√©tique</h4>
                        </div>
                        <p class="text-xs text-stone-600">Plans sch√©matiques √† l'entr√©e obligatoires (arr√™t√© 1/12/2025).
                        </p>
                        <div class="mt-2 text-xs text-stone-400">Livre III r√©form√©</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ============================================ -->
        <!-- ONGLET : CALCULS & SIMULATIONS -->
        <!-- ============================================ -->
        <div id="calculs" class="tab-content space-y-12">
            <!-- En-t√™te -->
            <div class="bg-white rounded-xl shadow-sm border border-stone-100 p-6 md:p-8">
                <h2 class="text-2xl font-semibold mb-4 text-slate-700">Calculs & Simulations Techniques</h2>
                <p class="text-stone-600 leading-relaxed mb-4">
                    Outils de calcul pour la conception et la v√©rification des structures d√©montables selon les
                    exigences r√©glementaires.
                </p>
                <div class="grid grid-cols-1 md:grid-cols-7 gap-4 mt-6">
                    <a href="#classification"
                        class="bg-stone-50 p-4 rounded-lg border-l-4 border-slate-600 hover-lift hover:shadow-md transition-all cursor-pointer">
                        <span
                            class="block text-xs font-bold text-stone-400 uppercase tracking-wider mb-1">Simulateur</span>
                        <span class="font-medium">Classification & Jauge</span>
                    </a>
                    <a href="#evacuation"
                        class="bg-stone-50 p-4 rounded-lg border-l-4 border-emerald-500 hover-lift hover:shadow-md transition-all cursor-pointer">
                        <span
                            class="block text-xs font-bold text-stone-400 uppercase tracking-wider mb-1">Simulateur</span>
                        <span class="font-medium">D√©gagements & Unit√©s de Passage </span>
                    </a>
                    <a href="#vent-meteo"
                        class="bg-stone-50 p-4 rounded-lg border-l-4 border-blue-500 hover-lift hover:shadow-md transition-all cursor-pointer">
                        <span
                            class="block text-xs font-bold text-stone-400 uppercase tracking-wider mb-1">Simulateur</span>
                        <span class="font-medium">√âchelle de Beaufort Vent & M√©t√©o</span>
                    </a>
                    <a href="#categorie-hauteur"
                        class="bg-stone-50 p-4 rounded-lg border-l-4 border-orange-500 hover-lift hover:shadow-md transition-all cursor-pointer">
                        <span
                            class="block text-xs font-bold text-stone-400 uppercase tracking-wider mb-1">Simulateur</span>
                        <span class="font-medium">Cat√©gorisation Hauteur de Chute</span>
                    </a>
                    <a href="#simulateur-charges"
                        class="bg-stone-50 p-4 rounded-lg border-l-4 border-purple-500 hover-lift hover:shadow-md transition-all cursor-pointer">
                        <span
                            class="block text-xs font-bold text-stone-400 uppercase tracking-wider mb-1">Simulateur</span>
                        <span class="font-medium">Charges d'Exploitation</span>
                    </a>
                    <a href="#calage"
                        class="bg-stone-50 p-4 rounded-lg border-l-4 border-amber-500 hover-lift hover:shadow-md transition-all cursor-pointer">
                        <span
                            class="block text-xs font-bold text-stone-400 uppercase tracking-wider mb-1">Simulateur</span>
                        <span class="font-medium">Charges & Calages</span>
                    </a>
                    <a href="#maitre-couple"
                        class="bg-stone-50 p-4 rounded-lg border-l-4 border-cyan-500 hover-lift hover:shadow-md transition-all cursor-pointer">
                        <span
                            class="block text-xs font-bold text-stone-400 uppercase tracking-wider mb-1">Simulateur</span>
                        <span class="font-medium">Calculateur de Ma√Ætre-couple</span>
                    </a>
                </div>
            </div>

            <!-- =============================== -->
            <!-- SIMULATEUR 1 : CLASSIFICATION -->
            <!-- =============================== -->
            <section id="classification" class="scroll-mt-20 bg-white rounded-xl shadow-sm border border-stone-200 p-6">
                <div class="mb-6">
                    <h3 class="text-xl font-bold text-slate-800 flex items-center">
                        <span
                            class="bg-slate-800 text-white rounded-md w-8 h-8 flex items-center justify-center mr-3 text-sm">1</span>
                        Classification & Jauge ERP
                    </h3>
                    <p class="text-stone-600 mt-2 max-w-3xl">
                        La cat√©gorie de votre √©tablissement d√©termine la s√©v√©rit√© des r√®gles (pr√©sence SSIAP, visites de
                        commission, etc.).
                        Elle est calcul√©e selon l'<strong>effectif total</strong> (public + personnel non
                        indispensable).
                    </p>
                </div>

                <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                    <!-- Calculateur -->
                    <div class="bg-white p-6 rounded-xl border-l-4 border-orange-500 border shadow-sm">
                        <div class="flex items-center justify-between mb-4">
                            <h3 class="text-xl font-bold text-stone-900">Calculateur de Cat√©gorie ERP</h3>
                            <span class="text-2xl"></span>
                        </div>
                        <p class="text-sm text-stone-500 mb-6">
                            Entrez votre jauge pour d√©terminer vos obligations r√©glementaires.
                        </p>

                        <div class="space-y-4">
                            <div>
                                <label for="capacityInput" class="block text-sm font-medium text-stone-700">Effectif
                                    Total (Personnes)</label>
                                <input type="number" id="capacityInput" placeholder="Ex: 350" value="350"
                                    class="mt-1 block w-full rounded-md border-stone-300 bg-stone-50 shadow-sm focus:border-orange-500 focus:ring-orange-500 sm:text-lg p-2 border">
                            </div>
                            <button id="calcBtn"
                                class="w-full flex justify-center py-3 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-orange-600 hover:bg-orange-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-orange-500">
                                Analyser la R√©glementation
                            </button>
                        </div>

                        <!-- R√©sultat -->
                        <div id="erpResult" class="mt-6 bg-orange-50 border border-orange-100 rounded-lg p-4">
                            <h4 class="font-bold text-orange-900 text-lg mb-2">R√©sultat : <span id="resCat">4√®me
                                    cat√©gorie</span></h4>
                            <ul class="text-sm text-orange-800 space-y-2 list-disc list-inside">
                                <li><strong>Type :</strong> <span id="resType">L (Salle de spectacle)</span></li>
                                <li><strong>Obligation S√©curit√© :</strong> <span id="resSecu">SSIAP 1 obligatoire</span>
                                </li>
                                <li><strong>Contr√¥le :</strong> <span id="resControl">Visite de commission 1x/an</span>
                                </li>
                            </ul>
                        </div>
                    </div>

                    <!-- Graphique -->
                    <div class="bg-white p-6 rounded-xl shadow-sm border border-stone-100 flex flex-col">
                        <div class="mb-4">
                            <h3 class="text-lg font-bold text-stone-900">R√©partition Th√©orique des ERP</h3>
                            <p class="text-xs text-stone-500">
                                Visualisation de la proportion des √©tablissements par cat√©gorie.
                            </p>
                        </div>
                        <div style="height: 300px; position: relative;">
                            <canvas id="erpChart"></canvas>
                        </div>
                    </div>
                </div>
            </section>

            <!-- =============================== -->
            <!-- SIMULATEUR 2 : √âVACUATION -->
            <!-- =============================== -->
            <section id="evacuation" class="scroll-mt-20 bg-white rounded-xl shadow-sm border border-stone-200 p-6">
                <div class="mb-6">
                    <h3 class="text-xl font-bold text-slate-800 flex items-center">
                        <span
                            class="bg-emerald-600 text-white rounded-md w-8 h-8 flex items-center justify-center mr-3 text-sm">2</span>
                        D√©gagements & Unit√©s de Passage
                    </h3>
                    <p class="text-stone-600 mt-2 max-w-3xl">
                        Le dimensionnement des sorties se fait en <strong>Unit√©s de Passage (UP)</strong>.
                        R√®gle de base : 1 UP = 0,60 m. Attention, 1 UP seule n√©cessite 0,90 m de large.
                    </p>
                </div>

                <div class="bg-white p-6 rounded-xl shadow-sm border border-stone-100">
                    <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                        <!-- Contr√¥les -->
                        <div class="lg:col-span-1 space-y-6">
                            <div>
                                <label for="evacSlider" class="block text-sm font-bold text-stone-700 mb-2">Simuler
                                    l'affluence :
                                    <span id="evacValue" class="text-emerald-600 text-lg">500</span> pers.</label>
                                <input type="range" id="evacSlider" min="0" max="2000" step="50" value="500"
                                    class="w-full h-2 bg-stone-200 rounded-lg appearance-none cursor-pointer accent-emerald-600">
                            </div>

                            <div class="grid grid-cols-2 gap-4">
                                <div class="bg-stone-50 p-3 rounded border border-stone-200 text-center">
                                    <span class="block text-2xl font-bold text-slate-800" id="upResult">6</span>
                                    <span class="text-xs text-stone-500 uppercase">Unit√©s de Passage (UP)</span>
                                </div>
                                <div class="bg-stone-50 p-3 rounded border border-stone-200 text-center">
                                    <span class="block text-2xl font-bold text-slate-800" id="widthResult">3.60m</span>
                                    <span class="text-xs text-stone-500 uppercase">Largeur Cumul√©e Min.</span>
                                </div>
                            </div>

                            <div class="bg-orange-50 p-4 rounded border-l-4 border-orange-500 text-sm text-orange-900">
                                <strong>R√®gle d'Or :</strong> Les d√©gagements doivent rester libres de tout obstacle et
                                les portes doivent s'ouvrir vers l'ext√©rieur.
                            </div>
                        </div>

                        <!-- Graphique -->
                        <div class="lg:col-span-2">
                            <div style="height: 300px; position: relative;">
                                <canvas id="evacChart"></canvas>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- =============================== -->
            <!-- SIMULATEUR 3 : VENT & M√âT√âO -->
            <!-- =============================== -->
            <section id="vent-meteo" class="scroll-mt-20 bg-white rounded-xl shadow-sm border border-stone-200 p-6">
                <div class="mb-6">
                    <h3 class="text-xl font-bold text-slate-800 flex items-center">
                        <span
                            class="bg-blue-600 text-white rounded-md w-8 h-8 flex items-center justify-center mr-3 text-sm">3</span>
                        Vent & M√©t√©o pour Structures
                    </h3>
                    <p class="text-stone-600 mt-2 max-w-3xl">
                        Surveillance m√©t√©orologique obligatoire pour les structures d√©montables.
                        L'exploitant doit surveiller la m√©t√©o en permanence et tenir un registre de s√©curit√©.
                    </p>
                </div>

                <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-8">
                    <!-- Calculateur Vent -->
                    <div class="bg-white rounded-xl shadow-sm border border-stone-200 p-6">
                        <h3 class="text-lg font-bold text-slate-700 mb-4 flex items-center">
                            <i class="fas fa-wind text-orange-600 mr-3"></i> Simulateur de D√©cision M√©t√©o
                        </h3>
                        <div class="space-y-6">
                            <div>
                                <label class="block text-sm font-medium text-stone-700 mb-2">Vitesse max homologu√©e
                                    (Carnet de bord)</label>
                                <select id="maxWindInput"
                                    class="w-full rounded-lg border-stone-300 shadow-sm p-3 border bg-white">
                                    <option value="85">85 km/h (Structures l√©g√®res)</option>
                                    <option value="100" selected>100 km/h (Standard)</option>
                                    <option value="120">120 km/h (Renforc√©)</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-stone-700 mb-2">Vitesse du vent actuelle
                                    (An√©mom√®tre)</label>
                                <input type="range" id="currentWindInput" min="0" max="140" value="45"
                                    class="w-full h-2 bg-stone-200 rounded-lg appearance-none cursor-pointer accent-blue-600">
                                <div class="flex justify-between text-sm text-stone-500 mt-1">
                                    <span>0 km/h</span>
                                    <span id="currentWindDisplay" class="font-bold text-blue-600 text-lg">45 km/h</span>
                                    <span>140 km/h</span>
                                </div>
                            </div>

                            <!-- Indicateur -->
                            <div id="weatherStatus"
                                class="bg-green-100 border border-green-200 p-4 rounded-lg flex items-start gap-3 transition-colors duration-300">
                                <div id="weatherIcon" class="text-2xl">‚úÖ</div>
                                <div>
                                    <h4 id="weatherTitle" class="font-bold text-green-800">Situation Normale</h4>
                                    <p id="weatherDesc" class="text-sm text-green-700">Exploitation autoris√©e. Continuez
                                        la veille m√©t√©orologique.</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Graphique Beaufort -->
                    <div class="bg-white rounded-xl shadow-sm border border-stone-200 p-6">
                        <h3 class="text-lg font-bold text-slate-700 mb-4">√âchelle de Beaufort & Risques</h3>
                        <p class="text-sm text-stone-500 mb-4">Surveillance m√©t√©orologique obligatoire - Seuils standard
                            d'√©vacuation</p>
                        <div style="height: 250px; position: relative;">
                            <canvas id="beaufortChart"></canvas>
                        </div>
                    </div>
                </div>
            </section>

            <!-- =============================== -->
            <!-- SIMULATEUR 4 : ARTICLE 5 -->
            <!-- =============================== -->
            <section id="categorie-hauteur"
                class="scroll-mt-20 bg-white rounded-xl shadow-sm border border-stone-200 p-6">
                <h3 class="text-xl font-bold text-slate-800 mb-6 flex items-center">
                    <span
                        class="bg-orange-600 text-white rounded-md w-8 h-8 flex items-center justify-center mr-3 text-sm">4</span>
                    <i class="fas fa-ruler-vertical text-orange-600 mr-3"></i>
                    Simulateur de Cat√©gorisation selon Hauteur de Chute (Article 5)
                </h3>

                <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                    <!-- Calculatrice -->
                    <div class="space-y-6">
                        <div>
                            <label class="block text-sm font-medium text-stone-700 mb-2">Type de structure</label>
                            <select id="structureType"
                                class="w-full rounded-lg border-stone-300 shadow-sm p-3 border bg-white">
                                <option value="OP">Ossature pour Personnes (OP)</option>
                                <option value="OS">Ossature Sc√©nique (OS)</option>
                            </select>
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-stone-700 mb-2">
                                Hauteur de chute (m√®tres)
                                <span id="heightValue" class="text-orange-600 font-bold ml-2">1.80</span>
                            </label>
                            <input type="range" id="heightSlider" min="0.5" max="10" step="0.1" value="1.8"
                                class="w-full h-2 bg-stone-200 rounded-lg appearance-none cursor-pointer accent-orange-600">
                            <div class="flex justify-between text-sm text-stone-500 mt-1">
                                <span>0.5 m</span>
                                <span>5 m</span>
                                <span>10 m</span>
                            </div>
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-stone-700 mb-2">Type sp√©cifique</label>
                            <select id="specificType"
                                class="w-full rounded-lg border-stone-300 shadow-sm p-3 border bg-white">
                                <option value="tribune">Tribune</option>
                                <option value="scene">Sc√®ne/Podium</option>
                                <option value="passerelle">Passerelle</option>
                                <option value="escalier">Escalier/Rampe</option>
                            </select>
                        </div>

                        <button onclick="calculateCategory()"
                            class="w-full py-3 bg-orange-600 text-white font-bold rounded-lg hover:bg-orange-700 transition">
                            Calculer la Cat√©gorie
                        </button>
                    </div>

                    <!-- R√©sultats -->
                    <div id="categoryResult" class="bg-stone-50 p-6 rounded-lg border border-stone-200">
                        <h4 class="font-bold text-lg mb-4 text-slate-800">R√©sultat de Cat√©gorisation</h4>
                        <div class="space-y-4">
                            <div class="p-4 bg-white rounded border-l-4 border-orange-500" id="categoryColor">
                                <div class="text-sm text-stone-500">Cat√©gorie</div>
                                <div class="text-2xl font-bold text-orange-600" id="resultCategory">OP2</div>
                                <div class="text-sm text-stone-600 mt-1" id="resultDescription">Hauteur de chute entre
                                    1.20 et 3.50 m</div>
                            </div>
                            <div>
                                <div class="text-sm font-medium text-stone-700 mb-2">Exigences applicables :</div>
                                <ul class="text-sm text-stone-600 space-y-2" id="resultRequirements">
                                    <li>‚Ä¢ V√©rification par contr√¥leur technique</li>
                                    <li>‚Ä¢ Inspection par technicien comp√©tent</li>
                                    <li>‚Ä¢ Attestation de bon montage obligatoire</li>
                                    <li>‚Ä¢ Rapport d'inspection type</li>
                                </ul>
                            </div>
                            <div class="p-3 bg-blue-50 rounded border border-blue-200">
                                <div class="text-sm text-blue-700">
                                    <strong>R√©f√©rence :</strong> Article 5 - Cat√©gorisation des ensembles d√©montables
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- =============================== -->
            <!-- SIMULATEUR 5 : ARTICLE 25 -->
            <!-- =============================== -->
            <section id="simulateur-charges"
                class="scroll-mt-20 bg-white rounded-xl shadow-sm border border-stone-200 p-6">
                <h3 class="text-xl font-bold text-slate-800 mb-6 flex items-center">
                    <span
                        class="bg-purple-600 text-white rounded-md w-8 h-8 flex items-center justify-center mr-3 text-sm">5</span>
                    <i class="fas fa-weight-hanging text-orange-600 mr-3"></i>
                    Simulateur de Charges d'Exploitation (Article 25)
                </h3>

                <div class="overflow-x-auto mb-6">
                    <table class="min-w-full divide-y divide-stone-200">
                        <thead class="bg-stone-50">
                            <tr>
                                <th class="px-4 py-3 text-left text-xs font-medium text-stone-500 uppercase">Type de
                                    structure</th>
                                <th class="px-4 py-3 text-left text-xs font-medium text-stone-500 uppercase">Charge
                                    verticale (kN/m¬≤)</th>
                                <th class="px-4 py-3 text-left text-xs font-medium text-stone-500 uppercase">Charge
                                    horizontale</th>
                                <th class="px-4 py-3 text-left text-xs font-medium text-stone-500 uppercase">Charge
                                    concentr√©e (kN)</th>
                            </tr>
                        </thead>
                        <tbody class="divide-y divide-stone-200" id="chargeTableBody">
                            <tr class="bg-stone-50">
                                <td class="px-4 py-3 text-sm font-medium text-stone-900">Tribunes assises</td>
                                <td class="px-4 py-3">
                                    <input type="number" value="5" class="w-24 p-2 border rounded charge-input"
                                        data-type="tribunes-assises" onchange="updateChargeCalculations()">
                                </td>
                                <td class="px-4 py-3 text-sm text-stone-600">6% de la charge verticale</td>
                                <td class="px-4 py-3">
                                    <input type="number" value="3" class="w-24 p-2 border rounded">
                                </td>
                            </tr>
                            <tr>
                                <td class="px-4 py-3 text-sm font-medium text-stone-900">Tribunes debout</td>
                                <td class="px-4 py-3">
                                    <input type="number" value="6" class="w-24 p-2 border rounded charge-input"
                                        data-type="tribunes-debout" onchange="updateChargeCalculations()">
                                </td>
                                <td class="px-4 py-3 text-sm text-stone-600">6% de la charge verticale</td>
                                <td class="px-4 py-3">
                                    <input type="number" value="3" class="w-24 p-2 border rounded">
                                </td>
                            </tr>
                            <tr class="bg-stone-50">
                                <td class="px-4 py-3 text-sm font-medium text-stone-900">Sc√®nes/Podiums</td>
                                <td class="px-4 py-3">
                                    <input type="number" value="5" class="w-24 p-2 border rounded charge-input"
                                        data-type="scenes-podiums" onchange="updateChargeCalculations()">
                                </td>
                                <td class="px-4 py-3 text-sm text-stone-600">6% de la charge verticale</td>
                                <td class="px-4 py-3">
                                    <input type="number" value="3" class="w-24 p-2 border rounded">
                                </td>
                            </tr>
                            <tr>
                                <td class="px-4 py-3 text-sm font-medium text-stone-900">Passerelles</td>
                                <td class="px-4 py-3">
                                    <input type="number" value="4" class="w-24 p-2 border rounded charge-input"
                                        data-type="passerelles" onchange="updateChargeCalculations()">
                                </td>
                                <td class="px-4 py-3 text-sm text-stone-600">3 kN/m</td>
                                <td class="px-4 py-3">
                                    <input type="number" value="2" class="w-24 p-2 border rounded">
                                </td>
                            </tr>
                            <tr class="bg-stone-50">
                                <td class="px-4 py-3 text-sm font-medium text-stone-900">Escaliers</td>
                                <td class="px-4 py-3">
                                    <input type="number" value="5" class="w-24 p-2 border rounded charge-input"
                                        data-type="escaliers" onchange="updateChargeCalculations()">
                                </td>
                                <td class="px-4 py-3 text-sm text-stone-600">2 kN/m</td>
                                <td class="px-4 py-3">
                                    <input type="number" value="2" class="w-24 p-2 border rounded">
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
                    <div class="p-4 bg-stone-50 rounded-lg border">
                        <div class="text-sm text-stone-500 mb-1">Charge totale estim√©e</div>
                        <div class="text-2xl font-bold text-slate-800" id="totalCharge">2300 kN</div>
                    </div>
                    <div class="p-4 bg-stone-50 rounded-lg border">
                        <div class="text-sm text-stone-500 mb-1">Surface charg√©e</div>
                        <div class="text-2xl font-bold text-slate-800" id="surfaceCharge">100 m¬≤</div>
                    </div>
                    <div class="p-4 bg-stone-50 rounded-lg border">
                        <div class="text-sm text-stone-500 mb-1">Pression au sol</div>
                        <div class="text-2xl font-bold text-slate-800" id="groundPressure">23.0 kN/m¬≤</div>
                    </div>
                </div>

                <button onclick="updateChargeCalculations()"
                    class="w-full py-3 bg-blue-600 text-white font-bold rounded-lg hover:bg-blue-700 transition">
                    Calculer les Charges
                </button>
            </section>

            <!-- =============================== -->
            <!-- SIMULATEUR 6 : ARTICLE 66 -->
            <!-- =============================== -->
            <section id="calage" class="scroll-mt-20 bg-white rounded-xl shadow-sm border border-stone-200 p-6">
                <h3 class="text-xl font-bold text-slate-800 mb-6 flex items-center">
                    <span
                        class="bg-amber-600 text-white rounded-md w-8 h-8 flex items-center justify-center mr-3 text-sm">6</span>
                    <i class="fas fa-cubes text-orange-600 mr-3"></i>
                    Test de R√©partition de Charges et Calages (Article 66)
                </h3>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-8 mb-8">
                    <!-- Configurations interdites -->
                    <div>
                        <h4 class="font-bold text-stone-800 mb-4">‚ö†Ô∏è Configurations Interdites</h4>
                        <div class="space-y-4">
                            <div class="flex items-start p-4 bg-red-50 rounded-lg border border-red-200 hover-lift">
                                <i class="fas fa-ban text-red-600 mt-1 mr-3"></i>
                                <div>
                                    <div class="font-medium text-red-800">Bois agglom√©r√©</div>
                                    <div class="text-sm text-red-700 mt-1">Interdit comme plaque de r√©partition</div>
                                </div>
                            </div>
                            <div class="flex items-start p-4 bg-red-50 rounded-lg border border-red-200 hover-lift">
                                <i class="fas fa-ban text-red-600 mt-1 mr-3"></i>
                                <div>
                                    <div class="font-medium text-red-800">V√©rins sur pente</div>
                                    <div class="text-sm text-red-700 mt-1">Interdit sans recient appropri√©</div>
                                </div>
                            </div>
                            <div class="flex items-start p-4 bg-red-50 rounded-lg border border-red-200 hover-lift">
                                <i class="fas fa-ban text-red-600 mt-1 mr-3"></i>
                                <div>
                                    <div class="font-medium text-red-800">Empilage non pyramidal</div>
                                    <div class="text-sm text-red-700 mt-1">Interdit au-del√† des valeurs d√©termin√©es
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Configurations autoris√©es -->
                    <div>
                        <h4 class="font-bold text-stone-800 mb-4">‚úÖ Configurations Autoris√©es</h4>
                        <div class="space-y-4">
                            <div
                                class="flex items-start p-4 bg-emerald-50 rounded-lg border border-emerald-200 hover-lift">
                                <i class="fas fa-check text-emerald-600 mt-1 mr-3"></i>
                                <div>
                                    <div class="font-medium text-emerald-800">Syst√®mes en pyramide</div>
                                    <div class="text-sm text-emerald-700 mt-1">Respect des principes du camarteau</div>
                                </div>
                            </div>
                            <div
                                class="flex items-start p-4 bg-emerald-50 rounded-lg border border-emerald-200 hover-lift">
                                <i class="fas fa-check text-emerald-600 mt-1 mr-3"></i>
                                <div>
                                    <div class="font-medium text-emerald-800">V√©rins du fabricant</div>
                                    <div class="text-sm text-emerald-700 mt-1">Seuls autoris√©s ou avec note de calcul
                                    </div>
                                </div>
                            </div>
                            <div
                                class="flex items-start p-4 bg-emerald-50 rounded-lg border border-emerald-200 hover-lift">
                                <i class="fas fa-check text-emerald-600 mt-1 mr-3"></i>
                                <div>
                                    <div class="font-medium text-emerald-800">Chaises/chandelles justifi√©es</div>
                                    <div class="text-sm text-emerald-700 mt-1">Avec note de calcul et indication CU
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Simulateur de calage -->
                <div class="p-6 bg-stone-50 rounded-lg border border-stone-200">
                    <h4 class="font-bold text-stone-800 mb-4">Simulateur de Calage</h4>
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-stone-700 mb-2">
                                Charge √† r√©partir (kN)
                                <span id="loadValue" class="text-orange-600 font-bold ml-2">50</span>
                            </label>
                            <input type="range" id="loadSlider" min="10" max="200" value="50"
                                class="w-full h-2 bg-stone-200 rounded-lg appearance-none cursor-pointer accent-orange-600">
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-stone-700 mb-2">Type de sol</label>
                            <select id="soilType" class="w-full p-3 border rounded-lg">
                                <option value="1">Terre battue (1 bar)</option>
                                <option value="2">Gazon (0.8 bar)</option>
                                <option value="3">Bitume (2 bars)</option>
                                <option value="4">B√©ton (3 bars)</option>
                            </select>
                        </div>

                        <button onclick="calculateFooting()"
                            class="w-full py-3 bg-orange-600 text-white font-bold rounded-lg hover:bg-orange-700">
                            Calculer la Surface de Calage
                        </button>

                        <div id="footingResult" class="mt-4 p-4 bg-white rounded-lg border border-emerald-200">
                            <div class="font-bold text-emerald-800 mb-2">Surface minimale requise :</div>
                            <div class="text-2xl font-bold text-emerald-600" id="footingArea">0.25 m¬≤</div>
                            <div class="text-sm text-stone-600 mt-2">
                                <strong>Dimension recommand√©e :</strong> <span id="footingDimensions">0.50x0.50 m</span>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- =============================== -->
            <!-- SIMULATEUR 7 : ARTICLE 7 -->
            <!-- =============================== -->
            <section id="maitre-couple" class="scroll-mt-20 bg-white rounded-xl shadow-sm border border-stone-200 p-6">
                <h3 class="text-xl font-bold text-slate-800 mb-6 flex items-center">
                    <span
                        class="bg-cyan-600 text-white rounded-md w-8 h-8 flex items-center justify-center mr-3 text-sm">7</span>
                    <i class="fas fa-wind text-orange-600 mr-3"></i>
                    Calculateur de Ma√Ætre-couple Vent pour Tribunes et Sc√®nes (Article 7)
                </h3>

                <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                    <!-- Param√®tres -->
                    <div class="space-y-6">
                        <div>
                            <label class="block text-sm font-medium text-stone-700 mb-2">Type de structure</label>
                            <select id="windStructureType"
                                class="w-full rounded-lg border-stone-300 shadow-sm p-3 border bg-white">
                                <option value="tribune">Tribune</option>
                                <option value="scene">Sc√®ne</option>
                                <option value="echafaudage">√âchafaudage</option>
                                <option value="passerelle">Passerelle</option>
                            </select>
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-stone-700 mb-2">Dimensions (m)</label>
                            <div class="grid grid-cols-2 gap-4">
                                <div>
                                    <input type="number" id="lengthInput" placeholder="Longueur" value="20"
                                        class="w-full p-3 border rounded">
                                </div>
                                <div>
                                    <input type="number" id="widthInput" placeholder="Largeur" value="10"
                                        class="w-full p-3 border rounded">
                                </div>
                            </div>
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-stone-700 mb-2">Hauteur (m)</label>
                            <input type="number" id="heightWindInput" value="6" class="w-full p-3 border rounded">
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-stone-700 mb-2">Vitesse du vent (km/h)</label>
                            <input type="number" id="windSpeed" value="100" class="w-full p-3 border rounded">
                        </div>

                        <button onclick="calculateWindLoad()"
                            class="w-full py-3 bg-blue-600 text-white font-bold rounded-lg hover:bg-blue-700 transition">
                            Calculer le Ma√Ætre-couple
                        </button>
                    </div>

                    <!-- R√©sultats -->
                    <div id="windResult">
                        <div class="bg-blue-50 p-6 rounded-lg border border-blue-200 mb-4">
                            <h4 class="font-bold text-lg mb-4 text-blue-800">R√©sultats du Calcul</h4>
                            <div class="space-y-4">
                                <div class="grid grid-cols-2 gap-4">
                                    <div class="p-4 bg-white rounded border">
                                        <div class="text-sm text-stone-500">Surface r√©f√©rence</div>
                                        <div class="text-xl font-bold text-blue-600" id="surfaceResult">60.0 m¬≤</div>
                                    </div>
                                    <div class="p-4 bg-white rounded border">
                                        <div class="text-sm text-stone-500">Coefficient structural</div>
                                        <div class="text-xl font-bold text-blue-600" id="coeffResult">1.3</div>
                                    </div>
                                </div>
                                <div class="p-4 bg-white rounded border-l-4 border-blue-500">
                                    <div class="text-sm text-stone-500">Effort total du vent</div>
                                    <div class="text-2xl font-bold text-blue-600" id="windForceResult">15.1 kN</div>
                                </div>
                            </div>
                        </div>

                        <div class="p-4 bg-orange-50 rounded-lg border border-orange-200">
                            <div class="text-sm text-orange-800">
                                <strong>Note :</strong> Ce calcul est bas√© sur les prescriptions NV65. Pour une √©tude
                                compl√®te, consulter un bureau d'√©tudes.
                            </div>
                        </div>
                    </div>
                </div>
            </section>
        </div>
        <!-- ============================================ -->
        <!-- NOUVEL ONGLET : CONTR√îLE & INSPECTION -->
        <!-- ============================================ -->
        <div id="controle" class="tab-content space-y-12">
            <!-- En-t√™te -->
            <div class="bg-white rounded-xl shadow-sm border border-stone-100 p-6 md:p-8">
                <h2 class="text-2xl font-semibold mb-4 text-slate-700">Contr√¥le & Inspection des Structures</h2>
                <p class="text-stone-600 leading-relaxed mb-4">
                    Outils pour les v√©rifications sur site et la gestion des inspections r√©glementaires.
                </p>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mt-6">
                    <div class="bg-stone-50 p-4 rounded-lg border-l-4 border-orange-500">
                        <span class="block text-xs font-bold text-stone-400 uppercase tracking-wider mb-1">Article
                            67</span>
                        <span class="font-medium">Attestation bon montage</span>
                    </div>
                    <div class="bg-stone-50 p-4 rounded-lg border-l-4 border-slate-600">
                        <span class="block text-xs font-bold text-stone-400 uppercase tracking-wider mb-1">Article
                            68</span>
                        <span class="font-medium">Checklist inspection</span>
                    </div>
                    <div class="bg-stone-50 p-4 rounded-lg border-l-4 border-emerald-500">
                        <span class="block text-xs font-bold text-stone-400 uppercase tracking-wider mb-1">Articles
                            3-4</span>
                        <span class="font-medium">Marquage des pi√®ces</span>
                    </div>
                </div>
            </div>

            <!-- Section 1: G√©n√©rateur d'attestation -->
            <section class="bg-white rounded-xl shadow-sm border border-stone-200 p-6">
                <h3 class="text-xl font-bold text-slate-800 mb-6 flex items-center">
                    <i class="fas fa-file-signature text-orange-600 mr-3"></i>
                    G√©n√©rateur d'Attestation de Bon Montage (Article 67)
                </h3>

                <div class="space-y-6">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <label class="block text-sm font-medium text-stone-700 mb-2">Nom de la manifestation</label>
                            <input type="text" id="manifestationName" class="w-full p-3 border rounded-lg"
                                placeholder="Ex: Festival des Arts 2024">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-stone-700 mb-2">Installateur</label>
                            <input type="text" id="installateurName" class="w-full p-3 border rounded-lg"
                                placeholder="Soci√©t√© de montage">
                        </div>
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-stone-700 mb-2">Descriptif sommaire</label>
                        <textarea id="descriptionAttestation" rows="4" class="w-full p-3 border rounded-lg"
                            placeholder="Tribune d√©montable - 500 places assises - 10 rangs..."></textarea>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-stone-700 mb-2">Nombre de places</label>
                            <input type="number" id="nbPlaces" class="w-full p-3 border rounded-lg" value="500">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-stone-700 mb-2">Point haut (m)</label>
                            <input type="number" id="pointHaut" class="w-full p-3 border rounded-lg" value="6.2">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-stone-700 mb-2">Date du montage</label>
                            <input type="date" id="dateMontage" class="w-full p-3 border rounded-lg">
                        </div>
                    </div>

                    <div class="flex space-x-4">
                        <button onclick="generateAttestation()"
                            class="px-6 py-3 bg-orange-600 text-white font-bold rounded-lg hover:bg-orange-700 transition">
                            <i class="fas fa-download mr-2"></i>G√©n√©rer l'Attestation
                        </button>
                        <button onclick="resetAttestation()"
                            class="px-6 py-3 bg-stone-200 text-stone-700 font-bold rounded-lg hover:bg-stone-300 transition">
                            <i class="fas fa-rotate-left mr-2"></i>R√©initialiser
                        </button>
                    </div>

                    <div id="attestationPreview" class="hidden mt-6 p-6 bg-stone-50 rounded-lg border border-stone-200">
                        <div class="flex justify-between items-center mb-4">
                            <h4 class="font-bold text-lg text-slate-800">Pr√©visualisation</h4>
                            <button onclick="printAttestation()"
                                class="px-4 py-2 bg-blue-600 text-white text-sm rounded hover:bg-blue-700">
                                <i class="fas fa-print mr-2"></i>Imprimer
                            </button>
                        </div>
                        <div id="attestationContent" class="bg-white p-6 rounded border">
                            <!-- Contenu g√©n√©r√© dynamiquement -->
                        </div>
                    </div>
                </div>
            </section>

            <!-- Section 2: Checklist interactive -->
            <section class="bg-white rounded-xl shadow-sm border border-stone-200 p-6">
                <h3 class="text-xl font-bold text-slate-800 mb-6 flex items-center">
                    <i class="fas fa-clipboard-list text-orange-600 mr-3"></i>
                    Checklist Interactive d'Inspection (Article 68)
                </h3>

                <div class="mb-6">
                    <select id="checklistType" class="w-full md:w-auto p-3 border rounded-lg"
                        onchange="loadChecklist()">
                        <option value="tribune">Tribune d√©montable</option>
                        <option value="scene">Sc√®ne/Podium</option>
                        <option value="echafaudage">√âchafaudage</option>
                        <option value="poutre">Poutres et grils</option>
                    </select>
                </div>

                <div class="space-y-4 max-h-96 overflow-y-auto custom-scroll p-2" id="checklistContainer">
                    <!-- Checklist charg√©e dynamiquement -->
                </div>

                <div class="mt-6 pt-6 border-t border-stone-200">
                    <div class="flex justify-between items-center">
                        <div>
                            <span class="text-sm text-stone-600">Progression : </span>
                            <span class="font-bold text-lg" id="checklistProgress">0%</span>
                        </div>
                        <button onclick="saveChecklist()"
                            class="px-6 py-2 bg-emerald-600 text-white font-bold rounded-lg hover:bg-emerald-700">
                            <i class="fas fa-save mr-2"></i>Sauvegarder
                        </button>
                    </div>
                </div>
            </section>

            <!-- Section 3: Tableau de synth√®se des inspections -->
            <section class="bg-white rounded-xl shadow-sm border border-stone-200 p-6">
                <h3 class="text-xl font-bold text-slate-800 mb-6">Tableau de Synth√®se des Inspections</h3>

                <div class="overflow-x-auto">
                    <table class="min-w-full divide-y divide-stone-200">
                        <thead class="bg-stone-50">
                            <tr>
                                <th class="px-4 py-3 text-left text-xs font-medium text-stone-500 uppercase">Cat√©gorie
                                </th>
                                <th class="px-4 py-3 text-left text-xs font-medium text-stone-500 uppercase">
                                    V√©rification conception</th>
                                <th class="px-4 py-3 text-left text-xs font-medium text-stone-500 uppercase">Inspection
                                    avant installation</th>
                                <th class="px-4 py-3 text-left text-xs font-medium text-stone-500 uppercase">Inspection
                                    montage</th>
                                <th class="px-4 py-3 text-left text-xs font-medium text-stone-500 uppercase">Inspection
                                    exploitation</th>
                            </tr>
                        </thead>
                        <tbody class="divide-y divide-stone-200" id="inspectionTable">
                            <!-- Rempli dynamiquement -->
                        </tbody>
                    </table>
                </div>
            </section>

            <!-- Section 4: Suivi des observations -->
            <section class="bg-white rounded-xl shadow-sm border border-stone-200 p-6">
                <h3 class="text-xl font-bold text-slate-800 mb-6">Suivi des Observations et Lev√©es d'Anomalies</h3>

                <div class="space-y-6">
                    <div class="p-4 bg-stone-50 rounded-lg border">
                        <h4 class="font-bold text-stone-800 mb-4">Ajouter une Observation</h4>
                        <div class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-stone-700 mb-2">Description</label>
                                <textarea id="observationText" rows="3" class="w-full p-3 border rounded-lg"
                                    placeholder="D√©crire l'anomalie..."></textarea>
                            </div>
                            <button onclick="addObservation()"
                                class="px-6 py-2 bg-orange-600 text-white font-bold rounded-lg hover:bg-orange-700">
                                Ajouter l'Observation
                            </button>
                        </div>
                    </div>

                    <div id="observationsList" class="space-y-3">
                        <!-- Rempli dynamiquement -->
                    </div>
                </div>
            </section>

            <!-- Section 5: Marquage des pi√®ces -->
            <section class="bg-white rounded-xl shadow-sm border border-stone-200 p-6">
                <h3 class="text-xl font-bold text-slate-800 mb-6 flex items-center">
                    <i class="fas fa-tag text-orange-600 mr-3"></i>
                    Marquage des Pi√®ces Structurelles (Articles 3-4)
                </h3>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                    <!-- Liste des pi√®ces √† marquer -->
                    <div>
                        <h4 class="font-bold text-stone-800 mb-4">Pi√®ces √† marquer obligatoirement :</h4>
                        <div class="space-y-3">
                            <div class="flex items-center p-3 bg-stone-50 rounded border hover-lift">
                                <i class="fas fa-check-circle text-emerald-600 mr-3"></i>
                                <span class="text-sm font-medium">Embases, semelles, socles</span>
                            </div>
                            <div class="flex items-center p-3 bg-stone-50 rounded border hover-lift">
                                <i class="fas fa-check-circle text-emerald-600 mr-3"></i>
                                <span class="text-sm font-medium">√âl√©ments porteurs (poteaux, poutres)</span>
                            </div>
                            <div class="flex items-center p-3 bg-stone-50 rounded border hover-lift">
                                <i class="fas fa-check-circle text-emerald-600 mr-3"></i>
                                <span class="text-sm font-medium">√âl√©ments de contreventement</span>
                            </div>
                            <div class="flex items-center p-3 bg-stone-50 rounded border hover-lift">
                                <i class="fas fa-check-circle text-emerald-600 mr-3"></i>
                                <span class="text-sm font-medium">Supports de si√®ges/banquettes</span>
                            </div>
                            <div class="flex items-center p-3 bg-stone-50 rounded border hover-lift">
                                <i class="fas fa-check-circle text-emerald-600 mr-3"></i>
                                <span class="text-sm font-medium">Garde-corps</span>
                            </div>
                        </div>
                    </div>

                    <!-- Exigences de marquage -->
                    <div>
                        <h4 class="font-bold text-stone-800 mb-4">Exigences du marquage :</h4>
                        <div class="space-y-4">
                            <div class="p-4 bg-blue-50 rounded-lg border border-blue-200">
                                <div class="font-medium text-blue-800 mb-2">Mat√©riel neuf</div>
                                <ul class="text-sm text-blue-700 space-y-1">
                                    <li>‚Ä¢ Nom/sigle du fabricant</li>
                                    <li>‚Ä¢ R√©f√©rence du mod√®le</li>
                                    <li>‚Ä¢ Ann√©e de fabrication</li>
                                    <li>‚Ä¢ Marquage p√©renne et lisible</li>
                                </ul>
                            </div>
                            <div class="p-4 bg-orange-50 rounded-lg border border-orange-200">
                                <div class="font-medium text-orange-800 mb-2">Mat√©riel existant</div>
                                <ul class="text-sm text-orange-700 space-y-1">
                                    <li>‚Ä¢ Mention "ant√©rieur √† [ann√©e]"</li>
                                    <li>‚Ä¢ Nom du fabricant si connu</li>
                                    <li>‚Ä¢ Estampille ou bague p√©renne</li>
                                    <li>‚Ä¢ D√©lai : 1er janvier 2020</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
        </div>

        <!-- ============================================ -->
        <!-- NOUVEL ONGLET : DOCUMENTS R√âGLEMENTAIRES -->
        <!-- ============================================ -->
        <div id="documents" class="tab-content space-y-12">
            <!-- En-t√™te -->
            <div class="bg-white rounded-xl shadow-sm border border-stone-100 p-6 md:p-8">
                <h2 class="text-2xl font-semibold mb-4 text-slate-700">Documents R√©glementaires</h2>
                <p class="text-stone-600 leading-relaxed mb-4">
                    Biblioth√®que intelligente des documents requis et outils de g√©n√©ration.
                </p>
            </div>

            <!-- Section 1: G√©n√©rateur de dossier de s√©curit√© -->
            <section class="bg-white rounded-xl shadow-sm border border-stone-200 p-6">
                <h3 class="text-xl font-bold text-slate-800 mb-6 flex items-center">
                    <i class="fas fa-folder-tree text-orange-600 mr-3"></i>
                    G√©n√©rateur de Dossier de S√©curit√© (Article 65)
                </h3>

                <div class="space-y-8">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <label class="block text-sm font-medium text-stone-700 mb-2">Organisateur</label>
                            <input type="text" id="organisateurName" class="w-full p-3 border rounded-lg">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-stone-700 mb-2">Installateur</label>
                            <input type="text" id="installateurDoc" class="w-full p-3 border rounded-lg">
                        </div>
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-stone-700 mb-2">Nature de la manifestation</label>
                        <input type="text" id="natureManifestation" class="w-full p-3 border rounded-lg"
                            placeholder="Concert, festival, repr√©sentation...">
                    </div>

                    <div class="flex space-x-4">
                        <button onclick="generateSecurityFile()"
                            class="px-6 py-3 bg-orange-600 text-white font-bold rounded-lg hover:bg-orange-700 transition">
                            <i class="fas fa-file-pdf mr-2"></i>G√©n√©rer le Dossier
                        </button>
                        <button onclick="resetSecurityFile()"
                            class="px-6 py-3 bg-stone-200 text-stone-700 font-bold rounded-lg hover:bg-stone-300 transition">
                            <i class="fas fa-rotate-left mr-2"></i>R√©initialiser
                        </button>
                    </div>
                </div>
            </section>

            <!-- Section 2: Mod√®les de notices techniques -->
            <section class="bg-white rounded-xl shadow-sm border border-stone-200 p-6">
                <h3 class="text-xl font-bold text-slate-800 mb-6 flex items-center">
                    <i class="fas fa-file-alt text-orange-600 mr-3"></i>
                    Mod√®les de Notices Techniques (Article 28)
                </h3>

                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                    <div class="p-4 bg-stone-50 rounded-lg border border-stone-200 hover-lift cursor-pointer"
                        onclick="loadNoticeTemplate('tribune')">
                        <div class="font-bold text-stone-800 mb-2">Notice tribune</div>
                        <div class="text-sm text-stone-600">Mod√®le type pour tribunes d√©montables</div>
                    </div>
                    <div class="p-4 bg-stone-50 rounded-lg border border-stone-200 hover-lift cursor-pointer"
                        onclick="loadNoticeTemplate('scene')">
                        <div class="font-bold text-stone-800 mb-2">Notice sc√®ne</div>
                        <div class="text-sm text-stone-600">Mod√®le type pour sc√®nes et podiums</div>
                    </div>
                    <div class="p-4 bg-stone-50 rounded-lg border border-stone-200 hover-lift cursor-pointer"
                        onclick="loadNoticeTemplate('echafaudage')">
                        <div class="font-bold text-stone-800 mb-2">Notice √©chafaudage</div>
                        <div class="text-sm text-stone-600">Mod√®le type pour √©chafaudages</div>
                    </div>
                </div>
            </section>

            <!-- Section 3: Types d'avis -->
            <section class="bg-white rounded-xl shadow-sm border border-stone-200 p-6">
                <h3 class="text-xl font-bold text-slate-800 mb-6">Types d'Avis (Article 10)</h3>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                    <div class="p-6 bg-blue-50 rounded-lg border border-blue-200">
                        <h4 class="font-bold text-blue-800 mb-4">Avis sur Mod√®le</h4>
                        <ul class="space-y-2 text-blue-700">
                            <li>‚Ä¢ Pour mat√©riels produits en s√©rie</li>
                            <li>‚Ä¢ Valide la conception type</li>
                            <li>‚Ä¢ D√©pend du fabricant</li>
                            <li>‚Ä¢ Doit √™tre joint au registre</li>
                        </ul>
                    </div>

                    <div class="p-6 bg-emerald-50 rounded-lg border border-emerald-200">
                        <h4 class="font-bold text-emerald-800 mb-4">Dossier Technique</h4>
                        <ul class="space-y-2 text-emerald-700">
                            <li>‚Ä¢ Pour mat√©riels sp√©cifiques</li>
                            <li>‚Ä¢ √âtude de cas par cas</li>
                            <li>‚Ä¢ Responsabilit√© de l'installateur</li>
                            <li>‚Ä¢ Doit √™tre √©tabli avant montage</li>
                        </ul>
                    </div>
                </div>
            </section>

            <!-- Section 4: Arbre d√©cisionnel -->
            <section class="bg-white rounded-xl shadow-sm border border-stone-200 p-6">
                <h3 class="text-xl font-bold text-slate-800 mb-6">Arbre D√©cisionnel - Documents Requis</h3>

                <div class="bg-stone-50 p-6 rounded-lg border border-stone-200">
                    <div class="space-y-6">
                        <div class="p-4 bg-white rounded border">
                            <div class="font-medium mb-3">Existe-t-il un avis sur mod√®le pour cette structure ?</div>
                            <div class="flex space-x-4">
                                <button onclick="showDecision(1, 'yes')"
                                    class="px-4 py-2 bg-emerald-600 text-white rounded hover:bg-emerald-700">
                                    Oui
                                </button>
                                <button onclick="showDecision(1, 'no')"
                                    class="px-4 py-2 bg-red-600 text-white rounded hover:bg-red-700">
                                    Non
                                </button>
                            </div>
                        </div>

                        <div id="decisionResult" class="hidden">
                            <div class="p-4 bg-blue-50 rounded-lg border border-blue-200">
                                <h4 class="font-bold text-blue-800 mb-3">Documentation requise :</h4>
                                <div id="decisionContent" class="space-y-2">
                                    <!-- Contenu dynamique -->
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Section 5: Biblioth√®que des normes -->
            <section class="bg-white rounded-xl shadow-sm border border-stone-200 p-6">
                <h3 class="text-xl font-bold text-slate-800 mb-6">Biblioth√®que des Normes</h3>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div class="p-4 bg-stone-50 rounded-lg border">
                        <div class="font-bold text-stone-800 mb-2">NF EN 13200-1 √† 6</div>
                        <div class="text-sm text-stone-600">Tribunes - Exigences de s√©curit√©</div>
                    </div>
                    <div class="p-4 bg-stone-50 rounded-lg border">
                        <div class="font-bold text-stone-800 mb-2">NF EN 12810-1/2</div>
                        <div class="text-sm text-stone-600">√âchafaudages pr√©fabriqu√©s</div>
                    </div>
                    <div class="p-4 bg-stone-50 rounded-lg border">
                        <div class="font-bold text-stone-800 mb-2">NF EN 12811-1/2/3</div>
                        <div class="text-sm text-stone-600">√âchafaudages tubes et colliers</div>
                    </div>
                    <div class="p-4 bg-stone-50 rounded-lg border">
                        <div class="font-bold text-stone-800 mb-2">NF P 01-012/013</div>
                        <div class="text-sm text-stone-600">Garde-corps et mains courantes</div>
                    </div>
                </div>
            </section>
        </div>

        <!-- ============================================ -->
        <!-- ONGLET EXISTANT : CTS & M√âT√âO -->
        <!-- ============================================ -->
        <div id="cts" class="tab-content">
            <div class="max-w-7xl mx-auto space-y-12">
                <!-- En-t√™te -->
                <div class="mb-8">
                    <h2 class="text-3xl font-bold mb-2 text-slate-800">S√©curit√© Chapiteaux (CTS) & M√©t√©o</h2>
                    <p class="text-stone-600 mb-6">
                        L'exploitation d'un chapiteau est soumise √† l'Arr√™t√© du 23 janvier 1985. Deux facteurs critiques
                        : la solidit√© au vent (neige) et la r√©action au feu.
                        L'exploitant doit tenir un registre de s√©curit√© et surveiller la m√©t√©o en permanence.
                    </p>
                </div>

                <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                    <!-- Tool: Wind Calculator -->
                    <div class="bg-white rounded-xl shadow-sm border border-stone-200 p-6">
                        <h3 class="text-lg font-bold text-slate-700 mb-4 flex items-center">
                            <i class="fas fa-wind text-orange-600 mr-3"></i> Simulateur de D√©cision M√©t√©o
                        </h3>
                        <div class="space-y-6">
                            <div>
                                <label class="block text-sm font-medium text-stone-700 mb-2">Vitesse max homologu√©e
                                    (Carnet de bord)</label>
                                <select id="maxWindInput2"
                                    class="w-full rounded-lg border-stone-300 shadow-sm p-3 border bg-white">
                                    <option value="85">85 km/h (Structures l√©g√®res)</option>
                                    <option value="100" selected>100 km/h (Standard)</option>
                                    <option value="120">120 km/h (Renforc√©)</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-stone-700 mb-2">Vitesse du vent actuelle
                                    (An√©mom√®tre)</label>
                                <input type="range" id="currentWindInput2" min="0" max="140" value="45"
                                    class="w-full h-2 bg-stone-200 rounded-lg appearance-none cursor-pointer accent-blue-600">
                                <div class="flex justify-between text-sm text-stone-500 mt-1">
                                    <span>0 km/h</span>
                                    <span id="currentWindDisplay2" class="font-bold text-blue-600 text-lg">45
                                        km/h</span>
                                    <span>140 km/h</span>
                                </div>
                            </div>

                            <!-- Status Indicator -->
                            <div id="weatherStatus2"
                                class="bg-green-100 border border-green-200 p-4 rounded-lg flex items-start gap-3 transition-colors duration-300">
                                <div id="weatherIcon2" class="text-2xl">‚úÖ</div>
                                <div>
                                    <h4 id="weatherTitle2" class="font-bold text-green-800">Situation Normale</h4>
                                    <p id="weatherDesc2" class="text-sm text-green-700">Exploitation autoris√©e.
                                        Continuez la veille m√©t√©orologique.</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Data: Wind Chart -->
                    <div class="bg-white rounded-xl shadow-sm border border-stone-200 p-6">
                        <h3 class="text-lg font-bold text-slate-700 mb-4">√âchelle de Beaufort & Risques</h3>
                        <div style="height: 300px; position: relative;">
                            <canvas id="windChartCts"></canvas>
                        </div>
                    </div>
                </div>

                <!-- Checklist -->
                <div class="mt-8 bg-white rounded-xl shadow-sm border border-stone-200 p-6">
                    <h3 class="text-lg font-bold text-slate-700 mb-6">Points de Contr√¥le Obligatoires (Matin & Soir)
                    </h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div class="flex items-start p-4 bg-stone-50 rounded-lg hover-lift">
                            <input type="checkbox" class="mt-1 mr-3 h-5 w-5 text-orange-600 rounded border-stone-300">
                            <div>
                                <span class="font-medium text-stone-900">Ancrages et Haubanage</span>
                                <p class="text-sm text-stone-600 mt-1">V√©rifier la tension des sangles (cliquets) et la
                                    tenue des pieux (pas de soul√®vement de terre).</p>
                            </div>
                        </div>
                        <div class="flex items-start p-4 bg-stone-50 rounded-lg hover-lift">
                            <input type="checkbox" class="mt-1 mr-3 h-5 w-5 text-orange-600 rounded border-stone-300">
                            <div>
                                <span class="font-medium text-stone-900">Issue de Secours</span>
                                <p class="text-sm text-stone-600 mt-1">D√©verrouill√©es, d√©gag√©es de tout obstacle,
                                    √©clairage de s√©curit√© fonctionnel.</p>
                            </div>
                        </div>
                        <div class="flex items-start p-4 bg-stone-50 rounded-lg hover-lift">
                            <input type="checkbox" class="mt-1 mr-3 h-5 w-5 text-orange-600 rounded border-stone-300">
                            <div>
                                <span class="font-medium text-stone-900">Extincteurs</span>
                                <p class="text-sm text-stone-600 mt-1">En place, plomb√©s, v√©rifi√©s annuellement. Acc√®s
                                    non bloqu√© par des d√©cors.</p>
                            </div>
                        </div>
                        <div class="flex items-start p-4 bg-stone-50 rounded-lg hover-lift">
                            <input type="checkbox" class="mt-1 mr-3 h-5 w-5 text-orange-600 rounded border-stone-300">
                            <div>
                                <span class="font-medium text-stone-900">Installations √âlectriques</span>
                                <p class="text-sm text-stone-600 mt-1">Coffrets ferm√©s √† cl√©, c√¢bles prot√©g√©s des
                                    passages (passages de c√¢bles).</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ============================================ -->
        <!-- ONGLET EXISTANT : FAUNE SAUVAGE -->
        <!-- ============================================ -->
        <div id="animals" class="tab-content">
            <div class="max-w-7xl mx-auto space-y-12">
                <!-- En-t√™te -->
                <div class="mb-8">
                    <h2 class="text-3xl font-bold mb-2 text-slate-800">Faune Sauvage & Cirque</h2>
                    <p class="text-stone-600 mb-6">
                        La Loi n¬∞ 2021-1539 du 30 novembre 2021 visant √† lutter contre la maltraitance animale impose
                        une transition majeure pour les cirques itin√©rants.
                        L'objectif est l'arr√™t total de la pr√©sentation d'animaux sauvages au public d'ici 2028.
                    </p>
                </div>

                <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                    <div class="lg:col-span-2">
                        <div class="bg-white rounded-xl shadow-sm border border-stone-200 p-6">
                            <h3 class="text-lg font-bold text-slate-700 mb-4">Trajectoire Loi 2021 (Fin des animaux
                                sauvages)</h3>
                            <div style="height: 300px; position: relative;">
                                <canvas id="animalTimelineChart"></canvas>
                            </div>
                        </div>
                    </div>
                    <div class="bg-orange-50 rounded-xl border border-orange-200 p-6">
                        <h3 class="font-bold text-orange-900 text-lg mb-4">Points Cl√©s de la Loi</h3>
                        <ul class="space-y-4 text-sm text-orange-800">
                            <li class="flex items-start">
                                <i class="fas fa-ban text-orange-600 mt-1 mr-3"></i>
                                <span><strong>Interdiction d'acquisition :</strong> Depuis 2023, interdiction
                                    d'acqu√©rir ou de reproduire des animaux sauvages dans les cirques
                                    itin√©rants.</span>
                            </li>
                            <li class="flex items-start">
                                <i class="fas fa-hand text-orange-600 mt-1 mr-3"></i>
                                <span><strong>Interdiction de repr√©sentation :</strong> Au 1er d√©cembre 2028,
                                    interdiction totale de pr√©senter des animaux sauvages au public dans des
                                    √©tablissements itin√©rants.</span>
                            </li>
                            <li class="flex items-start">
                                <i class="fas fa-truck text-orange-600 mt-1 mr-3"></i>
                                <span><strong>Transport :</strong> Le transport de ces animaux sera √©galement
                                    interdit √† cette date, sauf pour rejoindre des refuges.</span>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>

        <!-- ============================================ -->
        <!-- ONGLET EXISTANT : L√âGISLATION -->
        <!-- ============================================ -->
        <div id="legislation" class="tab-content">
            <div class="max-w-7xl mx-auto space-y-12">
                <!-- En-t√™te -->
                <div class="mb-8">
                    <h2 class="text-3xl font-bold mb-2 text-slate-800">Biblioth√®que Officielle L√©gifrance</h2>
                    <p class="text-stone-600 mb-6">
                        Acc√®s direct aux textes consolid√©s. Utilisez le filtre pour trouver un sujet sp√©cifique (ex:
                        "feu", "bruit", "travail").
                    </p>
                </div>

                <!-- Search Filter -->
                <div class="mb-6 relative">
                    <input type="text" id="linkSearch" placeholder="Filtrer les textes (ex: S√©curit√©, Travail...)"
                        class="w-full pl-12 pr-4 py-3 rounded-lg border border-stone-300 focus:ring-2 focus:ring-orange-500 focus:border-orange-500 transition-shadow">
                    <i class="fas fa-search absolute left-3 top-3.5 text-stone-400"></i>
                </div>

                <!-- Links Table -->
                <div class="bg-white rounded-xl shadow-sm overflow-hidden border border-stone-200">
                    <table class="min-w-full divide-y divide-stone-200">
                        <thead class="bg-stone-50">
                            <tr>
                                <th scope="col"
                                    class="px-6 py-3 text-left text-xs font-medium text-stone-500 uppercase tracking-wider">
                                    Th√®me</th>
                                <th scope="col"
                                    class="px-6 py-3 text-left text-xs font-medium text-stone-500 uppercase tracking-wider">
                                    Titre & R√©f√©rence</th>
                                <th scope="col"
                                    class="px-6 py-3 text-left text-xs font-medium text-stone-500 uppercase tracking-wider">
                                    Mots Cl√©s</th>
                                <th scope="col"
                                    class="px-6 py-3 text-right text-xs font-medium text-stone-500 uppercase tracking-wider">
                                    Action</th>
                            </tr>
                        </thead>
                        <tbody class="bg-white divide-y divide-stone-200" id="linksTableBody">
                            <!-- Populated by JS -->
                        </tbody>
                    </table>
                    <div id="noResults" class="hidden p-8 text-center text-stone-500">
                        <i class="fas fa-search text-3xl mb-3 text-stone-300"></i>
                        <p>Aucun texte trouv√© pour cette recherche.</p>
                    </div>
                </div>

                <!-- Additional Legal Resources -->
                <div class="mt-8 grid grid-cols-1 md:grid-cols-2 gap-6">
                    <!-- Card 1: Code de la Construction -->
                    <div
                        class="bg-white rounded-xl shadow-sm overflow-hidden border border-stone-200 hover:shadow-md transition-shadow">
                        <div class="bg-stone-900 text-white p-4">
                            <div class="flex justify between items-center">
                                <h3 class="text-lg font-bold">Code Construction (CCH)</h3>
                                <i class="fas fa-landmark"></i>
                            </div>
                        </div>
                        <div class="p-6 space-y-4">
                            <a href="https://www.legifrance.gouv.fr/codes/section_lc/JORFTEXT000000290033/LEGISCTA000020370853/"
                                target="_blank" class="block group">
                                <div class="text-slate-700 font-medium group-hover:text-orange-600">Article R. 123-43
                                </div>
                                <div class="text-sm text-stone-600 mt-1">Base l√©gale pour les √©tablissements de type L
                                    et CTS. D√©finit l'obligation de contr√¥le.</div>
                            </a>
                            <a href="https://www.legifrance.gouv.fr/codes/article_lc/LEGIARTI000006896227"
                                target="_blank" class="block group">
                                <div class="text-slate-700 font-medium group-hover:text-orange-600">Article R. 123-45
                                </div>
                                <div class="text-sm text-stone-600 mt-1">R√¥le de la commission de s√©curit√©.</div>
                            </a>
                        </div>
                    </div>

                    <!-- Card 2: Arr√™t√© GN (G√©n√©ralit√©s) -->
                    <div
                        class="bg-white rounded-xl shadow-sm overflow-hidden border border-stone-200 hover:shadow-md transition-shadow">
                        <div class="bg-stone-900 text-white p-4">
                            <div class="flex justify-between items-center">
                                <h3 class="text-lg font-bold">Dispositions G√©n√©rales</h3>
                                <i class="fas fa-file-contract"></i>
                            </div>
                        </div>
                        <div class="p-6 space-y-4">
                            <a href="https://www.legifrance.gouv.fr/loda/id/JORFTEXT000000290033" target="_blank"
                                class="block group">
                                <div class="text-slate-700 font-medium group-hover:text-orange-600">Arr√™t√© du 25 juin
                                    1980</div>
                                <div class="text-sm text-stone-600 mt-1">R√®glement de s√©curit√© contre les risques
                                    d'incendie et de panique.</div>
                            </a>
                            <div class="text-sm text-stone-600">Articles GN 1 √† GN 14 (Classement des √©tablissements).
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ============================================ -->
        <!-- ONGLET EXISTANT : PROC√âDURES -->
        <!-- ============================================ -->
        <div id="procedures" class="tab-content">
            <div class="max-w-7xl mx-auto space-y-12">
                <!-- En-t√™te -->
                <div class="mb-8">
                    <h2 class="text-3xl font-bold mb-2 text-slate-800">Chronologie des Proc√©dures</h2>
                    <p class="text-stone-600 mb-6">De la demande initiale √† l'ouverture au public. Cliquez sur les
                        √©tapes pour voir les d√©tails r√©glementaires.</p>
                </div>

                <!-- Interactive Timeline Steps -->
                <div
                    class="flex flex-col md:flex-row justify-between items-start md:items-center border-b-2 border-stone-200 mb-8 pb-4 space-y-4 md:space-y-0">
                    <button onclick="updateProcedure(0)"
                        class="proc-btn px-6 py-3 rounded-lg bg-orange-600 text-white font-bold">1. Conception</button>
                    <div class="hidden md:block text-stone-300">‚ûú</div>
                    <button onclick="updateProcedure(1)"
                        class="proc-btn px-6 py-3 rounded-lg bg-stone-200 text-stone-600 font-bold hover:bg-stone-300">2.
                        Implantation</button>
                    <div class="hidden md:block text-stone-300">‚ûú</div>
                    <button onclick="updateProcedure(2)"
                        class="proc-btn px-6 py-3 rounded-lg bg-stone-200 text-stone-600 font-bold hover:bg-stone-300">3.
                        Montage</button>
                    <div class="hidden md:block text-stone-300">‚ûú</div>
                    <button onclick="updateProcedure(3)"
                        class="proc-btn px-6 py-3 rounded-lg bg-stone-200 text-stone-600 font-bold hover:bg-stone-300">4.
                        Contr√¥le Final</button>
                </div>

                <!-- Dynamic Procedure Content -->
                <div id="procedure-content"
                    class="bg-blue-50 rounded-xl p-6 border border-blue-100 transition-all duration-300 mb-8">
                    <!-- Content injected via JS -->
                </div>

                <h3 class="text-2xl font-bold mb-6 text-slate-800">Tableau Synth√©tique des Contr√¥les</h3>
                <div class="bg-white rounded-xl shadow-sm overflow-hidden border border-stone-200">
                    <table class="w-full text-sm text-left">
                        <thead class="bg-stone-100">
                            <tr>
                                <th class="p-4 font-bold text-stone-700">Type de Contr√¥le</th>
                                <th class="p-4 font-bold text-stone-700">P√©riodicit√©</th>
                                <th class="p-4 font-bold text-stone-700">Acteur</th>
                                <th class="p-4 font-bold text-stone-700">Article CTS</th>
                            </tr>
                        </thead>
                        <tbody class="divide-y divide-stone-200">
                            <tr class="hover:bg-stone-50">
                                <td class="p-4 font-medium text-stone-900">V√©rification Biennale (validit√© registre)
                                </td>
                                <td class="p-4">2 ans (6 mois si > 2500 pers ou √©tablissements multiples)</td>
                                <td class="p-4">Organisme Agr√©√©</td>
                                <td class="p-4">CTS 34</td>
                            </tr>
                            <tr class="hover:bg-stone-50">
                                <td class="p-4 font-medium text-stone-900">Inspection Avant Ouverture</td>
                                <td class="p-4">√Ä chaque installation</td>
                                <td class="p-4">Commission de S√©curit√© (Mairie/Pr√©fet)</td>
                                <td class="p-4">R. 123-45</td>
                            </tr>
                            <tr class="hover:bg-stone-50">
                                <td class="p-4 font-medium text-stone-900">Attestation de bon montage</td>
                                <td class="p-4">√Ä chaque installation</td>
                                <td class="p-4">Technicien Comp√©tent / Exploitant</td>
                                <td class="p-4">CTS 52</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- ============================================ -->
        <!-- ONGLET EXISTANT : TECHNIQUE -->
        <!-- ============================================ -->
        <div id="technique" class="tab-content">
            <div class="max-w-7xl mx-auto space-y-12">
                <!-- En-t√™te -->
                <div class="mb-8">
                    <h2 class="text-3xl font-bold mb-2 text-slate-800">Focus Technique</h2>
                    <p class="text-stone-600 mb-6">Explorez les exigences techniques sp√©cifiques. Les non-conformit√©s
                        sur ces points entra√Ænent un refus d'ouverture.</p>
                </div>

                <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                    <!-- Navigation for Technical Topics -->
                    <div class="space-y-3">
                        <button onclick="showTechDetail('sol')"
                            class="w-full text-left p-4 rounded-lg bg-white border border-stone-200 hover:border-orange-500 hover:bg-orange-50 font-medium transition-colors flex items-center hover-lift">
                            <i class="fas fa-anchor text-orange-600 mr-3"></i>
                            Ancrage au Sol
                        </button>
                        <button onclick="showTechDetail('structure')"
                            class="w-full text-left p-4 rounded-lg bg-white border border-stone-200 hover:border-orange-500 hover:bg-orange-50 font-medium transition-colors flex items-center hover-lift">
                            <i class="fas fa-industry text-orange-600 mr-3"></i>
                            Charpente & Levage
                        </button>
                        <button onclick="showTechDetail('toile')"
                            class="w-full text-left p-4 rounded-lg bg-white border border-stone-200 hover:border-orange-500 hover:bg-orange-50 font-medium transition-colors flex items-center hover-lift">
                            <i class="fas fa-fire text-orange-600 mr-3"></i>
                            Toiles & Feu (M2)
                        </button>
                        <button onclick="showTechDetail('elec')"
                            class="w-full text-left p-4 rounded-lg bg-white border border-stone-200 hover:border-orange-500 hover:bg-orange-50 font-medium transition-colors flex items-center hover-lift">
                            <i class="fas fa-bolt text-orange-600 mr-3"></i>
                            √âlectricit√© & Chauffage
                        </button>
                    </div>

                    <!-- Content Display Area -->
                    <div class="lg:col-span-2 bg-white rounded-xl shadow-sm p-6 border border-stone-200"
                        id="tech-display">
                        <!-- Default Content -->
                        <div class="h-full flex flex-col justify-center items-center text-center text-stone-400 p-8">
                            <i class="fas fa-mouse-pointer text-4xl mb-4"></i>
                            <p class="text-lg">S√©lectionnez un sujet technique √† gauche pour voir les d√©tails
                                r√©glementaires.</p>
                        </div>
                    </div>
                </div>

                <!-- Chart for Wind Resistance -->
                <div class="mt-12 pt-8 border-t border-stone-200">
                    <h3 class="text-2xl font-bold mb-6 text-slate-800">R√©sistance au Vent (Neige et Vent)</h3>
                    <div class="bg-white rounded-xl shadow-sm p-6 border border-stone-200">
                        <div style="height: 300px; position: relative;">
                            <canvas id="windResistanceChart"></canvas>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ============================================ -->
        <!-- ONGLET EXISTANT : OUTILS (ENRICHIT) -->
        <!-- ============================================ -->
        <div id="outils" class="tab-content">
            <div class="max-w-7xl mx-auto space-y-12">
                <!-- En-t√™te enrichie -->
                <div class="bg-white rounded-xl shadow-sm border border-stone-100 p-6 md:p-8">
                    <h2 class="text-2xl font-semibold mb-4 text-slate-700">Outils Pratiques</h2>
                    <p class="text-stone-600 leading-relaxed mb-4">
                        Ensemble d'outils pour faciliter les v√©rifications et les calculs quotidiens.
                    </p>
                    <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mt-6">
                        <div class="bg-stone-50 p-3 rounded-lg border-l-4 border-orange-500">
                            <span class="block text-xs font-bold text-stone-400 uppercase tracking-wider mb-1">Article
                                30</span>
                            <span class="font-medium">Distance max √† parcourir</span>
                        </div>
                        <div class="bg-stone-50 p-3 rounded-lg border-l-4 border-slate-600">
                            <span class="block text-xs font-bold text-stone-400 uppercase tracking-wider mb-1">Article
                                46</span>
                            <span class="font-medium">V√©rificateur garde-corps</span>
                        </div>
                        <div class="bg-stone-50 p-3 rounded-lg border-l-4 border-emerald-500">
                            <span class="block text-xs font-bold text-stone-400 uppercase tracking-wider mb-1">Article
                                56</span>
                            <span class="font-medium">Plans de pr√©vention</span>
                        </div>
                        <div class="bg-stone-50 p-3 rounded-lg border-l-4 border-blue-500">
                            <span class="block text-xs font-bold text-stone-400 uppercase tracking-wider mb-1">Article
                                55</span>
                            <span class="font-medium">V√©rifications p√©riodiques</span>
                        </div>
                    </div>
                </div>

                <!-- Nouveaux outils -->
                <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                    <!-- Calculateur de distance -->
                    <div class="bg-white rounded-xl shadow-sm p-6 border border-stone-200 hover-lift">
                        <h3 class="text-lg font-bold text-slate-800 mb-4 flex items-center">
                            <i class="fas fa-ruler text-orange-600 mr-3"></i>
                            Calculateur de Distance Maximale √† Parcourir (Article 30)
                        </h3>

                        <div class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-stone-700 mb-2">Type de local</label>
                                <select id="localType" class="w-full p-3 border rounded-lg">
                                    <option value="salle">Salle de spectacle</option>
                                    <option value="chapiteau">Chapiteau</option>
                                    <option value="tente">Tente</option>
                                </select>
                            </div>

                            <div>
                                <label class="block text-sm font-medium text-stone-700 mb-2">Nombre de sorties</label>
                                <input type="number" id="nbSorties" value="2" class="w-full p-3 border rounded-lg">
                            </div>

                            <button onclick="calculateDistance()"
                                class="w-full py-3 bg-orange-600 text-white font-bold rounded-lg hover:bg-orange-700">
                                Calculer la Distance
                            </button>

                            <div id="distanceResult"
                                class="hidden mt-4 p-4 bg-emerald-50 rounded-lg border border-emerald-200">
                                <div class="font-bold text-emerald-800 mb-2">Distance maximale :</div>
                                <div class="text-2xl font-bold text-emerald-600" id="distanceValue">0 m</div>
                            </div>
                        </div>
                    </div>

                    <!-- V√©rificateur de garde-corps -->
                    <div class="bg-white rounded-xl shadow-sm p-6 border border-stone-200 hover-lift">
                        <h3 class="text-lg font-bold text-slate-800 mb-4 flex items-center">
                            <i class="fas fa-shield-alt text-orange-600 mr-3"></i>
                            V√©rificateur de Garde-corps (Article 46)
                        </h3>

                        <div class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-stone-700 mb-2">Hauteur du garde-corps
                                    (m)</label>
                                <input type="number" id="guardHeight" value="1.0" step="0.1"
                                    class="w-full p-3 border rounded-lg">
                            </div>

                            <div>
                                <label class="block text-sm font-medium text-stone-700 mb-2">Type de protection</label>
                                <select id="guardType" class="w-full p-3 border rounded-lg">
                                    <option value="tribune">Tribune</option>
                                    <option value="scene">Sc√®ne/Podium</option>
                                    <option value="escalier">Escalier</option>
                                    <option value="passerelle">Passerelle</option>
                                </select>
                            </div>

                            <button onclick="verifyGuardrail()"
                                class="w-full py-3 bg-blue-600 text-white font-bold rounded-lg hover:bg-blue-700">
                                V√©rifier la Conformit√©
                            </button>

                            <div id="guardResult" class="hidden mt-4 p-4 rounded-lg border">
                                <!-- R√©sultat dynamique -->
                            </div>
                        </div>
                    </div>

                    <!-- Gestionnaire de plans de pr√©vention -->
                    <div class="bg-white rounded-xl shadow-sm p-6 border border-stone-200 hover-lift">
                        <h3 class="text-lg font-bold text-slate-800 mb-4 flex items-center">
                            <i class="fas fa-clipboard-user text-orange-600 mr-3"></i>
                            Gestionnaire de Plans de Pr√©vention (Article 56)
                        </h3>

                        <div class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-stone-700 mb-2">Nombre
                                    d'entreprises</label>
                                <input type="number" id="nbEntreprises" value="2" class="w-full p-3 border rounded-lg">
                            </div>

                            <div>
                                <label class="block text-sm font-medium text-stone-700 mb-2">Dur√©e des travaux
                                    (heures)</label>
                                <input type="number" id="dureeTravaux" value="200" class="w-full p-3 border rounded-lg">
                            </div>

                            <div class="p-4 bg-yellow-50 rounded-lg border border-yellow-200">
                                <div class="text-sm text-yellow-800">
                                    <strong>Rappel :</strong> Un plan de pr√©vention √©crit est obligatoire d√®s 400 heures
                                    de travail ou pour les travaux dangereux.
                                </div>
                            </div>

                            <button onclick="generatePreventionPlan()"
                                class="w-full py-3 bg-emerald-600 text-white font-bold rounded-lg hover:bg-emerald-700">
                                G√©n√©rer le Mod√®le
                            </button>
                        </div>
                    </div>

                    <!-- Suivi des v√©rifications -->
                    <div class="bg-white rounded-xl shadow-sm p-6 border border-stone-200 hover-lift">
                        <h3 class="text-lg font-bold text-slate-800 mb-4 flex items-center">
                            <i class="fas fa-calendar-check text-orange-600 mr-3"></i>
                            Suivi des V√©rifications P√©riodiques (Article 55)
                        </h3>

                        <div class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-stone-700 mb-2">Type d'√©quipement</label>
                                <select id="equipmentType" class="w-full p-3 border rounded-lg">
                                    <option value="levage">Appareils de levage</option>
                                    <option value="electrique">Installations √©lectriques</option>
                                    <option value="securite">Moyens de secours</option>
                                    <option value="structure">Structure d√©montable</option>
                                </select>
                            </div>

                            <div>
                                <label class="block text-sm font-medium text-stone-700 mb-2">Date de derni√®re
                                    v√©rification</label>
                                <input type="date" id="lastVerification" class="w-full p-3 border rounded-lg">
                            </div>

                            <button onclick="calculateNextVerification()"
                                class="w-full py-3 bg-purple-600 text-white font-bold rounded-lg hover:bg-purple-700">
                                Calculer la Prochaine √âch√©ance
                            </button>

                            <div id="verificationResult"
                                class="hidden mt-4 p-4 bg-purple-50 rounded-lg border border-purple-200">
                                <div class="font-bold text-purple-800">Prochaine v√©rification :</div>
                                <div class="text-xl font-bold text-purple-600" id="nextVerificationDate"></div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Outils existants (Checklist et Glossaire) -->
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                    <!-- Checklist -->
                    <div class="bg-white rounded-xl shadow-sm p-6 border border-stone-200">
                        <div class="flex justify-between items-center mb-4">
                            <h2 class="text-xl font-bold text-slate-800">Checklist "Jour J"</h2>
                            <button onclick="resetChecklist()"
                                class="text-sm text-orange-600 hover:text-orange-800 font-medium flex items-center">
                                <i class="fas fa-rotate-right mr-2"></i>R√©initialiser
                            </button>
                        </div>
                        <p class="text-sm text-stone-500 mb-6">Avant l'arriv√©e de la commission de s√©curit√©.</p>

                        <div class="space-y-4" id="checklist-container">
                            <!-- Generated by JS -->
                        </div>
                    </div>

                    <!-- Glossaire -->
                    <div class="bg-white rounded-xl shadow-sm p-6 border border-stone-200">
                        <h2 class="text-xl font-bold text-slate-800 mb-6">Glossaire Technique</h2>
                        <div class="space-y-6 max-h-[500px] overflow-y-auto custom-scroll pr-2">
                            <div class="border-l-4 border-emerald-500 pl-4">
                                <h4 class="font-bold text-sm text-stone-800">Haubans</h4>
                                <p class="text-sm text-stone-600 mt-1">C√¢bles ou sangles assurant la stabilit√© lat√©rale
                                    des m√¢ts. Doivent √™tre tendus correctement.</p>
                            </div>
                            <div class="border-l-4 border-emerald-500 pl-4">
                                <h4 class="font-bold text-sm text-stone-800">Tirant (Tir-fort)</h4>
                                <p class="text-sm text-stone-600 mt-1">Dispositif m√©canique permettant de mettre en
                                    tension les c√¢bles. Doit √™tre s√©curis√©.</p>
                            </div>
                            <div class="border-l-4 border-emerald-500 pl-4">
                                <h4 class="font-bold text-sm text-stone-800">Pinces</h4>
                                <p class="text-sm text-stone-600 mt-1">√âl√©ments de jonction de l'ossature m√©tallique.
                                    Doivent toutes √™tre clavet√©es ou goupill√©es.</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

    </main>

    <!-- Pied de page -->
    <footer class="bg-[#e9ecef] text-[#495057] py-8 mt-12 border-t border-[#dee2e6]">
        <div class="max-w-8xl mx-auto px-6">
            <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
                <div>

                    <!-- Section 1 -->
                    <h4 class="text-xl mb-4 text-[#343a40]">Portail de veille juridique ERP & CTS</h4>
                    <p class="text-[#6c757d] text-sm mb-2">
                        Suite d'Applications destin√©es aux
                        R√©gisseurs, Exploitants & Organismes de Formation
                    </p>

                    <p class="text-[#495057] text-sm font-medium mb-2 mt-4">
                        L'Application ne se substitue pas :
                    </p>
                    <ul class="text-[#6c757d] text-sm space-y-1 mb-4">
                        <li>‚Ä¢ Aux textes officiels publi√©s</li>
                        <li>‚Ä¢ √Ä l'avis d'experts certifi√©s</li>
                        <li>‚Ä¢ Aux commissions de s√©curit√© comp√©tentes</li>
                        <li>‚Ä¢ √Ä la jurisprudence en vigueur</li>
                    </ul>

                    <p class="text-[#6c757d] text-sm">
                        <small>Mise √† jour : Janvier 2026</small>
                    </p>
                </div>

                <!-- Section 2 -->
                <div class="md:border- md:border-[] md:pl-8">
                    <h4 class="text-xl mb-4 text-[#343a40]">Applications</h4>

                    <div class="space-y-4">
                        <a href="https://firegie.fr/index.html#accueil" target="_blank"
                            class="flex items-start text-[#495057] hover:text-[#0d6efd] transition">
                            <i class="fas fa-external-link-alt mr-2 mt-1"></i>
                            <div>
                                <h5 class="text-[0.95rem] font-medium">Portail de veille juridique ERP & CTS</h5>
                                <p class="text-sm text-[#6c757d] mt-1">
                                    Suite d'Applications destin√©e aux
                                    R√©gisseurs, Exploitants & Organismes de Formation
                                </p>
                            </div>
                        </a>

                        <a href="https://firegie.fr/apps/reglementation-cts/index.html" target="_blank"
                            class="flex items-start text-[#495057] hover:text-[#0d6efd] transition">
                            <i class="fas fa-external-link-alt mr-2 mt-1"></i>
                            <div>
                                <h5>R√©glementation Spectacle Itin√©rant</h5>
                                <p class="text-sm text-[#6c757d] mt-1">
                                    Outils de veille juridique & de s√©curit√© du Spectacle Itin√©rant
                                </p>
                            </div>
                        </a>

                        <a href="https://firegie.fr/apps/simulation/index.html" target="_blank"
                            class="flex items-start text-[#495057] hover:text-[#0d6efd] transition">
                            <i class="fas fa-external-link-alt mr-2 mt-1"></i>
                            <div>
                                <h5 class="text-[0.95rem] font-medium">Outil de Simulation S√©curit√©</h5>
                                <p class="text-sm text-[#6c757d] mt-1">
                                    Simulez votre Cat√©gorie ERP, vos d√©gagements UP, √âch. de Beaufort
                                </p>
                            </div>
                        </a>

                        <a href="https://firegie.fr/apps/reglementation-erp/index.html" target="_blank"
                            class="flex items-start text-[#495057] hover:text-[#0d6efd] transition">
                            <i class="fas fa-external-link-alt mr-2 mt-1"></i>
                            <div>
                                <h5>R√©glementation ERP</h5>
                                <p class="text-sm text-[#6c757d] mt-1">
                                    Application interactive des textes officiels pour consulter rapidement la
                                    R√®glementation ERP (CCH, Arr√™t√© du 25 juin 1980)
                                </p>
                            </div>
                        </a>
                    </div>
                </div>

                <!-- Section 3 -->
                <div class="md:border- md:border-[] md:pl-8">
                    <h4 class="text-xl mb-4 text-[#343a40]">Formation</h4>
                    <div class="space-y-4">
                        <a href="https://firegie.fr/apps/focus-reglementation/index.html#accueil" target="_blank"
                            class="flex items-start text-[#495057] hover:text-[#0d6efd] transition">
                            <i class="fas fa-external-link-alt mr-2 mt-1"></i>
                            <div>
                                <h5 class="text-[0.95rem] font-medium">Focus R√©glementation</h5>
                                <p class="text-sm text-[#6c757d] mt-1">
                                    Guide pour comprendre l'architecture de la
                                    r√©glementation officielle ERP
                                </p>
                            </div>
                        </a>

                        <a href="https://firegie.fr/apps/securite-incendie/index.html" target="_blank"
                            class="flex items-start text-[#495057] hover:text-[#0d6efd] transition">
                            <i class="fas fa-external-link-alt mr-2 mt-1"></i>
                            <div>
                                <h5>Guide de la S√©curit√© Incendie</h5>
                                <p class="text-sm text-[#6c757d] mt-1">
                                    Synth√®se des obligations des responsables de la s√©curit√© incendie ERP
                                </p>
                            </div>
                        </a>

                        <a href="https://firegie.fr/apps/formation-securite/index.html" target="_blank"
                            class="flex items-start text-[#495057] hover:text-[#0d6efd] transition">
                            <i class="fas fa-external-link-alt mr-2 mt-1"></i>
                            <div>
                                <h5>Formation S√©curit√© ERP</h5>
                                <p class="text-sm text-[#6c757d] mt-1">
                                    Outil p√©dagogique destin√© √† la formation des responsables techniques
                                    d'ERP Type L & CTS.
                                </p>
                            </div>
                        </a>

                        <a href="https://firegie.fr/apps/quiz/index.html" target="_blank"
                            class="flex items-start text-[#495057] hover:text-[#0d6efd] transition">
                            <i class="fas fa-external-link-alt mr-2 mt-1"></i>
                            <div>
                                <h5>Le Quiz du R√©gisseur</h5>
                                <p class="text-sm text-[#6c757d] mt-1">
                                    Amusez-vous, apprenez, √©valuez vos comp√©tences
                                </p>
                            </div>
                        </a>
                    </div>
                </div>
            </div>

            <div class="mt-8 pt-8 border-t border-[#ced4da] text-center text-sm text-[#6c757d]">
                <p>
                    <i class="fas fa-gavel mr-2"></i>
                    Portail de veille juridique CTS & ERP Type L
                </p>
                <p class="mt-2">
                    Partage & Contribution ‚Ä¢ Contact : philippe.potier-regie@proton.me
                </p>
            </div>
        </div>
    </footer>

    <script data-cfasync="false" src="/cdn-cgi/scripts/5c5dd728/cloudflare-static/email-decode.min.js"></script>
    <script>
        // --- √âtat global ---
        const state = {
            currentView: 'dashboard',
            checklist: {},
            wind: 45,
            maxWind: 100,
            capacity: 450,
            materialFocus: 1,
            observations: [],
            offlineMode: false
        };

        // --- Variables pour stocker les instances de graphiques ---
        window.chartInstances = {};

        // --- Fonction pour initialiser les graphiques du Dashboard ---
        function initDashboardCharts() {
            // Si Chart.js n'est pas charg√©, on attend
            if (typeof Chart === 'undefined') {
                console.warn('Chart.js non charg√©, r√©essayez dans 500ms');
                setTimeout(initDashboardCharts, 500);
                return;
            }

            // V√©rifie si les graphiques existent d√©j√† et les d√©truit
            if (window.chartInstances['windThresholdChart']) {
                window.chartInstances['windThresholdChart'].destroy();
            }
            if (window.chartInstances['responsibilityChart']) {
                window.chartInstances['responsibilityChart'].destroy();
            }

            // Code pour le graphique des seuils de vent
            const windThresholdCanvas = document.getElementById('windThresholdChart');
            if (windThresholdCanvas) {
                window.chartInstances['windThresholdChart'] = new Chart(windThresholdCanvas, {
                    type: 'bar',
                    data: {
                        labels: ['Surveillance', 'Arr√™t Attractions', '√âvacuation'],
                        datasets: [{
                            label: 'Vitesse (km/h)',
                            data: [72, 85, 100],
                            backgroundColor: [
                                'rgba(251, 191, 36, 0.7)',
                                'rgba(249, 115, 22, 0.7)',
                                'rgba(220, 38, 38, 0.7)'
                            ],
                            borderColor: [
                                'rgb(251, 191, 36)',
                                'rgb(249, 115, 22)',
                                'rgb(220, 38, 38)'
                            ],
                            borderWidth: 1,
                            borderRadius: 4
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: { display: false },
                            tooltip: {
                                callbacks: {
                                    label: function (context) {
                                        const labels = [
                                            'Pr√©-alerte : Surveillance renforc√©e',
                                            'Arr√™t imm√©diat des attractions a√©riennes',
                                            '√âvacuation du public obligatoire'
                                        ];
                                        return labels[context.dataIndex];
                                    }
                                }
                            }
                        },
                        scales: {
                            y: {
                                beginAtZero: true,
                                title: {
                                    display: true,
                                    text: 'km/h'
                                }
                            }
                        }
                    }
                });
            }

            // Code pour le graphique des responsabilit√©s
            const responsibilityCanvas = document.getElementById('responsibilityChart');
            if (responsibilityCanvas) {
                window.chartInstances['responsibilityChart'] = new Chart(responsibilityCanvas, {
                    type: 'doughnut',
                    data: {
                        labels: ['Exploitant', 'Organisme Contr√¥le', 'Autorit√©', 'Techniciens'],
                        datasets: [{
                            data: [40, 30, 20, 10],
                            backgroundColor: [
                                'rgba(30, 58, 138, 0.8)',
                                'rgba(234, 88, 12, 0.8)',
                                'rgba(51, 65, 85, 0.8)',
                                'rgba(148, 163, 184, 0.8)'
                            ],
                            borderWidth: 0,
                            hoverOffset: 10
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                position: 'bottom',
                                labels: {
                                    usePointStyle: true,
                                    font: { size: 11 },
                                    padding: 20
                                }
                            },
                            tooltip: {
                                callbacks: {
                                    label: function (context) {
                                        const descriptions = [
                                            'Responsable p√©nalement de la s√©curit√©',
                                            'V√©rifie la conformit√© technique',
                                            'Signe l\'arr√™t√© d\'ouverture',
                                            'Ex√©cute les travaux et maintenance'
                                        ];
                                        return descriptions[context.dataIndex];
                                    }
                                }
                            }
                        },
                        cutout: '50%'
                    }
                });
            }
        }

        // --- Navigation Logic ---
        function switchTab(tabId) {
            // Toggle Views
            document.querySelectorAll('.tab-content').forEach(el => el.classList.remove('active'));
            document.getElementById(tabId).classList.add('active');

            // Update Nav Styles
            document.querySelectorAll('.nav-btn').forEach(btn => {
                btn.classList.remove('border-orange-600', 'text-orange-600', 'border-emerald-600', 'text-emerald-600');
                btn.classList.add('border-transparent');
            });

            const activeBtn = document.getElementById('btn-' + tabId);
            if (activeBtn) {
                if (tabId === 'outils') {
                    activeBtn.classList.add('border-emerald-600', 'text-emerald-600');
                } else {
                    activeBtn.classList.add('border-orange-600', 'text-orange-600');
                }
                activeBtn.classList.remove('border-transparent');
            }

            state.currentView = tabId;

            // Initialiser le contenu sp√©cifique si n√©cessaire
            if (tabId === 'dashboard') {
                setTimeout(initDashboardCharts, 100);
            } else if (tabId === 'calculs') {
                setTimeout(initCalculsTab, 100);
            } else if (tabId === 'controle') {
                setTimeout(initControleTab, 100);
            } else if (tabId === 'documents') {
                setTimeout(initDocumentsTab, 100);


            } else if (tabId === 'cts') {
                setTimeout(() => {
                    initNewCharts();
                    initCtsWindSimulator();
                }, 100);
            } else if (tabId === 'animals' || tabId === 'technique') {
                setTimeout(initNewCharts, 100);
            }
        }


        // --- Initialisation des onglets ---
        function initCalculsTab() {
            // Initialiser le slider de hauteur
            const heightSlider = document.getElementById('heightSlider');
            const heightValue = document.getElementById('heightValue');
            if (heightSlider && heightValue) {
                heightSlider.addEventListener('input', function () {
                    heightValue.textContent = this.value + ' m';
                });
            }

            // Initialiser le slider de charge
            const loadSlider = document.getElementById('loadSlider');
            const loadValue = document.getElementById('loadValue');
            if (loadSlider && loadValue) {
                loadSlider.addEventListener('input', function () {
                    loadValue.textContent = this.value + ' kN';
                });
            }

            // Initialiser les nouveaux graphiques
            initNewCharts();

            // Initialiser les nouveaux simulateurs
            initNewSimulators();

            // Initialiser la table des charges
            updateChargeTable();

            // Afficher les r√©sultats par d√©faut
            setTimeout(() => {
                calculateCategory(); // Cat√©gorisation Article 5
                updateChargeCalculations(); // Charges
                calculateFooting(); // Calage
                calculateWindLoad(); // Vent
            }, 100);
        }

        function initControleTab() {
            // Initialiser la date pour l'attestation
            const dateMontage = document.getElementById('dateMontage');
            if (dateMontage) {
                const today = new Date().toISOString().split('T')[0];
                dateMontage.value = today;
            }

            // Charger la checklist
            loadChecklist();

            // Charger les observations
            loadObservations();
        }

        function initDocumentsTab() {
            // Rien de sp√©cifique pour l'instant
        }

        // --- Initialisation des nouveaux graphiques ---
        function initNewCharts() {
            // V√©rifier si Chart.js est charg√©
            if (typeof Chart === 'undefined') {
                console.warn('Chart.js non charg√©, r√©essayez dans 500ms');
                setTimeout(initNewCharts, 500);
                return;
            }

            Chart.defaults.font.family = "'Inter', sans-serif";

            // D√©truire les anciennes instances si elles existent
            ['erpChart', 'evacChart', 'beaufortChart', 'windChartCts', 'animalTimelineChart', 'windResistanceChart'].forEach(id => {
                if (window.chartInstances[id]) {
                    window.chartInstances[id].destroy();
                }
            });

            // Graphique de r√©partition des ERP
            const erpCanvas = document.getElementById('erpChart');
            if (erpCanvas) {
                window.chartInstances['erpChart'] = new Chart(erpCanvas, {
                    type: 'doughnut',
                    data: {
                        labels: ['1√®re cat√©gorie', '2√®me cat√©gorie', '3√®me cat√©gorie', '4√®me cat√©gorie', '5√®me cat√©gorie'],
                        datasets: [{
                            data: [2, 5, 8, 25, 60],
                            backgroundColor: [
                                'rgba(220, 38, 38, 0.8)',
                                'rgba(249, 115, 22, 0.8)',
                                'rgba(251, 191, 36, 0.8)',
                                'rgba(59, 130, 246, 0.8)',
                                'rgba(34, 197, 94, 0.8)'
                            ],
                            borderWidth: 0,
                            hoverOffset: 15
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                position: 'right',
                                labels: {
                                    usePointStyle: true,
                                    font: { size: 10 },
                                    padding: 15
                                }
                            },
                            tooltip: {
                                callbacks: {
                                    label: function (context) {
                                        const descriptions = [
                                            '> 1500 personnes',
                                            '701 - 1500 personnes',
                                            '301 - 700 personnes',
                                            '151 - 300 personnes',
                                            '‚â§ 150 personnes'
                                        ];
                                        return `${context.label}: ${context.parsed}% - ${descriptions[context.dataIndex]}`;
                                    }
                                }
                            }
                        },
                        cutout: '45%'
                    }
                });
            }

            // Graphique d'√©vacuation
            const evacCanvas = document.getElementById('evacChart');
            if (evacCanvas) {
                window.chartInstances['evacChart'] = new Chart(evacCanvas, {
                    type: 'line',
                    data: {
                        labels: ['0', '100', '200', '300', '400', '500', '600', '700', '800', '900', '1000'],
                        datasets: [{
                            label: 'Unit√©s de Passage n√©cessaires',
                            data: [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10],
                            borderColor: 'rgb(34, 197, 94)',
                            backgroundColor: 'rgba(34, 197, 94, 0.1)',
                            fill: true,
                            tension: 0.3,
                            pointRadius: 4,
                            pointBackgroundColor: 'rgb(34, 197, 94)',
                            pointBorderColor: '#fff',
                            pointBorderWidth: 2
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: {
                            y: {
                                beginAtZero: true,
                                title: {
                                    display: true,
                                    text: 'Unit√©s de Passage (UP)'
                                }
                            },
                            x: {
                                title: {
                                    display: true,
                                    text: 'Nombre de personnes'
                                }
                            }
                        },
                        plugins: {
                            legend: {
                                display: true,
                                position: 'top'
                            },
                            tooltip: {
                                callbacks: {
                                    label: function (context) {
                                        const width = (context.raw === 1 ? 0.90 : context.raw * 0.60).toFixed(2);
                                        return `${context.raw} UP = ${width} m de largeur`;
                                    }
                                }
                            }
                        }
                    }
                });
            }

            // Graphique √©chelle de Beaufort
            const beaufortCanvas = document.getElementById('beaufortChart');
            if (beaufortCanvas) {
                window.chartInstances['beaufortChart'] = new Chart(beaufortCanvas, {
                    type: 'bar',
                    data: {
                        labels: ['Calme (0-50)', 'Vigilance (50-85)', 'Danger (85-100)', 'Critique (100+)'],
                        datasets: [{
                            label: 'Risque Structurel',
                            data: [10, 40, 80, 100],
                            backgroundColor: ['#10B981', '#FBBF24', '#F97316', '#EF4444'],
                            borderRadius: 4
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: {
                            y: {
                                display: false,
                                max: 100
                            },
                            x: {
                                grid: { display: false }
                            }
                        },
                        plugins: {
                            legend: { display: false },
                            tooltip: {
                                callbacks: {
                                    label: (ctx) => {
                                        const descs = [
                                            "Exploitation normale",
                                            "Surveillance ancrages requise",
                                            "Pr√©parez √©vacuation",
                                            "Affalement toile / Fuite"
                                        ];
                                        return descs[ctx.dataIndex];
                                    }
                                }
                            }
                        }
                    }
                });
            }

            // Graphique √©chelle de Beaufort pour l'onglet CTS
            const windChartCtsCanvas = document.getElementById('windChartCts');
            if (windChartCtsCanvas) {
                window.chartInstances['windChartCts'] = new Chart(windChartCtsCanvas, {
                    type: 'bar',
                    data: {
                        labels: ['Calme (0-50)', 'Vigilance (50-85)', 'Danger (85-100)', 'Critique (100+)'],
                        datasets: [{
                            label: 'Risque Structurel',
                            data: [10, 40, 80, 100],
                            backgroundColor: ['#10B981', '#FBBF24', '#F97316', '#EF4444'],
                            borderRadius: 4
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: {
                            y: {
                                display: false,
                                max: 100
                            },
                            x: {
                                grid: { display: false }
                            }
                        },
                        plugins: {
                            legend: { display: false },
                            tooltip: {
                                callbacks: {
                                    label: (ctx) => {
                                        const descs = [
                                            "Exploitation normale",
                                            "Surveillance ancrages requise",
                                            "Pr√©parez √©vacuation",
                                            "Affalement toile / Fuite"
                                        ];
                                        return descs[ctx.dataIndex];
                                    }
                                }
                            }
                        }
                    }
                });
            }

            // Graphique timeline animaux
            const animalTimelineCanvas = document.getElementById('animalTimelineChart');
            if (animalTimelineCanvas) {
                window.chartInstances['animalTimelineChart'] = new Chart(animalTimelineCanvas, {
                    type: 'line',
                    data: {
                        labels: ['2021', '2023', '2025', '2028'],
                        datasets: [{
                            label: 'Niveau de Restriction',
                            data: [0, 30, 60, 100],
                            borderColor: '#ea580c',
                            backgroundColor: 'rgba(234, 88, 12, 0.1)',
                            fill: true,
                            tension: 0.3,
                            pointRadius: 6,
                            pointBackgroundColor: '#fff',
                            pointBorderColor: '#ea580c',
                            pointBorderWidth: 2
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: {
                            y: {
                                display: true,
                                title: {
                                    display: true,
                                    text: '% Interdiction'
                                },
                                max: 100
                            }
                        },
                        plugins: {
                            tooltip: {
                                callbacks: {
                                    label: (ctx) => {
                                        const events = {
                                            '2021': 'Promulgation Loi',
                                            '2023': 'Interdiction Reproduction/Acquisition',
                                            '2025': 'Transition...',
                                            '2028': 'INTERDICTION TOTALE'
                                        };
                                        return events[ctx.label] || '';
                                    }
                                }
                            }
                        }
                    }
                });
            }

            // Graphique r√©sistance au vent
            const windResistanceCanvas = document.getElementById('windResistanceChart');
            if (windResistanceCanvas) {
                window.chartInstances['windResistanceChart'] = new Chart(windResistanceCanvas, {
                    type: 'bar',
                    data: {
                        labels: ['Ouverture Public', 'Structure Renforc√©e', 'Norme NV65 (Moyenne)'],
                        datasets: [{
                            label: 'Vitesse de Vent (km/h)',
                            data: [100, 120, 140],
                            backgroundColor: ['#dc2626', '#ea580c', '#57534e'],
                            borderRadius: 4
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: {
                            y: {
                                beginAtZero: true,
                                title: {
                                    display: true,
                                    text: 'Vitesse (km/h)'
                                }
                            }
                        },
                        plugins: {
                            tooltip: {
                                callbacks: {
                                    label: function (context) {
                                        return context.raw + ' km/h - Seuil Critique';
                                    }
                                }
                            }
                        }
                    }
                });
            }
        }

        // --- Fonctions pour les nouveaux simulateurs ---
        function initNewSimulators() {
            // Simulateur de classification ERP
            const capacityInput = document.getElementById('capacityInput');
            const calcBtn = document.getElementById('calcBtn');
            const erpResult = document.getElementById('erpResult');

            if (calcBtn) {
                calcBtn.addEventListener('click', function () {
                    const capacity = parseInt(capacityInput.value) || 0;

                    let category, type, secu, control;

                    if (capacity > 1500) {
                        category = "1√®re cat√©gorie";
                        type = "L (Salle de spectacle)";
                        secu = "SSIAP 3 + √©quipe de s√©curit√©";
                        control = "Visite de commission 1x/an + contr√¥le permanent";
                    } else if (capacity > 700) {
                        category = "2√®me cat√©gorie";
                        type = "L (Salle de spectacle)";
                        secu = "SSIAP 2 obligatoire";
                        control = "Visite de commission 1x/an";
                    } else if (capacity > 300) {
                        category = "3√®me cat√©gorie";
                        type = "L (Salle de spectacle)";
                        secu = "SSIAP 1 obligatoire";
                        control = "Visite de commission 1x/2 ans";
                    } else if (capacity > 150) {
                        category = "4√®me cat√©gorie";
                        type = "L (Salle de spectacle)";
                        secu = "SSIAP 1 obligatoire";
                        control = "Visite de commission 1x/an";
                    } else {
                        category = "5√®me cat√©gorie";
                        type = "L (Salle de spectacle)";
                        secu = "Personnel form√© √† la s√©curit√©";
                        control = "Visite sur demande uniquement";
                    }

                    document.getElementById('resCat').textContent = category;
                    document.getElementById('resType').textContent = type;
                    document.getElementById('resSecu').textContent = secu;
                    document.getElementById('resControl').textContent = control;

                    erpResult.classList.remove('hidden');
                });

                // D√©clencher le calcul initial
                calcBtn.click();
            }

            // Simulateur d'√©vacuation
            const evacSlider = document.getElementById('evacSlider');
            const evacValue = document.getElementById('evacValue');
            const upResult = document.getElementById('upResult');
            const widthResult = document.getElementById('widthResult');

            if (evacSlider) {
                const updateEvacuation = () => {
                    const persons = parseInt(evacSlider.value);
                    evacValue.textContent = persons;

                    // Calcul des UP (1 UP par 100 personnes)
                    const up = Math.ceil(persons / 100);
                    upResult.textContent = up;

                    // Calcul de la largeur (1 UP = 0.60m, mais 1 UP seule = 0.90m)
                    const width = up === 1 ? 0.90 : up * 0.60;
                    widthResult.textContent = width.toFixed(2) + 'm';
                };

                evacSlider.addEventListener('input', updateEvacuation);
                updateEvacuation(); // Initialiser
            }

            // Simulateur de vent
            const windSlider = document.getElementById('currentWindInput');
            const windDisplay = document.getElementById('currentWindDisplay');
            const maxWindSelect = document.getElementById('maxWindInput');

            if (windSlider) {
                const updateWindStatus = () => {
                    const current = parseInt(windSlider.value);
                    const max = parseInt(maxWindSelect.value);

                    windDisplay.textContent = current + " km/h";

                    const statusBox = document.getElementById('weatherStatus');
                    const icon = document.getElementById('weatherIcon');
                    const title = document.getElementById('weatherTitle');
                    const desc = document.getElementById('weatherDesc');

                    const warningThreshold = max * 0.75;

                    statusBox.className = "p-4 rounded-lg flex items-start gap-3 transition-colors duration-300 border";

                    if (current >= max) {
                        statusBox.classList.add('bg-red-100', 'border-red-200');
                        icon.textContent = "üö®";
                        title.textContent = "√âVACUATION IMM√âDIATE";
                        title.className = "font-bold text-red-800";
                        desc.textContent = `Vent sup√©rieur √† la limite (${max} km/h). Affalement de la structure ou √©vacuation du public requis.`;
                        desc.className = "text-sm text-red-700";
                    } else if (current >= warningThreshold) {
                        statusBox.classList.add('bg-orange-100', 'border-orange-200');
                        icon.textContent = "‚ö†Ô∏è";
                        title.textContent = "Vigilance Renforc√©e";
                        title.className = "font-bold text-orange-800";
                        desc.textContent = `Vent √† >75% de la limite. Pr√©parez l'√©vacuation. V√©rifiez les ancrages. Arr√™t des effets sc√©niques a√©riens.`;
                        desc.className = "text-sm text-orange-700";
                    } else {
                        statusBox.classList.add('bg-green-100', 'border-green-200');
                        icon.textContent = "‚úÖ";
                        title.textContent = "Situation Normale";
                        title.className = "font-bold text-green-800";
                        desc.textContent = "Vitesse de vent admissible. Exploitation autoris√©e sous surveillance.";
                        desc.className = "text-sm text-green-700";
                    }
                };


                windSlider2.addEventListener('input', updateWindStatus2);
                maxWindSelect2.addEventListener('change', updateWindStatus2);
                updateWindStatus2(); // Initialiser
            }
        }

        // Fonction d√©di√©e pour initialiser le simulateur de vent de l'onglet CTS
        function initCtsWindSimulator() {
            const windSlider2 = document.getElementById('currentWindInput2');
            const windDisplay2 = document.getElementById('currentWindDisplay2');
            const maxWindSelect2 = document.getElementById('maxWindInput2');

            if (!windSlider2 || !windDisplay2 || !maxWindSelect2) {
                console.warn('√âl√©ments du simulateur CTS non trouv√©s');
                return;
            }

            // Retirer les anciens √©couteurs d'√©v√©nements
            const newWindSlider2 = windSlider2.cloneNode(true);
            windSlider2.parentNode.replaceChild(newWindSlider2, windSlider2);

            const newMaxWindSelect2 = maxWindSelect2.cloneNode(true);
            maxWindSelect2.parentNode.replaceChild(newMaxWindSelect2, maxWindSelect2);

            const updateWindStatus2 = () => {
                const current = parseInt(newWindSlider2.value);
                const max = parseInt(newMaxWindSelect2.value);

                windDisplay2.textContent = current + " km/h";

                const statusBox = document.getElementById('weatherStatus2');
                const icon = document.getElementById('weatherIcon2');
                const title = document.getElementById('weatherTitle2');
                const desc = document.getElementById('weatherDesc2');

                if (!statusBox || !icon || !title || !desc) {
                    console.warn('√âl√©ments de statut CTS non trouv√©s');
                    return;
                }

                const warningThreshold = max * 0.75;

                statusBox.className = "p-4 rounded-lg flex items-start gap-3 transition-colors duration-300 border";

                if (current >= max) {
                    statusBox.classList.add('bg-red-100', 'border-red-200');
                    icon.textContent = "üö®";
                    title.textContent = "√âVACUATION IMM√âDIATE";
                    title.className = "font-bold text-red-800";
                    desc.textContent = `Vent sup√©rieur √† la limite (${max} km/h). Affalement de la structure ou √©vacuation du public requis.`;
                    desc.className = "text-sm text-red-700";
                } else if (current >= warningThreshold) {
                    statusBox.classList.add('bg-orange-100', 'border-orange-200');
                    icon.textContent = "‚ö†Ô∏è";
                    title.textContent = "Vigilance Renforc√©e";
                    title.className = "font-bold text-orange-800";
                    desc.textContent = `Vent √† >75% de la limite. Pr√©parez l'√©vacuation. V√©rifiez les ancrages. Arr√™t des effets sc√©niques a√©riens.`;
                    desc.className = "text-sm text-orange-700";
                } else {
                    statusBox.classList.add('bg-green-100', 'border-green-200');
                    icon.textContent = "‚úÖ";
                    title.textContent = "Situation Normale";
                    title.className = "font-bold text-green-800";
                    desc.textContent = "Vitesse de vent admissible. Exploitation autoris√©e sous surveillance.";
                    desc.className = "text-sm text-green-700";
                }
            };

            newWindSlider2.addEventListener('input', updateWindStatus2);
            newMaxWindSelect2.addEventListener('change', updateWindStatus2);

            // Initialiser imm√©diatement
            updateWindStatus2();
        }

        // --- Fonctions pour l'onglet Calculs ---
        function calculateCategory() {
            const structureType = document.getElementById('structureType').value;
            const height = parseFloat(document.getElementById('heightSlider').value);
            const specificType = document.getElementById('specificType').value;

            let category = '';
            let description = '';
            let requirements = [];
            let color = 'border-orange-500';

            if (structureType === 'OP') {
                // Cat√©gorisation OP
                if (height < 1.20) {
                    category = 'OP1';
                    description = 'Hauteur de chute < 1.20 m';
                    requirements = [
                        'Attestation de bon montage suffisante',
                        'Examen visuel par l\'installateur',
                        'Respect des notices techniques',
                        'V√©rification des points critiques'
                    ];
                    color = 'border-emerald-500';
                } else if (height < 3.50) {
                    category = 'OP2';
                    description = 'Hauteur de chute entre 1.20 et 3.50 m';
                    requirements = [
                        'V√©rification par contr√¥leur technique',
                        'Inspection par technicien comp√©tent',
                        'Attestation de bon montage obligatoire',
                        'Rapport d\'inspection type'
                    ];
                    color = 'border-orange-500';
                } else {
                    category = 'OP3';
                    description = 'Hauteur de chute > 3.50 m';
                    requirements = [
                        'V√©rification par contr√¥leur technique obligatoire',
                        'Inspection par organisme agr√©√© ERP/CTS',
                        'Rapport d\'inspection d√©taill√©',
                        'Suivi trimestriel en implantation prolong√©e'
                    ];
                    color = 'border-red-500';
                }
            } else {
                // Cat√©gorisation OS
                if (height < 3.50) {
                    category = 'OS1';
                    description = 'Hauteur de chute < 3.50 m';
                    requirements = [
                        'Notice technique du fabricant',
                        'Attestation de bon montage',
                        'V√©rification de l\'√©tat de conservation',
                        'Contr√¥le des assemblages'
                    ];
                    color = 'border-emerald-500';
                } else if (height < 6.20) {
                    category = 'OS2';
                    description = 'Hauteur de chute entre 3.50 et 6.20 m';
                    requirements = [
                        'Avis sur mod√®le ou dossier technique',
                        'Inspection par technicien comp√©tent',
                        'V√©rification des √©quipements suspendus',
                        'Contr√¥le des fixations'
                    ];
                    color = 'border-orange-500';
                } else {
                    category = 'OS3';
                    description = 'Hauteur de chute > 6.20 m';
                    requirements = [
                        'Avis sur dossier technique obligatoire',
                        'Inspection par organisme agr√©√©',
                        'V√©rification redondance suspension',
                        'Contr√¥le des √©quipements de levage',
                        'Essais de charge obligatoires'
                    ];
                    color = 'border-red-500';
                }
            }

            // Affichage des r√©sultats
            document.getElementById('resultCategory').textContent = category;
            document.getElementById('resultDescription').textContent = description;
            document.getElementById('resultRequirements').innerHTML = requirements
                .map(req => `<li>‚Ä¢ ${req}</li>`)
                .join('');

            // Mettre √† jour la couleur de la bordure
            const categoryColor = document.getElementById('categoryColor');
            categoryColor.className = `p-4 bg-white rounded border-l-4 ${color}`;

            // Sauvegarder le calcul
            saveCalculation('categorie', { category, height, structureType });
        }

        function updateChargeTable() {
            const chargeData = [
                { type: 'Tribunes assises', vertical: 5, horizontal: '6% de la charge verticale', concentree: 3 },
                { type: 'Tribunes debout', vertical: 6, horizontal: '6% de la charge verticale', concentree: 3 },
                { type: 'Sc√®nes/Podiums', vertical: 5, horizontal: '6% de la charge verticale', concentree: 3 },
                { type: 'Passerelles', vertical: 4, horizontal: '3 kN/m', concentree: 2 },
                { type: 'Escaliers', vertical: 5, horizontal: '2 kN/m', concentree: 2 }
            ];

            const tbody = document.getElementById('chargeTableBody');
            tbody.innerHTML = chargeData.map((item, index) => `
                <tr class="${index % 2 === 0 ? 'bg-stone-50' : ''}">
                    <td class="px-4 py-3 text-sm font-medium text-stone-900">${item.type}</td>
                    <td class="px-4 py-3">
                        <input type="number" value="${item.vertical}" 
                               class="w-24 p-2 border rounded charge-input" 
                               data-type="${item.type.toLowerCase().replace(' ', '-')}"
                               onchange="updateChargeCalculations()">
                    </td>
                    <td class="px-4 py-3 text-sm text-stone-600">${item.horizontal}</td>
                    <td class="px-4 py-3">
                        <input type="number" value="${item.concentree}" class="w-24 p-2 border rounded">
                    </td>
                </tr>
            `).join('');

            updateChargeCalculations();
        }

        function updateChargeCalculations() {
            let totalCharge = 0;
            let surfaceCharge = 100; // Surface par d√©faut 100 m¬≤

            // Calculer la charge totale (simplifi√©)
            document.querySelectorAll('.charge-input').forEach(input => {
                const charge = parseFloat(input.value) || 0;
                totalCharge += charge * surfaceCharge; // Charge en kN
            });

            const groundPressure = totalCharge / surfaceCharge;

            document.getElementById('totalCharge').textContent = totalCharge.toFixed(0) + ' kN';
            document.getElementById('surfaceCharge').textContent = surfaceCharge + ' m¬≤';
            document.getElementById('groundPressure').textContent = groundPressure.toFixed(1) + ' kN/m¬≤';
        }

        function calculateFooting() {
            const load = parseFloat(document.getElementById('loadSlider').value);
            const soilType = document.getElementById('soilType').value;

            // Capacit√© portante du sol (bars convertis en kN/m¬≤)
            let soilCapacity = 0;
            switch (soilType) {
                case '1': soilCapacity = 100; break; // Terre battue
                case '2': soilCapacity = 80; break;  // Gazon
                case '3': soilCapacity = 200; break; // Bitume
                case '4': soilCapacity = 300; break; // B√©ton
            }

            // Surface minimale = charge / capacit√© du sol
            const area = load / soilCapacity;

            // Dimension recommand√©e (carr√©)
            const side = Math.sqrt(area);

            document.getElementById('footingArea').textContent = area.toFixed(2) + ' m¬≤';
            document.getElementById('footingDimensions').textContent = `${side.toFixed(2)} x ${side.toFixed(2)} m`;
            document.getElementById('footingResult').classList.remove('hidden');

            // Sauvegarder le calcul
            saveCalculation('calage', { load, soilType, area, dimensions: `${side.toFixed(2)}x${side.toFixed(2)}` });
        }

        function calculateWindLoad() {
            const type = document.getElementById('windStructureType').value;
            const length = parseFloat(document.getElementById('lengthInput').value) || 20;
            const width = parseFloat(document.getElementById('widthInput').value) || 10;
            const height = parseFloat(document.getElementById('heightWindInput').value) || 6;
            const windSpeed = parseFloat(document.getElementById('windSpeed').value) || 100;

            let surface = 0;
            let coeff = 1.0;

            switch (type) {
                case 'tribune':
                    surface = length * height * 0.5; // Approx ma√Ætre-couple
                    coeff = 1.3;
                    break;
                case 'scene':
                    surface = length * width;
                    coeff = 1.2;
                    break;
                case 'echafaudage':
                    surface = length * height * 0.5;
                    coeff = 1.5;
                    break;
                case 'passerelle':
                    surface = length * height * 0.3;
                    coeff = 1.4;
                    break;
            }

            // Formule simplifi√©e : F = 0.5 * œÅ * v¬≤ * S * C
            // œÅ ‚âà 1.2 kg/m¬≥, v en m/s
            const windSpeedMs = windSpeed / 3.6;
            const windForce = 0.5 * 1.2 * Math.pow(windSpeedMs, 2) * surface * coeff / 1000; // en kN

            document.getElementById('surfaceResult').textContent = surface.toFixed(1) + ' m¬≤';
            document.getElementById('coeffResult').textContent = coeff.toFixed(1);
            document.getElementById('windForceResult').textContent = windForce.toFixed(1) + ' kN';
            document.getElementById('windResult').classList.remove('hidden');

            // Sauvegarder le calcul
            saveCalculation('vent', { type, surface, coeff, windForce, windSpeed });
        }

        // --- Fonctions pour l'onglet Contr√¥le ---
        function generateAttestation() {
            const manifestation = document.getElementById('manifestationName').value || 'Manifestation non sp√©cifi√©e';
            const installateur = document.getElementById('installateurName').value || 'Installateur non sp√©cifi√©';
            const description = document.getElementById('descriptionAttestation').value || 'Non sp√©cifi√©';
            const nbPlaces = document.getElementById('nbPlaces').value || 'Non sp√©cifi√©';
            const pointHaut = document.getElementById('pointHaut').value || 'Non sp√©cifi√©';
            const dateMontage = document.getElementById('dateMontage').value || new Date().toLocaleDateString('fr-FR');

            const content = `
                <div class="space-y-6">
                    <div class="text-center border-b pb-4">
                        <h2 class="text-2xl font-bold">ATTESTATION DE BON MONTAGE</h2>
                        <p class="text-stone-600">Mat√©riels et Ensembles D√©montables - Mod√®le Article 67</p>
                    </div>
                    
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <p><strong>Manifestation :</strong> ${manifestation}</p>
                            <p><strong>Installateur :</strong> ${installateur}</p>
                        </div>
                        <div>
                            <p><strong>Date du montage :</strong> ${dateMontage}</p>
                            <p><strong>Lieu :</strong> [√Ä compl√©ter]</p>
                        </div>
                    </div>
                    
                    <div class="bg-stone-50 p-4 rounded">
                        <h3 class="font-bold mb-2">CARACT√âRISTIQUES DE L'ENSEMBLE</h3>
                        <p><strong>Descriptif :</strong> ${description}</p>
                        <p><strong>Nombre de places :</strong> ${nbPlaces}</p>
                        <p><strong>Point haut de la structure :</strong> ${pointHaut} m</p>
                        <p><strong>Cat√©gorie :</strong> [OP/OS - √Ä d√©terminer]</p>
                    </div>
                    
                    <div class="border-t pt-4">
                        <p>Je soussign√©(e), responsable du montage, certifie avoir mont√© ces mat√©riels conform√©ment :</p>
                        <ul class="list-disc ml-5 mt-2 space-y-1">
                            <li>Au Code du travail</li>
                            <li>Au Code de la Construction et de l'Habitation</li>
                            <li>Au Guide Pratique "Mat√©riels et Ensembles D√©montables"</li>
                            <li>√Ä la notice technique du fabricant</li>
                            <li>√Ä l'avis sur mod√®le ou dossier technique</li>
                        </ul>
                    </div>
                    
                    <div class="text-right pt-6 border-t">
                        <p>Fait le : ${new Date().toLocaleDateString('fr-FR')}</p>
                        <p class="mt-8">Signature et cachet :</p>
                        <div class="h-20 border border-stone-300 mt-2"></div>
                    </div>
                </div>
            `;

            document.getElementById('attestationContent').innerHTML = content;
            document.getElementById('attestationPreview').classList.remove('hidden');

            // Sauvegarder l'attestation
            saveAttestationData({ manifestation, installateur, description, nbPlaces, pointHaut, dateMontage });
        }

        function resetAttestation() {
            document.getElementById('manifestationName').value = '';
            document.getElementById('installateurName').value = '';
            document.getElementById('descriptionAttestation').value = '';
            document.getElementById('nbPlaces').value = '500';
            document.getElementById('pointHaut').value = '6.2';
            document.getElementById('dateMontage').value = new Date().toISOString().split('T')[0];
            document.getElementById('attestationPreview').classList.add('hidden');
        }

        function printAttestation() {
            const printContent = document.getElementById('attestationContent').innerHTML;
            const originalContent = document.body.innerHTML;

            document.body.innerHTML = `
                <!DOCTYPE html>
                <html>
                <head>
                    <title>Attestation de Bon Montage</title>
                    <style>
                        body { font-family: Arial, sans-serif; padding: 20px; }
                        .attestation { max-width: 800px; margin: 0 auto; }
                    </style>
                </head>
                <body>
                    <div class="attestation">${printContent}</div>
                </body>
                </html>
            `;

            window.print();
            document.body.innerHTML = originalContent;
            switchTab('controle');
        }

        function loadChecklist() {
            const type = document.getElementById('checklistType').value;
            let items = [];

            switch (type) {
                case 'tribune':
                    items = [
                        'Aplomb et alignement v√©rifi√©s',
                        'Calages et r√©partition charges conformes',
                        'Garde-corps pr√©sents et efficaces',
                        'Assises solidement fix√©es',
                        'Marquage des pi√®ces v√©rifi√©',
                        'D√©gagements libres et signal√©s',
                        'Ancrages contr√¥l√©s',
                        'Planchers sans risques de tr√©buchement',
                        'Fixations anti-soul√®vement pr√©sentes',
                        'V√©rification des assemblages'
                    ];
                    break;
                case 'scene':
                    items = [
                        'Structure rigide et stable',
                        'Plancher niveau et solide',
                        'Acc√®s s√©curis√©s',
                        'Protections contre les chutes',
                        'Installations √©lectriques v√©rifi√©es',
                        '√âquipements suspendus s√©curis√©s',
                        'Jupes et bardages class√©s au feu',
                        'Liaison √©quipotentielle',
                        'Points de levage contr√¥l√©s',
                        'Fermetures de s√©curit√©'
                    ];
                    break;
                case 'echafaudage':
                    items = [
                        'Montage conforme notice',
                        'Pieds d\'√©chelle pr√©sents',
                        'Planchers complets et fixes',
                        'Garde-corps et plinthes install√©s',
                        'Contreventements v√©rifi√©s',
                        'Ancrages et haubanage tendus',
                        'Marquage des √©l√©ments',
                        'Stabilit√© g√©n√©rale',
                        '√âchafaudage ancr√© au sol',
                        'Protections lat√©rales'
                    ];
                    break;
            }

            const container = document.getElementById('checklistContainer');
            container.innerHTML = '';

            items.forEach((item, index) => {
                const checked = localStorage.getItem(`check_${type}_${index}`) === 'true';
                container.innerHTML += `
                    <div class="flex items-start p-3 bg-stone-50 rounded-lg hover:bg-stone-100 transition">
                        <input type="checkbox" id="item-${index}" 
                               class="mt-1 h-5 w-5 text-orange-600 rounded border-stone-300 focus:ring-orange-500"
                               ${checked ? 'checked' : ''}
                               onchange="updateChecklistProgress('${type}', ${index})">
                        <label for="item-${index}" class="ml-3 text-sm text-stone-700 select-none cursor-pointer">${item}</label>
                    </div>
                `;
            });

            updateOverallProgress();
        }

        function updateChecklistProgress(type, index) {
            const checkbox = document.getElementById(`item-${index}`);
            localStorage.setItem(`check_${type}_${index}`, checkbox.checked);
            updateOverallProgress();
        }

        function updateOverallProgress() {
            const type = document.getElementById('checklistType').value;
            let total = 0;
            let checked = 0;

            // Compter les √©l√©ments
            for (let i = 0; i < 20; i++) {
                if (localStorage.getItem(`check_${type}_${i}`) !== null) {
                    total++;
                    if (localStorage.getItem(`check_${type}_${i}`) === 'true') {
                        checked++;
                    }
                }
            }

            const progress = total > 0 ? Math.round((checked / total) * 100) : 0;
            document.getElementById('checklistProgress').textContent = `${progress}%`;

            // Mettre √† jour la barre de progression
            const progressBar = document.getElementById('checklistProgressBar');
            if (progressBar) {
                progressBar.style.width = `${progress}%`;
            }
        }

        function saveChecklist() {
            const type = document.getElementById('checklistType').value;
            const data = {};

            for (let i = 0; i < 20; i++) {
                const key = `check_${type}_${i}`;
                if (localStorage.getItem(key) !== null) {
                    data[key] = localStorage.getItem(key);
                }
            }

            // Enregistrer dans le stockage local
            localStorage.setItem(`checklist_${type}_${Date.now()}`, JSON.stringify(data));

            // Afficher une confirmation
            Swal.fire({
                icon: 'success',
                title: 'Checklist sauvegard√©e',
                text: 'La checklist a √©t√© sauvegard√©e avec succ√®s.',
                timer: 2000,
                showConfirmButton: false
            });
        }

        function addObservation() {
            const text = document.getElementById('observationText').value;
            if (!text.trim()) {
                Swal.fire({
                    icon: 'warning',
                    title: 'Observation vide',
                    text: 'Veuillez saisir une description pour l\'observation.',
                });
                return;
            }

            const observation = {
                id: Date.now(),
                text: text,
                date: new Date().toLocaleString('fr-FR'),
                resolved: false,
                gravity: 'moyenne'
            };

            // R√©cup√©rer les observations existantes
            let observations = JSON.parse(localStorage.getItem('observations') || '[]');
            observations.push(observation);
            localStorage.setItem('observations', JSON.stringify(observations));

            // R√©initialiser le champ
            document.getElementById('observationText').value = '';

            // Recharger la liste
            loadObservations();

            Swal.fire({
                icon: 'success',
                title: 'Observation ajout√©e',
                text: 'L\'observation a √©t√© enregistr√©e avec succ√®s.',
                timer: 1500,
                showConfirmButton: false
            });
        }

        function loadObservations() {
            const observations = JSON.parse(localStorage.getItem('observations') || '[]');
            const container = document.getElementById('observationsList');

            if (observations.length === 0) {
                container.innerHTML = `
                    <div class="text-center p-8 text-stone-400">
                        <i class="fas fa-clipboard-list text-3xl mb-3"></i>
                        <p>Aucune observation enregistr√©e</p>
                    </div>
                `;
            } else {
                container.innerHTML = observations.map(obs => `
                    <div class="p-4 bg-white rounded-lg border border-stone-200 ${obs.resolved ? 'opacity-75' : ''}">
                        <div class="flex justify-between items-start">
                            <div class="flex-1">
                                <p class="text-stone-700">${obs.text}</p>
                                <div class="flex items-center mt-2 space-x-4 text-sm text-stone-500">
                                    <span><i class="far fa-clock mr-1"></i>${obs.date}</span>
                                    <span class="px-2 py-1 rounded ${obs.gravity === 'critique' ? 'bg-red-100 text-red-800' :
                        obs.gravity === 'haute' ? 'bg-orange-100 text-orange-800' :
                            'bg-blue-100 text-blue-800'}">
                                        ${obs.gravity}
                                    </span>
                                </div>
                            </div>
                            <div class="ml-4 space-x-2">
                                <button onclick="toggleObservation(${obs.id})" 
                                        class="px-3 py-1 text-sm ${obs.resolved ? 'bg-emerald-100 text-emerald-800' : 'bg-orange-100 text-orange-800'} rounded">
                                    ${obs.resolved ? '‚úì R√©solue' : 'Marquer r√©solue'}
                                </button>
                                <button onclick="deleteObservation(${obs.id})" 
                                        class="px-3 py-1 text-sm bg-red-100 text-red-800 rounded">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                `).join('');
            }

            // Mettre √† jour les statistiques
            updateObservationStats(observations);
        }

        function updateObservationStats(observations) {
            const total = observations.length;
            const resolved = observations.filter(o => o.resolved).length;
            const enCours = total - resolved;

            document.getElementById('obsTotal').textContent = total;
            document.getElementById('obsEnCours').textContent = enCours;
            document.getElementById('obsResolues').textContent = resolved;
        }

        function toggleObservation(id) {
            let observations = JSON.parse(localStorage.getItem('observations') || '[]');
            observations = observations.map(obs => {
                if (obs.id === id) {
                    return { ...obs, resolved: !obs.resolved };
                }
                return obs;
            });

            localStorage.setItem('observations', JSON.stringify(observations));
            loadObservations();
        }

        function deleteObservation(id) {
            Swal.fire({
                title: 'Supprimer l\'observation ?',
                text: "Cette action est irr√©versible.",
                icon: 'warning',
                showCancelButton: true,
                confirmButtonColor: '#d33',
                cancelButtonColor: '#3085d6',
                confirmButtonText: 'Supprimer',
                cancelButtonText: 'Annuler'
            }).then((result) => {
                if (result.isConfirmed) {
                    let observations = JSON.parse(localStorage.getItem('observations') || '[]');
                    observations = observations.filter(obs => obs.id !== id);
                    localStorage.setItem('observations', JSON.stringify(observations));
                    loadObservations();

                    Swal.fire(
                        'Supprim√© !',
                        'L\'observation a √©t√© supprim√©e.',
                        'success'
                    );
                }
            });
        }

        // --- Fonctions pour l'onglet Documents ---
        function generateSecurityFile() {
            const organisateur = document.getElementById('organisateurName').value || 'Organisateur non sp√©cifi√©';
            const installateur = document.getElementById('installateurDoc').value || 'Installateur non sp√©cifi√©';
            const nature = document.getElementById('natureManifestation').value || 'Non sp√©cifi√©';

            Swal.fire({
                title: 'G√©n√©ration du dossier',
                html: `
                    <div class="text-left">
                        <p><strong>Organisateur :</strong> ${organisateur}</p>
                        <p><strong>Installateur :</strong> ${installateur}</p>
                        <p><strong>Nature :</strong> ${nature}</p>
                        <p class="mt-4">Le dossier de s√©curit√© sera g√©n√©r√© au format PDF.</p>
                    </div>
                `,
                icon: 'info',
                showCancelButton: true,
                confirmButtonText: 'G√©n√©rer le PDF',
                cancelButtonText: 'Annuler'
            }).then((result) => {
                if (result.isConfirmed) {
                    // Simuler la g√©n√©ration PDF
                    setTimeout(() => {
                        Swal.fire({
                            icon: 'success',
                            title: 'Dossier g√©n√©r√©',
                            text: 'Le dossier de s√©curit√© a √©t√© g√©n√©r√© avec succ√®s.',
                            timer: 2000,
                            showConfirmButton: false
                        });
                    }, 1000);
                }
            });
        }

        function showDecision(step, answer) {
            let content = '';

            if (step === 1 && answer === 'yes') {
                content = `
                    <p><strong>Documentation requise :</strong></p>
                    <ul class="list-disc ml-5 space-y-1">
                        <li>Avis sur mod√®le valide</li>
                        <li>Notice technique du fabricant</li>
                        <li>Attestation de bon montage</li>
                        <li>V√©rification de la configuration sp√©cifique</li>
                    </ul>
                    <div class="mt-3 p-2 bg-emerald-100 text-emerald-800 rounded text-sm">
                        ‚úÖ La configuration est couverte par l'avis sur mod√®le.
                    </div>
                `;
            } else if (step === 1 && answer === 'no') {
                content = `
                    <p><strong>Documentation requise :</strong></p>
                    <ul class="list-disc ml-5 space-y-1">
                        <li>Dossier technique complet</li>
                        <li>Note de calculs valid√©e</li>
                        <li>Notice technique du fabricant</li>
                        <li>Plans de montage d√©taill√©s</li>
                        <li>Attestation de bon montage</li>
                    </ul>
                    <div class="mt-3 p-2 bg-orange-100 text-orange-800 rounded text-sm">
                        ‚ö†Ô∏è Un dossier technique est obligatoire.
                    </div>
                `;
            }

            document.getElementById('decisionContent').innerHTML = content;
            document.getElementById('decisionResult').classList.remove('hidden');
        }

        // --- Fonctions pour l'onglet Outils ---
        function calculateDistance() {
            const localType = document.getElementById('localType').value;
            const nbSorties = parseInt(document.getElementById('nbSorties').value) || 2;

            let distance = 0;

            switch (localType) {
                case 'salle':
                    distance = nbSorties >= 4 ? 40 : 30;
                    break;
                case 'chapiteau':
                    distance = nbSorties >= 4 ? 60 : 40;
                    break;
                case 'tente':
                    distance = 50;
                    break;
            }

            document.getElementById('distanceValue').textContent = `${distance} m√®tres`;
            document.getElementById('distanceResult').classList.remove('hidden');
        }

        function verifyGuardrail() {
            const height = parseFloat(document.getElementById('guardHeight').value);
            const type = document.getElementById('guardType').value;

            let minHeight = 1.0;
            let resultClass = 'bg-red-50 border-red-200';
            let resultText = '';
            let icon = '‚ùå';

            // D√©terminer les exigences selon le type
            switch (type) {
                case 'tribune':
                    minHeight = 1.0;
                    if (height >= 1.0) {
                        resultClass = 'bg-emerald-50 border-emerald-200';
                        resultText = 'Hauteur conforme pour une tribune (minimum 1.0 m)';
                        icon = '‚úÖ';
                    } else {
                        resultText = 'Hauteur insuffisante pour une tribune (minimum 1.0 m)';
                    }
                    break;

                case 'scene':
                    minHeight = 1.0;
                    if (height >= 1.0) {
                        resultClass = 'bg-emerald-50 border-emerald-200';
                        resultText = 'Hauteur conforme pour une sc√®ne (minimum 1.0 m)';
                        icon = '‚úÖ';
                    } else {
                        resultText = 'Hauteur insuffisante pour une sc√®ne (minimum 1.0 m)';
                    }
                    break;

                case 'escalier':
                    minHeight = 0.9;
                    if (height >= 0.9) {
                        resultClass = 'bg-emerald-50 border-emerald-200';
                        resultText = 'Hauteur conforme pour un escalier (minimum 0.9 m)';
                        icon = '‚úÖ';
                    } else {
                        resultText = 'Hauteur insuffisante pour un escalier (minimum 0.9 m)';
                    }
                    break;

                case 'passerelle':
                    minHeight = 1.0;
                    if (height >= 1.0) {
                        resultClass = 'bg-emerald-50 border-emerald-200';
                        resultText = 'Hauteur conforme pour une passerelle (minimum 1.0 m)';
                        icon = '‚úÖ';
                    } else {
                        resultText = 'Hauteur insuffisante pour une passerelle (minimum 1.0 m)';
                    }
                    break;
            }

            const resultDiv = document.getElementById('guardResult');
            resultDiv.innerHTML = `
        <div class="flex items-center">
            <span class="text-2xl mr-3">${icon}</span>
            <div>
                <div class="font-medium">${resultText}</div>
                <div class="text-sm text-stone-600 mt-1">Hauteur mesur√©e : ${height} m | Minimum requis : ${minHeight} m</div>
            </div>
        </div>
    `;
            resultDiv.className = `mt-4 p-4 rounded-lg border ${resultClass}`;
            resultDiv.classList.remove('hidden');
        }

        function generatePreventionPlan() {
            const nbEntreprises = parseInt(document.getElementById('nbEntreprises').value) || 0;
            const dureeTravaux = parseInt(document.getElementById('dureeTravaux').value) || 0;

            let planNecessaire = dureeTravaux >= 400;
            let message = '';
            let type = 'info';

            if (planNecessaire) {
                message = `Plan de pr√©vention OBLIGATOIRE : ${dureeTravaux}h de travaux avec ${nbEntreprises} entreprise(s).`;
                type = 'warning';
            } else {
                message = `Plan de pr√©vention recommand√© mais non obligatoire (< 400h). Dur√©e : ${dureeTravaux}h.`;
                type = 'success';
            }

            Swal.fire({
                icon: type === 'warning' ? 'warning' : 'info',
                title: 'Plan de Pr√©vention',
                html: `
            <div class="text-left">
                <p class="mb-4">${message}</p>
                <div class="bg-blue-50 p-4 rounded-lg mb-4">
                    <h4 class="font-bold mb-2">Contenu minimum du plan :</h4>
                    <ul class="text-sm space-y-1">
                        <li>‚Ä¢ D√©finition des phases d'activit√© dangereuses</li>
                        <li>‚Ä¢ Adaptation des mat√©riels et installations</li>
                        <li>‚Ä¢ Instructions √† donner aux salari√©s</li>
                        <li>‚Ä¢ Organisation des premiers secours</li>
                    </ul>
                </div>
            </div>
        `,
                confirmButtonText: 'Compris',
                confirmButtonColor: '#ea580c'
            });
        }

        function calculateNextVerification() {
            const equipmentType = document.getElementById('equipmentType').value;
            const lastVerification = document.getElementById('lastVerification').value;

            if (!lastVerification) {
                Swal.fire({
                    icon: 'warning',
                    title: 'Date manquante',
                    text: 'Veuillez saisir la date de derni√®re v√©rification.',
                });
                return;
            }

            const lastDate = new Date(lastVerification);
            let nextDate = new Date(lastDate);
            let frequence = '';
            let details = '';

            switch (equipmentType) {
                case 'levage':
                    nextDate.setFullYear(lastDate.getFullYear() + 1);
                    frequence = 'Annuelle';
                    details = 'V√©rification g√©n√©rale p√©riodique (VGP) par organisme accr√©dit√©. Articles R4323-22 et R4323-23 du Code du travail.';
                    break;
                case 'electrique':
                    nextDate.setFullYear(lastDate.getFullYear() + 1);
                    frequence = 'Annuelle';
                    details = 'V√©rification des installations √©lectriques (Q18/Q19). Article EL du r√®glement de s√©curit√© ERP.';
                    break;
                case 'securite':
                    nextDate.setMonth(lastDate.getMonth() + 6);
                    frequence = 'Semestrielle';
                    details = 'V√©rification des moyens de secours (extincteurs, RIA, BAES, d√©senfumage). Article MS du r√®glement ERP.';
                    break;
                case 'structure':
                    nextDate.setFullYear(lastDate.getFullYear() + 2);
                    frequence = 'Biennale (2 ans)';
                    details = 'V√©rification du registre de s√©curit√© CTS. 6 mois si > 2500 pers ou √©tablissements multiples. Article CTS 34.';
                    break;
            }

            const today = new Date();
            const daysRemaining = Math.ceil((nextDate - today) / (1000 * 60 * 60 * 24));

            let statusClass = 'bg-emerald-50 border-emerald-200';
            let statusIcon = '‚úÖ';
            let statusText = '√Ä jour';

            if (daysRemaining < 0) {
                statusClass = 'bg-red-50 border-red-200';
                statusIcon = 'üö®';
                statusText = `D√âPASS√â de ${Math.abs(daysRemaining)} jours !`;
            } else if (daysRemaining < 30) {
                statusClass = 'bg-orange-50 border-orange-200';
                statusIcon = '‚ö†Ô∏è';
                statusText = `Urgent : ${daysRemaining} jours restants`;
            } else {
                statusText = `${daysRemaining} jours restants`;
            }

            document.getElementById('nextVerificationDate').textContent = nextDate.toLocaleDateString('fr-FR');

            const resultDiv = document.getElementById('verificationResult');
            resultDiv.className = `mt-4 p-4 rounded-lg border ${statusClass}`;
            resultDiv.innerHTML = `
        <div class="space-y-3">
            <div class="flex items-center">
                <span class="text-2xl mr-3">${statusIcon}</span>
                <div>
                    <div class="font-bold text-lg">${statusText}</div>
                    <div class="text-sm mt-1">Prochaine v√©rification : ${nextDate.toLocaleDateString('fr-FR')}</div>
                </div>
            </div>
            <div class="bg-white p-3 rounded border">
                <div class="text-sm font-medium mb-1">Fr√©quence : ${frequence}</div>
                <div class="text-xs text-stone-600">${details}</div>
            </div>
        </div>
    `;
            resultDiv.classList.remove('hidden');

            // Sauvegarder la v√©rification
            saveVerification(equipmentType, lastVerification, nextDate.toISOString().split('T')[0]);
        }

        function saveVerification(type, lastDate, nextDate) {
            const verifications = JSON.parse(localStorage.getItem('verifications') || '[]');
            verifications.push({
                type,
                lastDate,
                nextDate,
                timestamp: new Date().toISOString()
            });
            localStorage.setItem('verifications', JSON.stringify(verifications));
        }


        // --- Fonctions de sauvegarde ---
        function saveCalculation(type, data) {
            const calculations = JSON.parse(localStorage.getItem('calculations') || '[]');
            calculations.push({
                type,
                data,
                timestamp: new Date().toISOString()
            });
            localStorage.setItem('calculations', JSON.stringify(calculations));
        }

        function saveAttestationData(data) {
            const attestations = JSON.parse(localStorage.getItem('attestations') || '[]');
            attestations.push({
                ...data,
                timestamp: new Date().toISOString()
            });
            localStorage.setItem('attestations', JSON.stringify(attestations));

            // Mettre √† jour le tableau de bord
            updateDashboardCounts();
        }

        function updateDashboardCounts() {
            // Compter les checklists
            let checklistCount = 0;
            for (let i = 0; i < localStorage.length; i++) {
                const key = localStorage.key(i);
                if (key && key.startsWith('checklist_')) {
                    checklistCount++;
                }
            }

            // Compter les attestations
            const attestations = JSON.parse(localStorage.getItem('attestations') || '[]');
            const attestationCount = attestations.length;

            // Compter les observations en cours
            const observations = JSON.parse(localStorage.getItem('observations') || '[]');
            const alertCount = observations.filter(o => !o.resolved).length;

            // Mettre √† jour l'interface
            document.getElementById('dashboardChecklists').textContent = checklistCount;
            document.getElementById('dashboardDocuments').textContent = attestationCount;
            document.getElementById('dashboardAlerts').textContent = alertCount;
        }

        // --- Initialisation ---
        document.addEventListener('DOMContentLoaded', () => {
            // Nettoyer les anciennes instances de graphiques
            window.chartInstances = {};

            // Initialiser les onglets
            switchTab('dashboard');

            // Attendre que Chart.js soit charg√© avant d'initialiser les graphiques
            const checkChartLoaded = setInterval(() => {
                if (typeof Chart !== 'undefined') {
                    clearInterval(checkChartLoaded);

                    // Initialiser les graphiques avec un l√©ger d√©lai
                    setTimeout(() => {
                        initDashboardCharts();
                        initNewCharts();

                        // Initialiser les checklists
                        loadChecklist();

                        // Initialiser les observations
                        loadObservations();

                        // Initialiser le tableau de bord
                        updateDashboardCounts();

                        // Initialiser la l√©gislation
                        renderLinksTable(regulationsData);
                        setupSearch();

                        // Configurer le mode hors ligne
                        setupOfflineMode();

                        // Mettre √† jour les notifications
                        setupNotifications();

                        // Initialiser les proc√©dures
                        updateProcedure(0);

                        // Initialiser la checklist outils
                        initChecklist();
                    }, 300);
                }
            }, 100);
        });

        // --- Configuration du mode hors ligne ---
        function setupOfflineMode() {
            // V√©rifier si l'application est en ligne
            state.offlineMode = !navigator.onLine;

            // √âcouter les changements de connexion
            window.addEventListener('online', () => {
                state.offlineMode = false;
                showOfflineStatus(false);
            });

            window.addEventListener('offline', () => {
                state.offlineMode = true;
                showOfflineStatus(true);
            });

            // Initialiser l'affichage
            showOfflineStatus(state.offlineMode);
        }

        function showOfflineStatus(isOffline) {
            // Cr√©er ou mettre √† jour la banni√®re
            let banner = document.getElementById('offlineBanner');

            if (isOffline) {
                if (!banner) {
                    banner = document.createElement('div');
                    banner.id = 'offlineBanner';
                    banner.className = 'fixed top-0 left-0 right-0 bg-orange-600 text-white text-center py-2 z-50';
                    banner.innerHTML = `
                        <div class="flex items-center justify-center">
                            <i class="fas fa-wifi-slash mr-2"></i>
                            <span>Mode hors ligne - Les donn√©es sont sauvegard√©es localement</span>
                        </div>
                    `;
                    document.body.prepend(banner);
                }
            } else if (banner) {
                banner.remove();
            }
        }

        // --- Notifications ---
        function setupNotifications() {
            // V√©rifier les √©ch√©ances chaque jour
            setInterval(checkDeadlines, 24 * 60 * 60 * 1000);
            checkDeadlines(); // V√©rifier au chargement
        }

        function checkDeadlines() {
            // Cette fonction v√©rifie les √©ch√©ances et affiche des alertes
            // Impl√©mentation simplifi√©e pour l'exemple
            const deadlines = [
                { title: 'V√©rification trimestrielle', date: '2024-06-15' },
                { title: 'Renouvellement registre', date: '2024-07-01' }
            ];

            const today = new Date();
            deadlines.forEach(deadline => {
                const dueDate = new Date(deadline.date);
                const daysLeft = Math.ceil((dueDate - today) / (1000 * 60 * 60 * 24));

                if (daysLeft <= 7 && daysLeft > 0) {
                    showNotification(`√âch√©ance : ${deadline.title} dans ${daysLeft} jour(s)`);
                }
            });
        }

        function showNotification(message) {
            // Cr√©er une notification toast
            const toast = document.createElement('div');
            toast.className = 'fixed bottom-4 right-4 bg-stone-800 text-white p-4 rounded-lg shadow-lg z-50 max-w-sm animate-fade-in';
            toast.innerHTML = `
                <div class="flex items-center">
                    <i class="fas fa-bell text-orange-500 mr-3"></i>
                    <div class="flex-1">${message}</div>
                    <button onclick="this.parentElement.parentElement.remove()" class="ml-3 text-stone-400 hover:text-white">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
            `;

            document.body.appendChild(toast);

            // Supprimer apr√®s 5 secondes
            setTimeout(() => {
                if (toast.parentElement) {
                    toast.remove();
                }
            }, 5000);
        }

        // --- Donn√©es pour la l√©gislation ---
        const regulationsData = [
            {
                theme: "ERP / S√©curit√©",
                title: "Arr√™t√© du 23 janvier 1985 (CTS)",
                desc: "R√®glement de s√©curit√© contre les risques d'incendie et de panique dans les ERP de type CTS (Chapiteaux, Tentes et Structures).",
                keywords: ["chapiteau", "tente", "feu", "panique", "√©vacuation", "toile"],
                url: "https://www.legifrance.gouv.fr/loda/id/JORFTEXT000000874028/"
            },
            {
                theme: "Espace Public",
                title: "Code g√©n√©ral de la propri√©t√© des personnes publiques",
                desc: "Articles relatifs √† l'occupation du domaine public (Autorisation d'Occupation Temporaire).",
                keywords: ["rue", "espace public", "mairie", "redevance", "autorisation", "AOT"],
                url: "https://www.legifrance.gouv.fr/codes/id/LEGITEXT000031366252/"
            },
            {
                theme: "Animaux",
                title: "Loi n¬∞ 2021-1539 du 30 nov 2021",
                desc: "Loi visant √† lutter contre la maltraitance animale (Interdiction faune sauvage cirque itin√©rant).",
                keywords: ["animaux", "lion", "tigre", "interdiction", "bien-√™tre", "cirque"],
                url: "https://www.legifrance.gouv.fr/jorf/id/JORFTEXT000044387560/"
            },
            {
                theme: "Travail / Artistes",
                title: "Code du travail - Sant√© et s√©curit√©",
                desc: "Dispositions g√©n√©rales sur la sant√© et la s√©curit√© au travail (applicable au montage/d√©montage).",
                keywords: ["s√©curit√©", "travail", "montage", "√©quipement", "casque", "chantier"],
                url: "https://www.legifrance.gouv.fr/codes/id/LEGITEXT000006072050/"
            },
            {
                theme: "Bruit / Son",
                title: "Code de la sant√© publique - Bruit",
                desc: "R√©glementation relative √† la pr√©vention des risques li√©s aux bruits et aux sons amplifi√©s.",
                keywords: ["son", "bruit", "voisinage", "d√©cibel", "concert", "nuisance"],
                url: "https://www.legifrance.gouv.fr/codes/id/LEGITEXT000006072665/"
            },
            {
                theme: "ERP / G√©n√©ral",
                title: "Arr√™t√© du 25 juin 1980",
                desc: "R√®glement de s√©curit√© contre les risques d'incendie et de panique dans les ERP (Dispositions G√©n√©rales).",
                keywords: ["feu", "extincteur", "alarme", "erp", "s√©curit√©", "incendie"],
                url: "https://www.legifrance.gouv.fr/loda/id/JORFTEXT000000510784/"
            },
            {
                theme: "Contr√¥le Technique",
                title: "Code de la construction et de l'habitation",
                desc: "Articles relatifs aux v√©rifications techniques obligatoires dans les ERP.",
                keywords: ["contr√¥le", "bureau de contr√¥le", "√©lectricit√©", "levage", "v√©rification"],
                url: "https://www.legifrance.gouv.fr/codes/id/LEGITEXT000006074096/"
            },
            {
                theme: "Spectacle Vivant",
                title: "Code du travail - Statut des artistes",
                desc: "Dispositions relatives au statut des artistes du spectacle.",
                keywords: ["artiste", "intermittent", "spectacle", "cachet", "contrat"],
                url: "https://www.legifrance.gouv.fr/codes/section_lc/LEGITEXT000006072050/LEGISCTA000006193175"
            }
        ];

        function renderLinksTable(data) {
            const tbody = document.getElementById('linksTableBody');
            tbody.innerHTML = '';

            if (data.length === 0) {
                document.getElementById('noResults').classList.remove('hidden');
                return;
            } else {
                document.getElementById('noResults').classList.add('hidden');
            }

            data.forEach(item => {
                const tr = document.createElement('tr');
                tr.className = "hover:bg-stone-50 transition-colors";
                tr.innerHTML = `
                    <td class="px-6 py-4 whitespace-nowrap">
                        <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-stone-100 text-stone-800">
                            ${item.theme}
                        </span>
                    </td>
                    <td class="px-6 py-4">
                        <div class="text-sm font-bold text-stone-900">${item.title}</div>
                        <div class="text-sm text-stone-600">${item.desc}</div>
                    </td>
                    <td class="px-6 py-4">
                        <div class="flex flex-wrap gap-1">
                            ${item.keywords.map(k => `<span class="text-xs text-stone-400 border border-stone-200 rounded px-1">${k}</span>`).join('')}
                        </div>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-right text-sm font-medium">
                        <a href="${item.url}" target="_blank" class="text-orange-600 hover:text-orange-800 font-bold hover:underline flex items-center justify-end">
                            Voir <i class="fas fa-external-link-alt ml-2 text-xs"></i>
                        </a>
                    </td>
                `;
                tbody.appendChild(tr);
            });
        }

        function setupSearch() {
            const input = document.getElementById('linkSearch');
            input.addEventListener('input', (e) => {
                const term = e.target.value.toLowerCase();
                const filtered = regulationsData.filter(item =>
                    item.title.toLowerCase().includes(term) ||
                    item.desc.toLowerCase().includes(term) ||
                    item.keywords.some(k => k.toLowerCase().includes(term)) ||
                    item.theme.toLowerCase().includes(term)
                );
                renderLinksTable(filtered);
            });
        }

        // --- Donn√©es pour les proc√©dures ---
        const procedureSteps = [
            {
                title: "1. Conception & Demande",
                content: `<h4 class="font-bold text-lg mb-3 text-slate-800">Dossier de S√©curit√©</h4>
                          <p class="mb-3">L'organisateur doit constituer un dossier comprenant :</p>
                          <ul class="list-disc ml-5 mb-3 space-y-1">
                            <li>Le plan d'implantation (masses, d√©gagements).</li>
                            <li>L'extrait du registre de s√©curit√© du chapiteau (validit√© < 2 ans).</li>
                            <li>L'attestation de bon montage (pr√©visionnelle).</li>
                          </ul>
                          <p class="text-sm italic text-stone-600">D√©lai : Envoi en Mairie/Pr√©fecture au moins 1 mois avant l'√©v√©nement.</p>`
            },
            {
                title: "2. Implantation & Sol",
                content: `<h4 class="font-bold text-lg mb-3 text-slate-800">Essais de Sol</h4>
                          <p class="mb-3">Avant tout montage, la r√©sistance du sol doit √™tre v√©rifi√©e.</p>
                          <ul class="list-disc ml-5 mb-3 space-y-1">
                             <li>Tests d'arrachement (au dynamom√®tre) obligatoires sur les types de piquets utilis√©s.</li>
                             <li>V√©rification de l'absence de r√©seaux souterrains (DICT).</li>
                          </ul>
                          <p class="text-sm italic text-stone-600">Ref: CTS 5 et CTS 52.</p>`
            },
            {
                title: "3. Montage",
                content: `<h4 class="font-bold text-lg mb-3 text-slate-800">V√©rifications Techniques</h4>
                          <p class="mb-3">Durant le montage, le technicien comp√©tent v√©rifie :</p>
                          <ul class="list-disc ml-5 mb-3 space-y-1">
                            <li>La conformit√© des axes, goupilles et boulons.</li>
                            <li>La tension des haubans et l'absence de poches d'eau sur la toile.</li>
                            <li>La mise √† la terre des structures m√©talliques (CTS 13).</li>
                          </ul>`
            },
            {
                title: "4. Contr√¥le Final",
                content: `<h4 class="font-bold text-lg mb-3 text-slate-800">Inspection Commission</h4>
                          <p class="mb-3">Avant l'ouverture au public :</p>
                          <ul class="list-disc ml-5 mb-3 space-y-1">
                            <li>Passage de l'organisme de contr√¥le agr√©√© (d√©livrance rapport final).</li>
                            <li>Visite de la Commission de S√©curit√©.</li>
                            <li>Signature de l'Arr√™t√© d'ouverture par le Maire.</li>
                          </ul>`
            }
        ];

        function updateProcedure(index) {
            document.getElementById('procedure-content').innerHTML = procedureSteps[index].content;

            document.querySelectorAll('.proc-btn').forEach((btn, idx) => {
                if (idx === index) {
                    btn.classList.remove('bg-stone-200', 'text-stone-600');
                    btn.classList.add('bg-orange-600', 'text-white');
                } else {
                    btn.classList.add('bg-stone-200', 'text-stone-600');
                    btn.classList.remove('bg-orange-600', 'text-white');
                }
            });
        }

        // --- Donn√©es pour le focus technique ---
        const techDetails = {
            'sol': {
                title: "Ancrage au Sol (CTS 5)",
                html: `<div class="space-y-4">
                        <p class="text-stone-700">La stabilit√© du chapiteau repose int√©gralement sur ses ancrages. Les lests ou piquets doivent r√©sister aux efforts calcul√©s par le constructeur.</p>
                        <div class="bg-blue-50 p-4 rounded-lg border border-blue-200">
                            <strong class="text-slate-800">Test d'arrachement :</strong>
                            <p class="text-sm text-stone-600 mt-1">Il est imp√©ratif de r√©aliser des essais d'arrachement sur site avec un dynamom√®tre certifi√©. Les r√©sultats doivent √™tre consign√©s.</p>
                        </div>
                        <div class="bg-yellow-50 p-4 rounded-lg border border-yellow-200">
                            <strong class="text-yellow-800">Point critique :</strong>
                            <p class="text-sm text-yellow-700 mt-1">Ne jamais planter de piquets sans DICT (D√©claration d'Intention de Commencement de Travaux) pour √©viter les c√¢bles √©lectriques/gaz.</p>
                        </div>
                       </div>`
            },
            'structure': {
                title: "Charpente, M√¢ts & Levage (CTS 7-9)",
                html: `<div class="space-y-4">
                        <p class="text-stone-700">L'ossature doit √™tre exempte de d√©formation. Les m√©canismes de levage doivent √™tre s√©curis√©s.</p>
                        <ul class="list-disc ml-5 text-sm space-y-2">
                            <li><strong class="text-slate-800">Goupilles :</strong> Toutes les goupilles doivent √™tre frein√©es (clips de s√©curit√©).</li>
                            <li><strong class="text-slate-800">C√¢bles :</strong> Absence de "gendarmes" (fils cass√©s) ou de corrosion.</li>
                            <li><strong class="text-slate-800">Levage :</strong> Une fois la structure lev√©e, elle doit √™tre s√©curis√©e m√©caniquement (pas uniquement par hydraulique).</li>
                        </ul>
                       </div>`
            },
            'toile': {
                title: "Enveloppe & R√©action au Feu (CTS 10-12)",
                html: `<div class="space-y-4">
                        <p class="text-stone-700">Les toiles doivent limiter la propagation du feu.</p>
                        <div class="flex items-center space-x-3 p-3 bg-emerald-50 rounded-lg">
                            <span class="px-3 py-1 bg-emerald-600 text-white font-bold rounded">M2</span>
                            <span class="text-sm text-emerald-800">Classement minimal obligatoire pour les toiles de couverture.</span>
                        </div>
                        <p class="text-sm text-stone-700 mt-2">Pour les √©l√©ments de d√©coration int√©rieure (v√©lum, rideaux), le classement <strong class="text-slate-800">M1</strong> est souvent exig√© sauf exception.</p>
                        <div class="bg-red-50 p-3 rounded-lg border border-red-200">
                            <p class="text-sm font-bold text-red-700">Attention : L'attestation de classement au feu doit √™tre pr√©sent√©e lors du contr√¥le.</p>
                        </div>
                       </div>`
            },
            'elec': {
                title: "Installations √âlectriques & Chauffage (CTS 13-28)",
                html: `<div class="space-y-4">
                        <p class="text-stone-700">Les risques de court-circuit et d'incendie sont majeurs sous chapiteau.</p>
                        <ul class="list-disc ml-5 text-sm space-y-2">
                            <li><strong class="text-slate-800">Liaison √©quipotentielle :</strong> Toute la structure m√©tallique doit √™tre reli√©e √† la terre.</li>
                            <li><strong class="text-slate-800">Blocs de Secours (BAES) :</strong> Obligatoires pour baliser les sorties.</li>
                            <li><strong class="text-slate-800">Chauffage :</strong> Les g√©n√©rateurs d'air chaud doivent √™tre √† l'ext√©rieur (distance s√©cu > 5m) avec gaines ininflammables (M0/M1).</li>
                        </ul>
                       </div>`
            }
        };

        function showTechDetail(key) {
            const data = techDetails[key];
            const display = document.getElementById('tech-display');
            display.innerHTML = `
                <h3 class="text-xl font-bold text-orange-600 mb-6">${data.title}</h3>
                ${data.html}
            `;
        }

        // Checklist pour l'onglet Outils
        const checklistItems = [
            "Extrait du registre de s√©curit√© pr√©sent sur site",
            "Rapport de v√©rification des installations √©lectriques (sans r√©serves)",
            "Rapport de v√©rification des moyens de secours (extincteurs)",
            "Certificats de classement au feu (M1/M2) des toiles",
            "Attestation de bon montage sign√©e",
            "Issues de secours d√©gag√©es et signal√©es",
            "Blocs de s√©curit√© (BAES) fonctionnels",
            "Liaison √©quipotentielle (Mise √† la terre) connect√©e",
            "Ancrages v√©rifi√©s (goupilles, tensions)"
        ];

        function initChecklist() {
            const container = document.getElementById('checklist-container');
            container.innerHTML = '';
            checklistItems.forEach((item, index) => {
                const checked = localStorage.getItem(`cts_check_${index}`) === 'true' ? 'checked' : '';
                container.innerHTML += `
                    <div class="flex items-start p-3 bg-stone-50 rounded-lg hover:bg-stone-100 transition">
                        <input type="checkbox" id="check-${index}" class="mt-1 h-5 w-5 text-orange-600 rounded border-stone-300 focus:ring-orange-500" ${checked} onchange="toggleCheck(${index})">
                        <label for="check-${index}" class="ml-3 text-sm text-stone-700 select-none cursor-pointer">${item}</label>
                    </div>
                `;
            });
        }

        function toggleCheck(index) {
            const checkbox = document.getElementById(`check-${index}`);
            localStorage.setItem(`cts_check_${index}`, checkbox.checked);
        }

        function resetChecklist() {
            checklistItems.forEach((_, index) => localStorage.removeItem(`cts_check_${index}`));
            initChecklist();
        }


        // Afficher automatiquement le bonus apr√®s 30 secondes
        setTimeout(() => {
            if (Math.random() > 0.5) { // 50% de chance
                showAnimalBonus();
            }
        }, 30000);

        // Ou ajouter un bouton discret quelque part si tu pr√©f√®res
        document.addEventListener('DOMContentLoaded', () => {
            // Ajouter un bouton discret en bas √† droite
            const animalBtn = document.createElement('button');
            animalBtn.innerHTML = 'üêæ';
            animalBtn.title = 'Nos amis les animaux';
            animalBtn.className = 'fixed bottom-4 right-4 bg-emerald-500 text-white w-12 h-12 rounded-full shadow-lg hover:bg-emerald-600 transition z-50 flex items-center justify-center text-xl';
            animalBtn.onclick = showAnimalBonus;
            document.body.appendChild(animalBtn);
        });

    </script>
</body>

</html>
